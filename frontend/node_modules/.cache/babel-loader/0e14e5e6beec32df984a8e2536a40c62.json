{"ast":null,"code":"import { assign, isFunction, isArray, forEach, isDefined } from 'min-dash';\nimport { delegate as domDelegate, event as domEvent, attr as domAttr, query as domQuery, classes as domClasses, domify } from 'min-dom';\nvar entrySelector = '.entry';\n/**\n * A context pad that displays element specific, contextual actions next\n * to a diagram element.\n *\n * @param {Object} config\n * @param {Boolean|Object} [config.scale={ min: 1.0, max: 1.5 }]\n * @param {Number} [config.scale.min]\n * @param {Number} [config.scale.max]\n * @param {EventBus} eventBus\n * @param {Overlays} overlays\n */\n\nexport default function ContextPad(config, eventBus, overlays) {\n  this._providers = [];\n  this._eventBus = eventBus;\n  this._overlays = overlays;\n  var scale = isDefined(config && config.scale) ? config.scale : {\n    min: 1,\n    max: 1.5\n  };\n  this._overlaysConfig = {\n    position: {\n      right: -9,\n      top: -6\n    },\n    scale: scale\n  };\n  this._current = null;\n\n  this._init();\n}\nContextPad.$inject = ['config.contextPad', 'eventBus', 'overlays'];\n/**\n * Registers events needed for interaction with other components\n */\n\nContextPad.prototype._init = function () {\n  var eventBus = this._eventBus;\n  var self = this;\n  eventBus.on('selection.changed', function (e) {\n    var selection = e.newSelection;\n\n    if (selection.length === 1) {\n      self.open(selection[0]);\n    } else {\n      self.close();\n    }\n  });\n  eventBus.on('elements.delete', function (event) {\n    var elements = event.elements;\n    forEach(elements, function (e) {\n      if (self.isOpen(e)) {\n        self.close();\n      }\n    });\n  });\n  eventBus.on('element.changed', function (event) {\n    var element = event.element,\n        current = self._current; // force reopen if element for which we are currently opened changed\n\n    if (current && current.element === element) {\n      self.open(element, true);\n    }\n  });\n};\n/**\n * Register a provider with the context pad\n *\n * @param  {ContextPadProvider} provider\n */\n\n\nContextPad.prototype.registerProvider = function (provider) {\n  this._providers.push(provider);\n};\n/**\n * Returns the context pad entries for a given element\n *\n * @param {djs.element.Base} element\n *\n * @return {Array<ContextPadEntryDescriptor>} list of entries\n */\n\n\nContextPad.prototype.getEntries = function (element) {\n  var entries = {}; // loop through all providers and their entries.\n  // group entries by id so that overriding an entry is possible\n\n  forEach(this._providers, function (provider) {\n    var e = provider.getContextPadEntries(element);\n    forEach(e, function (entry, id) {\n      entries[id] = entry;\n    });\n  });\n  return entries;\n};\n/**\n * Trigger an action available on the opened context pad\n *\n * @param  {String} action\n * @param  {Event} event\n * @param  {Boolean} [autoActivate=false]\n */\n\n\nContextPad.prototype.trigger = function (action, event, autoActivate) {\n  var element = this._current.element,\n      entries = this._current.entries,\n      entry,\n      handler,\n      originalEvent,\n      button = event.delegateTarget || event.target;\n\n  if (!button) {\n    return event.preventDefault();\n  }\n\n  entry = entries[domAttr(button, 'data-action')];\n  handler = entry.action;\n  originalEvent = event.originalEvent || event; // simple action (via callback function)\n\n  if (isFunction(handler)) {\n    if (action === 'click') {\n      return handler(originalEvent, element, autoActivate);\n    }\n  } else {\n    if (handler[action]) {\n      return handler[action](originalEvent, element, autoActivate);\n    }\n  } // silence other actions\n\n\n  event.preventDefault();\n};\n/**\n * Open the context pad for the given element\n *\n * @param {djs.model.Base} element\n * @param {Boolean} force if true, force reopening the context pad\n */\n\n\nContextPad.prototype.open = function (element, force) {\n  if (!force && this.isOpen(element)) {\n    return;\n  }\n\n  this.close();\n\n  this._updateAndOpen(element);\n};\n\nContextPad.prototype._updateAndOpen = function (element) {\n  var entries = this.getEntries(element),\n      pad = this.getPad(element),\n      html = pad.html;\n  forEach(entries, function (entry, id) {\n    var grouping = entry.group || 'default',\n        control = domify(entry.html || '<div class=\"entry\" draggable=\"true\"></div>'),\n        container;\n    domAttr(control, 'data-action', id);\n    container = domQuery('[data-group=' + grouping + ']', html);\n\n    if (!container) {\n      container = domify('<div class=\"group\" data-group=\"' + grouping + '\"></div>');\n      html.appendChild(container);\n    }\n\n    container.appendChild(control);\n\n    if (entry.className) {\n      addClasses(control, entry.className);\n    }\n\n    if (entry.title) {\n      domAttr(control, 'title', entry.title);\n    }\n\n    if (entry.imageUrl) {\n      control.appendChild(domify('<img src=\"' + entry.imageUrl + '\">'));\n    }\n  });\n  domClasses(html).add('open');\n  this._current = {\n    element: element,\n    pad: pad,\n    entries: entries\n  };\n\n  this._eventBus.fire('contextPad.open', {\n    current: this._current\n  });\n};\n\nContextPad.prototype.getPad = function (element) {\n  if (this.isOpen()) {\n    return this._current.pad;\n  }\n\n  var self = this;\n  var overlays = this._overlays;\n  var html = domify('<div class=\"djs-context-pad\"></div>');\n  var overlaysConfig = assign({\n    html: html\n  }, this._overlaysConfig);\n  domDelegate.bind(html, entrySelector, 'click', function (event) {\n    self.trigger('click', event);\n  });\n  domDelegate.bind(html, entrySelector, 'dragstart', function (event) {\n    self.trigger('dragstart', event);\n  }); // stop propagation of mouse events\n\n  domEvent.bind(html, 'mousedown', function (event) {\n    event.stopPropagation();\n  });\n  this._overlayId = overlays.add(element, 'context-pad', overlaysConfig);\n  var pad = overlays.get(this._overlayId);\n\n  this._eventBus.fire('contextPad.create', {\n    element: element,\n    pad: pad\n  });\n\n  return pad;\n};\n/**\n * Close the context pad\n */\n\n\nContextPad.prototype.close = function () {\n  if (!this.isOpen()) {\n    return;\n  }\n\n  this._overlays.remove(this._overlayId);\n\n  this._overlayId = null;\n\n  this._eventBus.fire('contextPad.close', {\n    current: this._current\n  });\n\n  this._current = null;\n};\n/**\n * Check if pad is open. If element is given, will check\n * if pad is opened with given element.\n *\n * @param {Element} element\n * @return {Boolean}\n */\n\n\nContextPad.prototype.isOpen = function (element) {\n  return !!this._current && (!element ? true : this._current.element === element);\n}; // helpers //////////////////////\n\n\nfunction addClasses(element, classNames) {\n  var classes = domClasses(element);\n  var actualClassNames = isArray(classNames) ? classNames : classNames.split(/\\s+/g);\n  actualClassNames.forEach(function (cls) {\n    classes.add(cls);\n  });\n}","map":{"version":3,"sources":["C:/Users/Vittorio/Documents/GitHub/SPM2021-MTV/frontend/node_modules/diagram-js/lib/features/context-pad/ContextPad.js"],"names":["assign","isFunction","isArray","forEach","isDefined","delegate","domDelegate","event","domEvent","attr","domAttr","query","domQuery","classes","domClasses","domify","entrySelector","ContextPad","config","eventBus","overlays","_providers","_eventBus","_overlays","scale","min","max","_overlaysConfig","position","right","top","_current","_init","$inject","prototype","self","on","e","selection","newSelection","length","open","close","elements","isOpen","element","current","registerProvider","provider","push","getEntries","entries","getContextPadEntries","entry","id","trigger","action","autoActivate","handler","originalEvent","button","delegateTarget","target","preventDefault","force","_updateAndOpen","pad","getPad","html","grouping","group","control","container","appendChild","className","addClasses","title","imageUrl","add","fire","overlaysConfig","bind","stopPropagation","_overlayId","get","remove","classNames","actualClassNames","split","cls"],"mappings":"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","sourcesContent":["import {\n  assign,\n  isFunction,\n  isArray,\n  forEach,\n  isDefined\n} from 'min-dash';\n\nimport {\n  delegate as domDelegate,\n  event as domEvent,\n  attr as domAttr,\n  query as domQuery,\n  classes as domClasses,\n  domify as domify\n} from 'min-dom';\n\nvar entrySelector = '.entry';\n\n\n/**\n * A context pad that displays element specific, contextual actions next\n * to a diagram element.\n *\n * @param {Object} config\n * @param {Boolean|Object} [config.scale={ min: 1.0, max: 1.5 }]\n * @param {Number} [config.scale.min]\n * @param {Number} [config.scale.max]\n * @param {EventBus} eventBus\n * @param {Overlays} overlays\n */\nexport default function ContextPad(config, eventBus, overlays) {\n\n  this._providers = [];\n\n  this._eventBus = eventBus;\n  this._overlays = overlays;\n\n  var scale = isDefined(config && config.scale) ? config.scale : {\n    min: 1,\n    max: 1.5\n  };\n\n  this._overlaysConfig = {\n    position: {\n      right: -9,\n      top: -6\n    },\n    scale: scale\n  };\n\n  this._current = null;\n\n  this._init();\n}\n\nContextPad.$inject = [\n  'config.contextPad',\n  'eventBus',\n  'overlays'\n];\n\n\n/**\n * Registers events needed for interaction with other components\n */\nContextPad.prototype._init = function() {\n\n  var eventBus = this._eventBus;\n\n  var self = this;\n\n  eventBus.on('selection.changed', function(e) {\n\n    var selection = e.newSelection;\n\n    if (selection.length === 1) {\n      self.open(selection[0]);\n    } else {\n      self.close();\n    }\n  });\n\n  eventBus.on('elements.delete', function(event) {\n    var elements = event.elements;\n\n    forEach(elements, function(e) {\n      if (self.isOpen(e)) {\n        self.close();\n      }\n    });\n  });\n\n  eventBus.on('element.changed', function(event) {\n    var element = event.element,\n        current = self._current;\n\n    // force reopen if element for which we are currently opened changed\n    if (current && current.element === element) {\n      self.open(element, true);\n    }\n  });\n};\n\n\n/**\n * Register a provider with the context pad\n *\n * @param  {ContextPadProvider} provider\n */\nContextPad.prototype.registerProvider = function(provider) {\n  this._providers.push(provider);\n};\n\n\n/**\n * Returns the context pad entries for a given element\n *\n * @param {djs.element.Base} element\n *\n * @return {Array<ContextPadEntryDescriptor>} list of entries\n */\nContextPad.prototype.getEntries = function(element) {\n  var entries = {};\n\n  // loop through all providers and their entries.\n  // group entries by id so that overriding an entry is possible\n  forEach(this._providers, function(provider) {\n    var e = provider.getContextPadEntries(element);\n\n    forEach(e, function(entry, id) {\n      entries[id] = entry;\n    });\n  });\n\n  return entries;\n};\n\n\n/**\n * Trigger an action available on the opened context pad\n *\n * @param  {String} action\n * @param  {Event} event\n * @param  {Boolean} [autoActivate=false]\n */\nContextPad.prototype.trigger = function(action, event, autoActivate) {\n\n  var element = this._current.element,\n      entries = this._current.entries,\n      entry,\n      handler,\n      originalEvent,\n      button = event.delegateTarget || event.target;\n\n  if (!button) {\n    return event.preventDefault();\n  }\n\n  entry = entries[domAttr(button, 'data-action')];\n  handler = entry.action;\n\n  originalEvent = event.originalEvent || event;\n\n  // simple action (via callback function)\n  if (isFunction(handler)) {\n    if (action === 'click') {\n      return handler(originalEvent, element, autoActivate);\n    }\n  } else {\n    if (handler[action]) {\n      return handler[action](originalEvent, element, autoActivate);\n    }\n  }\n\n  // silence other actions\n  event.preventDefault();\n};\n\n\n/**\n * Open the context pad for the given element\n *\n * @param {djs.model.Base} element\n * @param {Boolean} force if true, force reopening the context pad\n */\nContextPad.prototype.open = function(element, force) {\n  if (!force && this.isOpen(element)) {\n    return;\n  }\n\n  this.close();\n  this._updateAndOpen(element);\n};\n\n\nContextPad.prototype._updateAndOpen = function(element) {\n\n  var entries = this.getEntries(element),\n      pad = this.getPad(element),\n      html = pad.html;\n\n  forEach(entries, function(entry, id) {\n    var grouping = entry.group || 'default',\n        control = domify(entry.html || '<div class=\"entry\" draggable=\"true\"></div>'),\n        container;\n\n    domAttr(control, 'data-action', id);\n\n    container = domQuery('[data-group=' + grouping + ']', html);\n    if (!container) {\n      container = domify('<div class=\"group\" data-group=\"' + grouping + '\"></div>');\n      html.appendChild(container);\n    }\n\n    container.appendChild(control);\n\n    if (entry.className) {\n      addClasses(control, entry.className);\n    }\n\n    if (entry.title) {\n      domAttr(control, 'title', entry.title);\n    }\n\n    if (entry.imageUrl) {\n      control.appendChild(domify('<img src=\"' + entry.imageUrl + '\">'));\n    }\n  });\n\n  domClasses(html).add('open');\n\n  this._current = {\n    element: element,\n    pad: pad,\n    entries: entries\n  };\n\n  this._eventBus.fire('contextPad.open', { current: this._current });\n};\n\n\nContextPad.prototype.getPad = function(element) {\n  if (this.isOpen()) {\n    return this._current.pad;\n  }\n\n  var self = this;\n\n  var overlays = this._overlays;\n\n  var html = domify('<div class=\"djs-context-pad\"></div>');\n\n  var overlaysConfig = assign({\n    html: html\n  }, this._overlaysConfig);\n\n  domDelegate.bind(html, entrySelector, 'click', function(event) {\n    self.trigger('click', event);\n  });\n\n  domDelegate.bind(html, entrySelector, 'dragstart', function(event) {\n    self.trigger('dragstart', event);\n  });\n\n  // stop propagation of mouse events\n  domEvent.bind(html, 'mousedown', function(event) {\n    event.stopPropagation();\n  });\n\n  this._overlayId = overlays.add(element, 'context-pad', overlaysConfig);\n\n  var pad = overlays.get(this._overlayId);\n\n  this._eventBus.fire('contextPad.create', { element: element, pad: pad });\n\n  return pad;\n};\n\n\n/**\n * Close the context pad\n */\nContextPad.prototype.close = function() {\n  if (!this.isOpen()) {\n    return;\n  }\n\n  this._overlays.remove(this._overlayId);\n\n  this._overlayId = null;\n\n  this._eventBus.fire('contextPad.close', { current: this._current });\n\n  this._current = null;\n};\n\n/**\n * Check if pad is open. If element is given, will check\n * if pad is opened with given element.\n *\n * @param {Element} element\n * @return {Boolean}\n */\nContextPad.prototype.isOpen = function(element) {\n  return !!this._current && (!element ? true : this._current.element === element);\n};\n\n\n\n\n// helpers //////////////////////\n\nfunction addClasses(element, classNames) {\n\n  var classes = domClasses(element);\n\n  var actualClassNames = isArray(classNames) ? classNames : classNames.split(/\\s+/g);\n  actualClassNames.forEach(function(cls) {\n    classes.add(cls);\n  });\n}"]},"metadata":{},"sourceType":"module"}