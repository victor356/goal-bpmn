{"ast":null,"code":"import inherits from 'inherits';\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { is } from '../../../util/ModelUtil';\nvar LOW_PRIORITY = 500,\n    HIGH_PRIORITY = 5000;\n/**\n * BPMN specific delete lane behavior\n */\n\nexport default function UpdateFlowNodeRefsBehavior(eventBus, modeling, translate) {\n  CommandInterceptor.call(this, eventBus);\n  /**\n   * Ok, this is it:\n   *\n   * We have to update the Lane#flowNodeRefs _and_\n   * FlowNode#lanes with every FlowNode move/resize and\n   * Lane move/resize.\n   *\n   * We want to group that stuff to recompute containments\n   * as efficient as possible.\n   *\n   * Yea!\n   */\n  // the update context\n\n  var context;\n\n  function initContext() {\n    context = context || new UpdateContext();\n    context.enter();\n    return context;\n  }\n\n  function getContext() {\n    if (!context) {\n      throw new Error(translate('out of bounds release'));\n    }\n\n    return context;\n  }\n\n  function releaseContext() {\n    if (!context) {\n      throw new Error(translate('out of bounds release'));\n    }\n\n    var triggerUpdate = context.leave();\n\n    if (triggerUpdate) {\n      modeling.updateLaneRefs(context.flowNodes, context.lanes);\n      context = null;\n    }\n\n    return triggerUpdate;\n  }\n\n  var laneRefUpdateEvents = ['spaceTool', 'lane.add', 'lane.resize', 'lane.split', 'elements.move', 'elements.delete', 'shape.create', 'shape.delete', 'shape.move', 'shape.resize']; // listen to a lot of stuff to group lane updates\n\n  this.preExecute(laneRefUpdateEvents, HIGH_PRIORITY, function (event) {\n    initContext();\n  });\n  this.postExecuted(laneRefUpdateEvents, LOW_PRIORITY, function (event) {\n    releaseContext();\n  }); // Mark flow nodes + lanes that need an update\n\n  this.preExecute(['shape.create', 'shape.move', 'shape.delete', 'shape.resize'], function (event) {\n    var context = event.context,\n        shape = context.shape;\n    var updateContext = getContext(); // no need to update labels\n\n    if (shape.labelTarget) {\n      return;\n    }\n\n    if (is(shape, 'bpmn:Lane')) {\n      updateContext.addLane(shape);\n    }\n\n    if (is(shape, 'bpmn:FlowNode')) {\n      updateContext.addFlowNode(shape);\n    }\n  });\n}\nUpdateFlowNodeRefsBehavior.$inject = ['eventBus', 'modeling', 'translate'];\ninherits(UpdateFlowNodeRefsBehavior, CommandInterceptor);\n\nfunction UpdateContext() {\n  this.flowNodes = [];\n  this.lanes = [];\n  this.counter = 0;\n\n  this.addLane = function (lane) {\n    this.lanes.push(lane);\n  };\n\n  this.addFlowNode = function (flowNode) {\n    this.flowNodes.push(flowNode);\n  };\n\n  this.enter = function () {\n    this.counter++;\n  };\n\n  this.leave = function () {\n    this.counter--;\n    return !this.counter;\n  };\n}","map":{"version":3,"sources":["C:/Users/Vittorio/Documents/GitHub/SPM2021-MTV/frontend/node_modules/bpmn-js/lib/features/modeling/behavior/UpdateFlowNodeRefsBehavior.js"],"names":["inherits","CommandInterceptor","is","LOW_PRIORITY","HIGH_PRIORITY","UpdateFlowNodeRefsBehavior","eventBus","modeling","translate","call","context","initContext","UpdateContext","enter","getContext","Error","releaseContext","triggerUpdate","leave","updateLaneRefs","flowNodes","lanes","laneRefUpdateEvents","preExecute","event","postExecuted","shape","updateContext","labelTarget","addLane","addFlowNode","$inject","counter","lane","push","flowNode"],"mappings":"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","sourcesContent":["import inherits from 'inherits';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  is\n} from '../../../util/ModelUtil';\n\nvar LOW_PRIORITY = 500,\n    HIGH_PRIORITY = 5000;\n\n\n/**\n * BPMN specific delete lane behavior\n */\nexport default function UpdateFlowNodeRefsBehavior(eventBus, modeling, translate) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Ok, this is it:\n   *\n   * We have to update the Lane#flowNodeRefs _and_\n   * FlowNode#lanes with every FlowNode move/resize and\n   * Lane move/resize.\n   *\n   * We want to group that stuff to recompute containments\n   * as efficient as possible.\n   *\n   * Yea!\n   */\n\n  // the update context\n  var context;\n\n\n  function initContext() {\n    context = context || new UpdateContext();\n    context.enter();\n\n    return context;\n  }\n\n  function getContext() {\n    if (!context) {\n      throw new Error(translate('out of bounds release'));\n    }\n\n    return context;\n  }\n\n  function releaseContext() {\n\n    if (!context) {\n      throw new Error(translate('out of bounds release'));\n    }\n\n    var triggerUpdate = context.leave();\n\n    if (triggerUpdate) {\n      modeling.updateLaneRefs(context.flowNodes, context.lanes);\n\n      context = null;\n    }\n\n    return triggerUpdate;\n  }\n\n\n  var laneRefUpdateEvents = [\n    'spaceTool',\n    'lane.add',\n    'lane.resize',\n    'lane.split',\n    'elements.move',\n    'elements.delete',\n    'shape.create',\n    'shape.delete',\n    'shape.move',\n    'shape.resize'\n  ];\n\n\n  // listen to a lot of stuff to group lane updates\n\n  this.preExecute(laneRefUpdateEvents, HIGH_PRIORITY, function(event) {\n    initContext();\n  });\n\n  this.postExecuted(laneRefUpdateEvents, LOW_PRIORITY, function(event) {\n    releaseContext();\n  });\n\n\n  // Mark flow nodes + lanes that need an update\n\n  this.preExecute([\n    'shape.create',\n    'shape.move',\n    'shape.delete',\n    'shape.resize'\n  ], function(event) {\n\n    var context = event.context,\n        shape = context.shape;\n\n    var updateContext = getContext();\n\n    // no need to update labels\n    if (shape.labelTarget) {\n      return;\n    }\n\n    if (is(shape, 'bpmn:Lane')) {\n      updateContext.addLane(shape);\n    }\n\n    if (is(shape, 'bpmn:FlowNode')) {\n      updateContext.addFlowNode(shape);\n    }\n  });\n}\n\nUpdateFlowNodeRefsBehavior.$inject = [\n  'eventBus',\n  'modeling' ,\n  'translate'\n];\n\ninherits(UpdateFlowNodeRefsBehavior, CommandInterceptor);\n\n\nfunction UpdateContext() {\n\n  this.flowNodes = [];\n  this.lanes = [];\n\n  this.counter = 0;\n\n  this.addLane = function(lane) {\n    this.lanes.push(lane);\n  };\n\n  this.addFlowNode = function(flowNode) {\n    this.flowNodes.push(flowNode);\n  };\n\n  this.enter = function() {\n    this.counter++;\n  };\n\n  this.leave = function() {\n    this.counter--;\n\n    return !this.counter;\n  };\n}"]},"metadata":{},"sourceType":"module"}