{"ast":null,"code":"import { forEach, assign, find, matchPattern } from 'min-dash';\nimport { delegate as domDelegate, domify, classes as domClasses, attr as domAttr, remove as domRemove } from 'min-dom';\nvar DATA_REF = 'data-id';\n/**\n * A popup menu that can be used to display a list of actions anywhere in the canvas.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n *\n * @class\n * @constructor\n */\n\nexport default function PopupMenu(eventBus, canvas) {\n  this._eventBus = eventBus;\n  this._canvas = canvas;\n  this._providers = {};\n  this._current = {};\n}\nPopupMenu.$inject = ['eventBus', 'canvas'];\n/**\n * Registers a popup menu provider\n *\n * @param  {String} id\n * @param  {Object} provider\n *\n * @example\n *\n * popupMenu.registerProvider('myMenuID', {\n *   getEntries: function(element) {\n *     return [\n *       {\n *         id: 'entry-1',\n *         label: 'My Entry',\n *         action: 'alert(\"I have been clicked!\")'\n *       }\n *     ];\n *   }\n * });\n */\n\nPopupMenu.prototype.registerProvider = function (id, provider) {\n  this._providers[id] = provider;\n};\n/**\n * Determine if the popup menu has entries.\n *\n * @return {Boolean} true if empty\n */\n\n\nPopupMenu.prototype.isEmpty = function (element, providerId) {\n  if (!element) {\n    throw new Error('element parameter is missing');\n  }\n\n  if (!providerId) {\n    throw new Error('providerId parameter is missing');\n  }\n\n  var provider = this._providers[providerId];\n  var entries = provider.getEntries(element),\n      headerEntries = provider.getHeaderEntries && provider.getHeaderEntries(element);\n  var hasEntries = entries.length > 0,\n      hasHeaderEntries = headerEntries && headerEntries.length > 0;\n  return !hasEntries && !hasHeaderEntries;\n};\n/**\n * Create entries and open popup menu at given position\n *\n * @param  {Object} element\n * @param  {String} id provider id\n * @param  {Object} position\n *\n * @return {Object} popup menu instance\n */\n\n\nPopupMenu.prototype.open = function (element, id, position) {\n  var provider = this._providers[id];\n\n  if (!element) {\n    throw new Error('Element is missing');\n  }\n\n  if (!provider) {\n    throw new Error('Provider is not registered: ' + id);\n  }\n\n  if (!position) {\n    throw new Error('the position argument is missing');\n  }\n\n  if (this.isOpen()) {\n    this.close();\n  }\n\n  this._emit('open');\n\n  var current = this._current = {\n    provider: provider,\n    className: id,\n    element: element,\n    position: position\n  };\n\n  if (provider.getHeaderEntries) {\n    current.headerEntries = provider.getHeaderEntries(element);\n  }\n\n  current.entries = provider.getEntries(element);\n  current.container = this._createContainer();\n  var headerEntries = current.headerEntries || [],\n      entries = current.entries || [];\n\n  if (headerEntries.length) {\n    current.container.appendChild(this._createEntries(current.headerEntries, 'djs-popup-header'));\n  }\n\n  if (entries.length) {\n    current.container.appendChild(this._createEntries(current.entries, 'djs-popup-body'));\n  }\n\n  var canvas = this._canvas,\n      parent = canvas.getContainer();\n\n  this._attachContainer(current.container, parent, position.cursor);\n};\n/**\n * Removes the popup menu and unbinds the event handlers.\n */\n\n\nPopupMenu.prototype.close = function () {\n  if (!this.isOpen()) {\n    return;\n  }\n\n  this._emit('close');\n\n  this._unbindHandlers();\n\n  domRemove(this._current.container);\n  this._current.container = null;\n};\n/**\n * Determine if an open popup menu exist.\n *\n * @return {Boolean} true if open\n */\n\n\nPopupMenu.prototype.isOpen = function () {\n  return !!this._current.container;\n};\n/**\n * Trigger an action associated with an entry.\n *\n * @param {Object} event\n *\n * @return the result of the action callback, if any\n */\n\n\nPopupMenu.prototype.trigger = function (event) {\n  // silence other actions\n  event.preventDefault();\n  var element = event.delegateTarget || event.target,\n      entryId = domAttr(element, DATA_REF);\n\n  var entry = this._getEntry(entryId);\n\n  if (entry.action) {\n    return entry.action.call(null, event, entry);\n  }\n};\n/**\n * Gets an entry instance (either entry or headerEntry) by id.\n *\n * @param  {String} entryId\n *\n * @return {Object} entry instance\n */\n\n\nPopupMenu.prototype._getEntry = function (entryId) {\n  var search = matchPattern({\n    id: entryId\n  });\n  var entry = find(this._current.entries, search) || find(this._current.headerEntries, search);\n\n  if (!entry) {\n    throw new Error('entry not found');\n  }\n\n  return entry;\n};\n\nPopupMenu.prototype._emit = function (eventName) {\n  this._eventBus.fire('popupMenu.' + eventName);\n};\n/**\n * Creates the popup menu container.\n *\n * @return {Object} a DOM container\n */\n\n\nPopupMenu.prototype._createContainer = function () {\n  var container = domify('<div class=\"djs-popup\">'),\n      position = this._current.position,\n      className = this._current.className;\n  assign(container.style, {\n    position: 'absolute',\n    left: position.x + 'px',\n    top: position.y + 'px',\n    visibility: 'hidden'\n  });\n  domClasses(container).add(className);\n  return container;\n};\n/**\n * Attaches the container to the DOM and binds the event handlers.\n *\n * @param {Object} container\n * @param {Object} parent\n */\n\n\nPopupMenu.prototype._attachContainer = function (container, parent, cursor) {\n  var self = this; // Event handler\n\n  domDelegate.bind(container, '.entry', 'click', function (event) {\n    self.trigger(event);\n  }); // apply canvas zoom level\n\n  var zoom = this._canvas.zoom();\n\n  container.style.transformOrigin = 'top left';\n  container.style.transform = 'scale(' + zoom + ')'; // Attach to DOM\n\n  parent.appendChild(container);\n\n  if (cursor) {\n    this._assureIsInbounds(container, cursor);\n  } // Add Handler\n\n\n  this._bindHandlers();\n};\n/**\n * Make sure that the menu is always fully shown\n *\n * @method function\n *\n * @param  {Object} container\n * @param  {Position} cursor {x, y}\n */\n\n\nPopupMenu.prototype._assureIsInbounds = function (container, cursor) {\n  var canvas = this._canvas,\n      clientRect = canvas._container.getBoundingClientRect();\n\n  var containerX = container.offsetLeft,\n      containerY = container.offsetTop,\n      containerWidth = container.scrollWidth,\n      containerHeight = container.scrollHeight,\n      overAxis = {},\n      left,\n      top;\n  var cursorPosition = {\n    x: cursor.x - clientRect.left,\n    y: cursor.y - clientRect.top\n  };\n\n  if (containerX + containerWidth > clientRect.width) {\n    overAxis.x = true;\n  }\n\n  if (containerY + containerHeight > clientRect.height) {\n    overAxis.y = true;\n  }\n\n  if (overAxis.x && overAxis.y) {\n    left = cursorPosition.x - containerWidth + 'px';\n    top = cursorPosition.y - containerHeight + 'px';\n  } else if (overAxis.x) {\n    left = cursorPosition.x - containerWidth + 'px';\n    top = cursorPosition.y + 'px';\n  } else if (overAxis.y && cursorPosition.y < containerHeight) {\n    left = cursorPosition.x + 'px';\n    top = 10 + 'px';\n  } else if (overAxis.y) {\n    left = cursorPosition.x + 'px';\n    top = cursorPosition.y - containerHeight + 'px';\n  }\n\n  assign(container.style, {\n    left: left,\n    top: top\n  }, {\n    visibility: 'visible',\n    'z-index': 1000\n  });\n};\n/**\n * Creates a list of entries and returns them as a DOM container.\n *\n * @param {Array<Object>} entries an array of entry objects\n * @param {String} className the class name of the entry container\n *\n * @return {Object} a DOM container\n */\n\n\nPopupMenu.prototype._createEntries = function (entries, className) {\n  var entriesContainer = domify('<div>'),\n      self = this;\n  domClasses(entriesContainer).add(className);\n  forEach(entries, function (entry) {\n    var entryContainer = self._createEntry(entry, entriesContainer);\n\n    entriesContainer.appendChild(entryContainer);\n  });\n  return entriesContainer;\n};\n/**\n * Creates a single entry and returns it as a DOM container.\n *\n * @param  {Object} entry\n *\n * @return {Object} a DOM container\n */\n\n\nPopupMenu.prototype._createEntry = function (entry) {\n  if (!entry.id) {\n    throw new Error('every entry must have the id property set');\n  }\n\n  var entryContainer = domify('<div>'),\n      entryClasses = domClasses(entryContainer);\n  entryClasses.add('entry');\n\n  if (entry.className) {\n    entry.className.split(' ').forEach(function (className) {\n      entryClasses.add(className);\n    });\n  }\n\n  domAttr(entryContainer, DATA_REF, entry.id);\n\n  if (entry.label) {\n    var label = domify('<span>');\n    label.textContent = entry.label;\n    entryContainer.appendChild(label);\n  }\n\n  if (entry.imageUrl) {\n    entryContainer.appendChild(domify('<img src=\"' + entry.imageUrl + '\" />'));\n  }\n\n  if (entry.active === true) {\n    entryClasses.add('active');\n  }\n\n  if (entry.disabled === true) {\n    entryClasses.add('disabled');\n  }\n\n  if (entry.title) {\n    entryContainer.title = entry.title;\n  }\n\n  return entryContainer;\n};\n/**\n * Binds the `close` method to 'contextPad.close' & 'canvas.viewbox.changed'.\n */\n\n\nPopupMenu.prototype._bindHandlers = function () {\n  var eventBus = this._eventBus,\n      self = this;\n\n  function close() {\n    self.close();\n  }\n\n  eventBus.once('contextPad.close', close);\n  eventBus.once('canvas.viewbox.changing', close);\n  eventBus.once('commandStack.changed', close);\n};\n/**\n * Unbinds the `close` method to 'contextPad.close' & 'canvas.viewbox.changing'.\n */\n\n\nPopupMenu.prototype._unbindHandlers = function () {\n  var eventBus = this._eventBus,\n      self = this;\n\n  function close() {\n    self.close();\n  }\n\n  eventBus.off('contextPad.close', close);\n  eventBus.off('canvas.viewbox.changed', close);\n  eventBus.off('commandStack.changed', close);\n};","map":{"version":3,"sources":["C:/Users/Vittorio/Documents/GitHub/SPM2021-MTV/frontend/node_modules/bpmn-js/node_modules/diagram-js/lib/features/popup-menu/PopupMenu.js"],"names":["forEach","assign","find","matchPattern","delegate","domDelegate","domify","classes","domClasses","attr","domAttr","remove","domRemove","DATA_REF","PopupMenu","eventBus","canvas","_eventBus","_canvas","_providers","_current","$inject","prototype","registerProvider","id","provider","isEmpty","element","providerId","Error","entries","getEntries","headerEntries","getHeaderEntries","hasEntries","length","hasHeaderEntries","open","position","isOpen","close","_emit","current","className","container","_createContainer","appendChild","_createEntries","parent","getContainer","_attachContainer","cursor","_unbindHandlers","trigger","event","preventDefault","delegateTarget","target","entryId","entry","_getEntry","action","call","search","eventName","fire","style","left","x","top","y","visibility","add","self","bind","zoom","transformOrigin","transform","_assureIsInbounds","_bindHandlers","clientRect","_container","getBoundingClientRect","containerX","offsetLeft","containerY","offsetTop","containerWidth","scrollWidth","containerHeight","scrollHeight","overAxis","cursorPosition","width","height","entriesContainer","entryContainer","_createEntry","entryClasses","split","label","textContent","imageUrl","active","disabled","title","once","off"],"mappings":"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","sourcesContent":["import {\n  forEach,\n  assign,\n  find,\n  matchPattern,\n} from 'min-dash';\n\nimport {\n  delegate as domDelegate,\n  domify as domify,\n  classes as domClasses,\n  attr as domAttr,\n  remove as domRemove\n} from 'min-dom';\n\nvar DATA_REF = 'data-id';\n\n\n/**\n * A popup menu that can be used to display a list of actions anywhere in the canvas.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n *\n * @class\n * @constructor\n */\nexport default function PopupMenu(eventBus, canvas) {\n\n  this._eventBus = eventBus;\n  this._canvas = canvas;\n  this._providers = {};\n  this._current = {};\n}\n\nPopupMenu.$inject = [ 'eventBus', 'canvas' ];\n\n/**\n * Registers a popup menu provider\n *\n * @param  {String} id\n * @param  {Object} provider\n *\n * @example\n *\n * popupMenu.registerProvider('myMenuID', {\n *   getEntries: function(element) {\n *     return [\n *       {\n *         id: 'entry-1',\n *         label: 'My Entry',\n *         action: 'alert(\"I have been clicked!\")'\n *       }\n *     ];\n *   }\n * });\n */\nPopupMenu.prototype.registerProvider = function(id, provider) {\n  this._providers[id] = provider;\n};\n\n\n/**\n * Determine if the popup menu has entries.\n *\n * @return {Boolean} true if empty\n */\nPopupMenu.prototype.isEmpty = function(element, providerId) {\n  if (!element) {\n    throw new Error('element parameter is missing');\n  }\n\n  if (!providerId) {\n    throw new Error('providerId parameter is missing');\n  }\n\n  var provider = this._providers[providerId];\n\n  var entries = provider.getEntries(element),\n      headerEntries = provider.getHeaderEntries && provider.getHeaderEntries(element);\n\n  var hasEntries = entries.length > 0,\n      hasHeaderEntries = headerEntries && headerEntries.length > 0;\n\n  return !hasEntries && !hasHeaderEntries;\n};\n\n\n/**\n * Create entries and open popup menu at given position\n *\n * @param  {Object} element\n * @param  {String} id provider id\n * @param  {Object} position\n *\n * @return {Object} popup menu instance\n */\nPopupMenu.prototype.open = function(element, id, position) {\n\n  var provider = this._providers[id];\n\n  if (!element) {\n    throw new Error('Element is missing');\n  }\n\n  if (!provider) {\n    throw new Error('Provider is not registered: ' + id);\n  }\n\n  if (!position) {\n    throw new Error('the position argument is missing');\n  }\n\n  if (this.isOpen()) {\n    this.close();\n  }\n\n  this._emit('open');\n\n  var current = this._current = {\n    provider: provider,\n    className: id,\n    element: element,\n    position: position\n  };\n\n  if (provider.getHeaderEntries) {\n    current.headerEntries = provider.getHeaderEntries(element);\n  }\n\n  current.entries = provider.getEntries(element);\n\n  current.container = this._createContainer();\n\n  var headerEntries = current.headerEntries || [],\n      entries = current.entries || [];\n\n  if (headerEntries.length) {\n    current.container.appendChild(\n      this._createEntries(current.headerEntries, 'djs-popup-header')\n    );\n  }\n\n  if (entries.length) {\n    current.container.appendChild(\n      this._createEntries(current.entries, 'djs-popup-body')\n    );\n  }\n\n  var canvas = this._canvas,\n      parent = canvas.getContainer();\n\n  this._attachContainer(current.container, parent, position.cursor);\n};\n\n\n/**\n * Removes the popup menu and unbinds the event handlers.\n */\nPopupMenu.prototype.close = function() {\n\n  if (!this.isOpen()) {\n    return;\n  }\n\n  this._emit('close');\n\n  this._unbindHandlers();\n  domRemove(this._current.container);\n  this._current.container = null;\n};\n\n\n/**\n * Determine if an open popup menu exist.\n *\n * @return {Boolean} true if open\n */\nPopupMenu.prototype.isOpen = function() {\n  return !!this._current.container;\n};\n\n\n/**\n * Trigger an action associated with an entry.\n *\n * @param {Object} event\n *\n * @return the result of the action callback, if any\n */\nPopupMenu.prototype.trigger = function(event) {\n\n  // silence other actions\n  event.preventDefault();\n\n  var element = event.delegateTarget || event.target,\n      entryId = domAttr(element, DATA_REF);\n\n  var entry = this._getEntry(entryId);\n\n  if (entry.action) {\n    return entry.action.call(null, event, entry);\n  }\n};\n\n/**\n * Gets an entry instance (either entry or headerEntry) by id.\n *\n * @param  {String} entryId\n *\n * @return {Object} entry instance\n */\nPopupMenu.prototype._getEntry = function(entryId) {\n\n  var search = matchPattern({ id: entryId });\n\n  var entry = find(this._current.entries, search) || find(this._current.headerEntries, search);\n\n  if (!entry) {\n    throw new Error('entry not found');\n  }\n\n  return entry;\n};\n\nPopupMenu.prototype._emit = function(eventName) {\n  this._eventBus.fire('popupMenu.' + eventName);\n};\n\n/**\n * Creates the popup menu container.\n *\n * @return {Object} a DOM container\n */\nPopupMenu.prototype._createContainer = function() {\n  var container = domify('<div class=\"djs-popup\">'),\n      position = this._current.position,\n      className = this._current.className;\n\n  assign(container.style, {\n    position: 'absolute',\n    left: position.x + 'px',\n    top: position.y + 'px',\n    visibility: 'hidden'\n  });\n\n  domClasses(container).add(className);\n\n  return container;\n};\n\n\n/**\n * Attaches the container to the DOM and binds the event handlers.\n *\n * @param {Object} container\n * @param {Object} parent\n */\nPopupMenu.prototype._attachContainer = function(container, parent, cursor) {\n  var self = this;\n\n  // Event handler\n  domDelegate.bind(container, '.entry' ,'click', function(event) {\n    self.trigger(event);\n  });\n\n  // apply canvas zoom level\n  var zoom = this._canvas.zoom();\n\n  container.style.transformOrigin = 'top left';\n  container.style.transform = 'scale(' + zoom + ')';\n\n  // Attach to DOM\n  parent.appendChild(container);\n\n  if (cursor) {\n    this._assureIsInbounds(container, cursor);\n  }\n\n  // Add Handler\n  this._bindHandlers();\n};\n\n\n/**\n * Make sure that the menu is always fully shown\n *\n * @method function\n *\n * @param  {Object} container\n * @param  {Position} cursor {x, y}\n */\nPopupMenu.prototype._assureIsInbounds = function(container, cursor) {\n  var canvas = this._canvas,\n      clientRect = canvas._container.getBoundingClientRect();\n\n  var containerX = container.offsetLeft,\n      containerY = container.offsetTop,\n      containerWidth = container.scrollWidth,\n      containerHeight = container.scrollHeight,\n      overAxis = {},\n      left, top;\n\n  var cursorPosition = {\n    x: cursor.x - clientRect.left,\n    y: cursor.y - clientRect.top\n  };\n\n  if (containerX + containerWidth > clientRect.width) {\n    overAxis.x = true;\n  }\n\n  if (containerY + containerHeight > clientRect.height) {\n    overAxis.y = true;\n  }\n\n  if (overAxis.x && overAxis.y) {\n    left = cursorPosition.x - containerWidth + 'px';\n    top = cursorPosition.y - containerHeight + 'px';\n  } else if (overAxis.x) {\n    left = cursorPosition.x - containerWidth + 'px';\n    top = cursorPosition.y + 'px';\n  } else if (overAxis.y && cursorPosition.y < containerHeight) {\n    left = cursorPosition.x + 'px';\n    top = 10 + 'px';\n  } else if (overAxis.y) {\n    left = cursorPosition.x + 'px';\n    top = cursorPosition.y - containerHeight + 'px';\n  }\n\n  assign(container.style, { left: left, top: top }, { visibility: 'visible', 'z-index': 1000 });\n};\n\n\n/**\n * Creates a list of entries and returns them as a DOM container.\n *\n * @param {Array<Object>} entries an array of entry objects\n * @param {String} className the class name of the entry container\n *\n * @return {Object} a DOM container\n */\nPopupMenu.prototype._createEntries = function(entries, className) {\n\n  var entriesContainer = domify('<div>'),\n      self = this;\n\n  domClasses(entriesContainer).add(className);\n\n  forEach(entries, function(entry) {\n    var entryContainer = self._createEntry(entry, entriesContainer);\n    entriesContainer.appendChild(entryContainer);\n  });\n\n  return entriesContainer;\n};\n\n\n/**\n * Creates a single entry and returns it as a DOM container.\n *\n * @param  {Object} entry\n *\n * @return {Object} a DOM container\n */\nPopupMenu.prototype._createEntry = function(entry) {\n\n  if (!entry.id) {\n    throw new Error ('every entry must have the id property set');\n  }\n\n  var entryContainer = domify('<div>'),\n      entryClasses = domClasses(entryContainer);\n\n  entryClasses.add('entry');\n\n  if (entry.className) {\n    entry.className.split(' ').forEach(function(className) {\n      entryClasses.add(className);\n    });\n  }\n\n  domAttr(entryContainer, DATA_REF, entry.id);\n\n  if (entry.label) {\n    var label = domify('<span>');\n    label.textContent = entry.label;\n    entryContainer.appendChild(label);\n  }\n\n  if (entry.imageUrl) {\n    entryContainer.appendChild(domify('<img src=\"' + entry.imageUrl + '\" />'));\n  }\n\n  if (entry.active === true) {\n    entryClasses.add('active');\n  }\n\n  if (entry.disabled === true) {\n    entryClasses.add('disabled');\n  }\n\n  if (entry.title) {\n    entryContainer.title = entry.title;\n  }\n\n  return entryContainer;\n};\n\n\n/**\n * Binds the `close` method to 'contextPad.close' & 'canvas.viewbox.changed'.\n */\nPopupMenu.prototype._bindHandlers = function() {\n\n  var eventBus = this._eventBus,\n      self = this;\n\n  function close() {\n    self.close();\n  }\n\n  eventBus.once('contextPad.close', close);\n  eventBus.once('canvas.viewbox.changing', close);\n  eventBus.once('commandStack.changed', close);\n};\n\n\n/**\n * Unbinds the `close` method to 'contextPad.close' & 'canvas.viewbox.changing'.\n */\nPopupMenu.prototype._unbindHandlers = function() {\n\n  var eventBus = this._eventBus,\n      self = this;\n\n  function close() {\n    self.close();\n  }\n\n  eventBus.off('contextPad.close', close);\n  eventBus.off('canvas.viewbox.changed', close);\n  eventBus.off('commandStack.changed', close);\n};\n"]},"metadata":{},"sourceType":"module"}