{"ast":null,"code":"import { forEach, sortBy } from 'min-dash';\n/**\n * A handler that distributes elements evenly.\n */\n\nexport default function DistributeElements(modeling) {\n  this._modeling = modeling;\n}\nDistributeElements.$inject = ['modeling'];\nvar OFF_AXIS = {\n  x: 'y',\n  y: 'x'\n};\n\nDistributeElements.prototype.preExecute = function (context) {\n  var modeling = this._modeling;\n  var groups = context.groups,\n      axis = context.axis,\n      dimension = context.dimension;\n\n  function updateRange(group, element) {\n    group.range.min = Math.min(element[axis], group.range.min);\n    group.range.max = Math.max(element[axis] + element[dimension], group.range.max);\n  }\n\n  function center(element) {\n    return element[axis] + element[dimension] / 2;\n  }\n\n  function lastIdx(arr) {\n    return arr.length - 1;\n  }\n\n  function rangeDiff(range) {\n    return range.max - range.min;\n  }\n\n  function centerElement(refCenter, element) {\n    var delta = {\n      y: 0\n    };\n    delta[axis] = refCenter - center(element);\n\n    if (delta[axis]) {\n      delta[OFF_AXIS[axis]] = 0;\n      modeling.moveElements([element], delta, element.parent);\n    }\n  }\n\n  var firstGroup = groups[0],\n      lastGroupIdx = lastIdx(groups),\n      lastGroup = groups[lastGroupIdx];\n  var margin,\n      spaceInBetween,\n      groupsSize = 0; // the size of each range\n\n  forEach(groups, function (group, idx) {\n    var sortedElements, refElem, refCenter;\n\n    if (group.elements.length < 2) {\n      if (idx && idx !== groups.length - 1) {\n        updateRange(group, group.elements[0]);\n        groupsSize += rangeDiff(group.range);\n      }\n\n      return;\n    }\n\n    sortedElements = sortBy(group.elements, axis);\n    refElem = sortedElements[0];\n\n    if (idx === lastGroupIdx) {\n      refElem = sortedElements[lastIdx(sortedElements)];\n    }\n\n    refCenter = center(refElem); // wanna update the ranges after the shapes have been centered\n\n    group.range = null;\n    forEach(sortedElements, function (element) {\n      centerElement(refCenter, element);\n\n      if (group.range === null) {\n        group.range = {\n          min: element[axis],\n          max: element[axis] + element[dimension]\n        };\n        return;\n      } // update group's range after centering the range elements\n\n\n      updateRange(group, element);\n    });\n\n    if (idx && idx !== groups.length - 1) {\n      groupsSize += rangeDiff(group.range);\n    }\n  });\n  spaceInBetween = Math.abs(lastGroup.range.min - firstGroup.range.max);\n  margin = Math.round((spaceInBetween - groupsSize) / (groups.length - 1));\n\n  if (margin < groups.length - 1) {\n    return;\n  }\n\n  forEach(groups, function (group, groupIdx) {\n    var delta = {},\n        prevGroup;\n\n    if (group === firstGroup || group === lastGroup) {\n      return;\n    }\n\n    prevGroup = groups[groupIdx - 1];\n    group.range.max = 0;\n    forEach(group.elements, function (element, idx) {\n      delta[OFF_AXIS[axis]] = 0;\n      delta[axis] = prevGroup.range.max - element[axis] + margin;\n\n      if (group.range.min !== element[axis]) {\n        delta[axis] += element[axis] - group.range.min;\n      }\n\n      if (delta[axis]) {\n        modeling.moveElements([element], delta, element.parent);\n      }\n\n      group.range.max = Math.max(element[axis] + element[dimension], idx ? group.range.max : 0);\n    });\n  });\n};\n\nDistributeElements.prototype.postExecute = function (context) {};","map":{"version":3,"sources":["C:/Users/Vittorio/Documents/GitHub/goal-bpmn/frontend/node_modules/diagram-js/lib/features/modeling/cmd/DistributeElementsHandler.js"],"names":["forEach","sortBy","DistributeElements","modeling","_modeling","$inject","OFF_AXIS","x","y","prototype","preExecute","context","groups","axis","dimension","updateRange","group","element","range","min","Math","max","center","lastIdx","arr","length","rangeDiff","centerElement","refCenter","delta","moveElements","parent","firstGroup","lastGroupIdx","lastGroup","margin","spaceInBetween","groupsSize","idx","sortedElements","refElem","elements","abs","round","groupIdx","prevGroup","postExecute"],"mappings":"AAAA,SACEA,OADF,EAEEC,MAFF,QAGO,UAHP;AAMA;AACA;AACA;;AACA,eAAe,SAASC,kBAAT,CAA4BC,QAA5B,EAAsC;AACnD,OAAKC,SAAL,GAAiBD,QAAjB;AACD;AAEDD,kBAAkB,CAACG,OAAnB,GAA6B,CAAE,UAAF,CAA7B;AAEA,IAAIC,QAAQ,GAAG;AACbC,EAAAA,CAAC,EAAE,GADU;AAEbC,EAAAA,CAAC,EAAE;AAFU,CAAf;;AAKAN,kBAAkB,CAACO,SAAnB,CAA6BC,UAA7B,GAA0C,UAASC,OAAT,EAAkB;AAC1D,MAAIR,QAAQ,GAAG,KAAKC,SAApB;AAEA,MAAIQ,MAAM,GAAGD,OAAO,CAACC,MAArB;AAAA,MACIC,IAAI,GAAGF,OAAO,CAACE,IADnB;AAAA,MAEIC,SAAS,GAAGH,OAAO,CAACG,SAFxB;;AAIA,WAASC,WAAT,CAAqBC,KAArB,EAA4BC,OAA5B,EAAqC;AACnCD,IAAAA,KAAK,CAACE,KAAN,CAAYC,GAAZ,GAAkBC,IAAI,CAACD,GAAL,CAASF,OAAO,CAACJ,IAAD,CAAhB,EAAwBG,KAAK,CAACE,KAAN,CAAYC,GAApC,CAAlB;AACAH,IAAAA,KAAK,CAACE,KAAN,CAAYG,GAAZ,GAAkBD,IAAI,CAACC,GAAL,CAASJ,OAAO,CAACJ,IAAD,CAAP,GAAgBI,OAAO,CAACH,SAAD,CAAhC,EAA6CE,KAAK,CAACE,KAAN,CAAYG,GAAzD,CAAlB;AACD;;AAED,WAASC,MAAT,CAAgBL,OAAhB,EAAyB;AACvB,WAAOA,OAAO,CAACJ,IAAD,CAAP,GAAgBI,OAAO,CAACH,SAAD,CAAP,GAAqB,CAA5C;AACD;;AAED,WAASS,OAAT,CAAiBC,GAAjB,EAAsB;AACpB,WAAOA,GAAG,CAACC,MAAJ,GAAa,CAApB;AACD;;AAED,WAASC,SAAT,CAAmBR,KAAnB,EAA0B;AACxB,WAAOA,KAAK,CAACG,GAAN,GAAYH,KAAK,CAACC,GAAzB;AACD;;AAED,WAASQ,aAAT,CAAuBC,SAAvB,EAAkCX,OAAlC,EAA2C;AACzC,QAAIY,KAAK,GAAG;AAAErB,MAAAA,CAAC,EAAE;AAAL,KAAZ;AAEAqB,IAAAA,KAAK,CAAChB,IAAD,CAAL,GAAce,SAAS,GAAGN,MAAM,CAACL,OAAD,CAAhC;;AAEA,QAAIY,KAAK,CAAChB,IAAD,CAAT,EAAiB;AAEfgB,MAAAA,KAAK,CAACvB,QAAQ,CAACO,IAAD,CAAT,CAAL,GAAwB,CAAxB;AAEAV,MAAAA,QAAQ,CAAC2B,YAAT,CAAsB,CAAEb,OAAF,CAAtB,EAAmCY,KAAnC,EAA0CZ,OAAO,CAACc,MAAlD;AACD;AACF;;AAED,MAAIC,UAAU,GAAGpB,MAAM,CAAC,CAAD,CAAvB;AAAA,MACIqB,YAAY,GAAGV,OAAO,CAACX,MAAD,CAD1B;AAAA,MAEIsB,SAAS,GAAGtB,MAAM,CAAEqB,YAAF,CAFtB;AAIA,MAAIE,MAAJ;AAAA,MACIC,cADJ;AAAA,MAEIC,UAAU,GAAG,CAFjB,CAzC0D,CA2CtC;;AAEpBrC,EAAAA,OAAO,CAACY,MAAD,EAAS,UAASI,KAAT,EAAgBsB,GAAhB,EAAqB;AACnC,QAAIC,cAAJ,EACIC,OADJ,EAEIZ,SAFJ;;AAIA,QAAIZ,KAAK,CAACyB,QAAN,CAAehB,MAAf,GAAwB,CAA5B,EAA+B;AAC7B,UAAIa,GAAG,IAAIA,GAAG,KAAK1B,MAAM,CAACa,MAAP,GAAgB,CAAnC,EAAsC;AACpCV,QAAAA,WAAW,CAACC,KAAD,EAAQA,KAAK,CAACyB,QAAN,CAAe,CAAf,CAAR,CAAX;AAEAJ,QAAAA,UAAU,IAAIX,SAAS,CAACV,KAAK,CAACE,KAAP,CAAvB;AACD;;AACD;AACD;;AAEDqB,IAAAA,cAAc,GAAGtC,MAAM,CAACe,KAAK,CAACyB,QAAP,EAAiB5B,IAAjB,CAAvB;AAEA2B,IAAAA,OAAO,GAAGD,cAAc,CAAC,CAAD,CAAxB;;AAEA,QAAID,GAAG,KAAKL,YAAZ,EAA0B;AACxBO,MAAAA,OAAO,GAAGD,cAAc,CAAChB,OAAO,CAACgB,cAAD,CAAR,CAAxB;AACD;;AAEDX,IAAAA,SAAS,GAAGN,MAAM,CAACkB,OAAD,CAAlB,CAtBmC,CAwBnC;;AACAxB,IAAAA,KAAK,CAACE,KAAN,GAAc,IAAd;AAEAlB,IAAAA,OAAO,CAACuC,cAAD,EAAiB,UAAStB,OAAT,EAAkB;AAExCU,MAAAA,aAAa,CAACC,SAAD,EAAYX,OAAZ,CAAb;;AAEA,UAAID,KAAK,CAACE,KAAN,KAAgB,IAApB,EAA0B;AACxBF,QAAAA,KAAK,CAACE,KAAN,GAAc;AACZC,UAAAA,GAAG,EAAEF,OAAO,CAACJ,IAAD,CADA;AAEZQ,UAAAA,GAAG,EAAEJ,OAAO,CAACJ,IAAD,CAAP,GAAgBI,OAAO,CAACH,SAAD;AAFhB,SAAd;AAKA;AACD,OAXuC,CAaxC;;;AACAC,MAAAA,WAAW,CAACC,KAAD,EAAQC,OAAR,CAAX;AACD,KAfM,CAAP;;AAiBA,QAAIqB,GAAG,IAAIA,GAAG,KAAK1B,MAAM,CAACa,MAAP,GAAgB,CAAnC,EAAsC;AACpCY,MAAAA,UAAU,IAAIX,SAAS,CAACV,KAAK,CAACE,KAAP,CAAvB;AACD;AACF,GA/CM,CAAP;AAiDAkB,EAAAA,cAAc,GAAGhB,IAAI,CAACsB,GAAL,CAASR,SAAS,CAAChB,KAAV,CAAgBC,GAAhB,GAAsBa,UAAU,CAACd,KAAX,CAAiBG,GAAhD,CAAjB;AAEAc,EAAAA,MAAM,GAAGf,IAAI,CAACuB,KAAL,CAAW,CAACP,cAAc,GAAGC,UAAlB,KAAiCzB,MAAM,CAACa,MAAP,GAAgB,CAAjD,CAAX,CAAT;;AAEA,MAAIU,MAAM,GAAGvB,MAAM,CAACa,MAAP,GAAgB,CAA7B,EAAgC;AAC9B;AACD;;AAEDzB,EAAAA,OAAO,CAACY,MAAD,EAAS,UAASI,KAAT,EAAgB4B,QAAhB,EAA0B;AACxC,QAAIf,KAAK,GAAG,EAAZ;AAAA,QACIgB,SADJ;;AAGA,QAAI7B,KAAK,KAAKgB,UAAV,IAAwBhB,KAAK,KAAKkB,SAAtC,EAAiD;AAC/C;AACD;;AAEDW,IAAAA,SAAS,GAAGjC,MAAM,CAACgC,QAAQ,GAAG,CAAZ,CAAlB;AAEA5B,IAAAA,KAAK,CAACE,KAAN,CAAYG,GAAZ,GAAkB,CAAlB;AAEArB,IAAAA,OAAO,CAACgB,KAAK,CAACyB,QAAP,EAAiB,UAASxB,OAAT,EAAkBqB,GAAlB,EAAuB;AAC7CT,MAAAA,KAAK,CAACvB,QAAQ,CAACO,IAAD,CAAT,CAAL,GAAwB,CAAxB;AACAgB,MAAAA,KAAK,CAAChB,IAAD,CAAL,GAAegC,SAAS,CAAC3B,KAAV,CAAgBG,GAAhB,GAAsBJ,OAAO,CAACJ,IAAD,CAA9B,GAAwCsB,MAAtD;;AAEA,UAAInB,KAAK,CAACE,KAAN,CAAYC,GAAZ,KAAoBF,OAAO,CAACJ,IAAD,CAA/B,EAAuC;AACrCgB,QAAAA,KAAK,CAAChB,IAAD,CAAL,IAAeI,OAAO,CAACJ,IAAD,CAAP,GAAgBG,KAAK,CAACE,KAAN,CAAYC,GAA3C;AACD;;AAED,UAAIU,KAAK,CAAChB,IAAD,CAAT,EAAiB;AACfV,QAAAA,QAAQ,CAAC2B,YAAT,CAAsB,CAAEb,OAAF,CAAtB,EAAmCY,KAAnC,EAA0CZ,OAAO,CAACc,MAAlD;AACD;;AAEDf,MAAAA,KAAK,CAACE,KAAN,CAAYG,GAAZ,GAAkBD,IAAI,CAACC,GAAL,CAASJ,OAAO,CAACJ,IAAD,CAAP,GAAgBI,OAAO,CAACH,SAAD,CAAhC,EAA6CwB,GAAG,GAAGtB,KAAK,CAACE,KAAN,CAAYG,GAAf,GAAqB,CAArE,CAAlB;AACD,KAbM,CAAP;AAcD,GA1BM,CAAP;AA2BD,CAjID;;AAmIAnB,kBAAkB,CAACO,SAAnB,CAA6BqC,WAA7B,GAA2C,UAASnC,OAAT,EAAkB,CAE5D,CAFD","sourcesContent":["import {\n  forEach,\n  sortBy\n} from 'min-dash';\n\n\n/**\n * A handler that distributes elements evenly.\n */\nexport default function DistributeElements(modeling) {\n  this._modeling = modeling;\n}\n\nDistributeElements.$inject = [ 'modeling' ];\n\nvar OFF_AXIS = {\n  x: 'y',\n  y: 'x'\n};\n\nDistributeElements.prototype.preExecute = function(context) {\n  var modeling = this._modeling;\n\n  var groups = context.groups,\n      axis = context.axis,\n      dimension = context.dimension;\n\n  function updateRange(group, element) {\n    group.range.min = Math.min(element[axis], group.range.min);\n    group.range.max = Math.max(element[axis] + element[dimension], group.range.max);\n  }\n\n  function center(element) {\n    return element[axis] + element[dimension] / 2;\n  }\n\n  function lastIdx(arr) {\n    return arr.length - 1;\n  }\n\n  function rangeDiff(range) {\n    return range.max - range.min;\n  }\n\n  function centerElement(refCenter, element) {\n    var delta = { y: 0 };\n\n    delta[axis] = refCenter - center(element);\n\n    if (delta[axis]) {\n\n      delta[OFF_AXIS[axis]] = 0;\n\n      modeling.moveElements([ element ], delta, element.parent);\n    }\n  }\n\n  var firstGroup = groups[0],\n      lastGroupIdx = lastIdx(groups),\n      lastGroup = groups[ lastGroupIdx ];\n\n  var margin,\n      spaceInBetween,\n      groupsSize = 0; // the size of each range\n\n  forEach(groups, function(group, idx) {\n    var sortedElements,\n        refElem,\n        refCenter;\n\n    if (group.elements.length < 2) {\n      if (idx && idx !== groups.length - 1) {\n        updateRange(group, group.elements[0]);\n\n        groupsSize += rangeDiff(group.range);\n      }\n      return;\n    }\n\n    sortedElements = sortBy(group.elements, axis);\n\n    refElem = sortedElements[0];\n\n    if (idx === lastGroupIdx) {\n      refElem = sortedElements[lastIdx(sortedElements)];\n    }\n\n    refCenter = center(refElem);\n\n    // wanna update the ranges after the shapes have been centered\n    group.range = null;\n\n    forEach(sortedElements, function(element) {\n\n      centerElement(refCenter, element);\n\n      if (group.range === null) {\n        group.range = {\n          min: element[axis],\n          max: element[axis] + element[dimension]\n        };\n\n        return;\n      }\n\n      // update group's range after centering the range elements\n      updateRange(group, element);\n    });\n\n    if (idx && idx !== groups.length - 1) {\n      groupsSize += rangeDiff(group.range);\n    }\n  });\n\n  spaceInBetween = Math.abs(lastGroup.range.min - firstGroup.range.max);\n\n  margin = Math.round((spaceInBetween - groupsSize) / (groups.length - 1));\n\n  if (margin < groups.length - 1) {\n    return;\n  }\n\n  forEach(groups, function(group, groupIdx) {\n    var delta = {},\n        prevGroup;\n\n    if (group === firstGroup || group === lastGroup) {\n      return;\n    }\n\n    prevGroup = groups[groupIdx - 1];\n\n    group.range.max = 0;\n\n    forEach(group.elements, function(element, idx) {\n      delta[OFF_AXIS[axis]] = 0;\n      delta[axis] = (prevGroup.range.max - element[axis]) + margin;\n\n      if (group.range.min !== element[axis]) {\n        delta[axis] += element[axis] - group.range.min;\n      }\n\n      if (delta[axis]) {\n        modeling.moveElements([ element ], delta, element.parent);\n      }\n\n      group.range.max = Math.max(element[axis] + element[dimension], idx ? group.range.max : 0);\n    });\n  });\n};\n\nDistributeElements.prototype.postExecute = function(context) {\n\n};\n"]},"metadata":{},"sourceType":"module"}