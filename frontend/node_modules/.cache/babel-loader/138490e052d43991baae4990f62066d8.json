{"ast":null,"code":"import { is } from '../../../util/ModelUtil';\nimport { getLanesRoot, computeLanesResize } from '../util/LaneUtil';\nimport { eachElement } from 'diagram-js/lib/util/Elements';\nimport { asTRBL } from 'diagram-js/lib/layout/LayoutUtil';\nimport { substractTRBL } from 'diagram-js/lib/features/resize/ResizeUtil';\n/**\n * A handler that resizes a lane.\n *\n * @param {Modeling} modeling\n */\n\nexport default function ResizeLaneHandler(modeling, spaceTool) {\n  this._modeling = modeling;\n  this._spaceTool = spaceTool;\n}\nResizeLaneHandler.$inject = ['modeling', 'spaceTool'];\n\nResizeLaneHandler.prototype.preExecute = function (context) {\n  var shape = context.shape,\n      newBounds = context.newBounds,\n      balanced = context.balanced;\n\n  if (balanced !== false) {\n    this.resizeBalanced(shape, newBounds);\n  } else {\n    this.resizeSpace(shape, newBounds);\n  }\n};\n/**\n * Resize balanced, adjusting next / previous lane sizes.\n *\n * @param {djs.model.Shape} shape\n * @param {Bounds} newBounds\n */\n\n\nResizeLaneHandler.prototype.resizeBalanced = function (shape, newBounds) {\n  var modeling = this._modeling;\n  var resizeNeeded = computeLanesResize(shape, newBounds); // resize the lane\n\n  modeling.resizeShape(shape, newBounds); // resize other lanes as needed\n\n  resizeNeeded.forEach(function (r) {\n    modeling.resizeShape(r.shape, r.newBounds);\n  });\n};\n/**\n * Resize, making actual space and moving below / above elements.\n *\n * @param {djs.model.Shape} shape\n * @param {Bounds} newBounds\n */\n\n\nResizeLaneHandler.prototype.resizeSpace = function (shape, newBounds) {\n  var spaceTool = this._spaceTool;\n  var shapeTrbl = asTRBL(shape),\n      newTrbl = asTRBL(newBounds);\n  var trblDiff = substractTRBL(newTrbl, shapeTrbl);\n  var lanesRoot = getLanesRoot(shape);\n  var allAffected = [],\n      allLanes = [];\n  eachElement(lanesRoot, function (element) {\n    allAffected.push(element);\n\n    if (is(element, 'bpmn:Lane') || is(element, 'bpmn:Participant')) {\n      allLanes.push(element);\n    }\n\n    return element.children;\n  });\n  var change, spacePos, direction, offset, adjustments;\n\n  if (trblDiff.bottom || trblDiff.top) {\n    change = trblDiff.bottom || trblDiff.top;\n    spacePos = shape.y + (trblDiff.bottom ? shape.height : 0) + (trblDiff.bottom ? -10 : 10);\n    direction = trblDiff.bottom ? 's' : 'n';\n    offset = trblDiff.top > 0 || trblDiff.bottom < 0 ? -change : change;\n    adjustments = spaceTool.calculateAdjustments(allAffected, 'y', offset, spacePos);\n    spaceTool.makeSpace(adjustments.movingShapes, adjustments.resizingShapes, {\n      x: 0,\n      y: change\n    }, direction);\n  }\n\n  if (trblDiff.left || trblDiff.right) {\n    change = trblDiff.right || trblDiff.left;\n    spacePos = shape.x + (trblDiff.right ? shape.width : 0) + (trblDiff.right ? -10 : 100);\n    direction = trblDiff.right ? 'e' : 'w';\n    offset = trblDiff.left > 0 || trblDiff.right < 0 ? -change : change;\n    adjustments = spaceTool.calculateAdjustments(allLanes, 'x', offset, spacePos);\n    spaceTool.makeSpace(adjustments.movingShapes, adjustments.resizingShapes, {\n      x: change,\n      y: 0\n    }, direction);\n  }\n};","map":{"version":3,"sources":["C:/Users/Vittorio/Documents/GitHub/SPM2021-MTV/frontend/node_modules/bpmn-js/lib/features/modeling/cmd/ResizeLaneHandler.js"],"names":["is","getLanesRoot","computeLanesResize","eachElement","asTRBL","substractTRBL","ResizeLaneHandler","modeling","spaceTool","_modeling","_spaceTool","$inject","prototype","preExecute","context","shape","newBounds","balanced","resizeBalanced","resizeSpace","resizeNeeded","resizeShape","forEach","r","shapeTrbl","newTrbl","trblDiff","lanesRoot","allAffected","allLanes","element","push","children","change","spacePos","direction","offset","adjustments","bottom","top","y","height","calculateAdjustments","makeSpace","movingShapes","resizingShapes","x","left","right","width"],"mappings":"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","sourcesContent":["import { is } from '../../../util/ModelUtil';\n\nimport {\n  getLanesRoot,\n  computeLanesResize\n} from '../util/LaneUtil';\n\nimport {\n  eachElement\n} from 'diagram-js/lib/util/Elements';\n\nimport {\n  asTRBL\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  substractTRBL\n} from 'diagram-js/lib/features/resize/ResizeUtil';\n\n\n/**\n * A handler that resizes a lane.\n *\n * @param {Modeling} modeling\n */\nexport default function ResizeLaneHandler(modeling, spaceTool) {\n  this._modeling = modeling;\n  this._spaceTool = spaceTool;\n}\n\nResizeLaneHandler.$inject = [\n  'modeling',\n  'spaceTool'\n];\n\n\nResizeLaneHandler.prototype.preExecute = function(context) {\n\n  var shape = context.shape,\n      newBounds = context.newBounds,\n      balanced = context.balanced;\n\n  if (balanced !== false) {\n    this.resizeBalanced(shape, newBounds);\n  } else {\n    this.resizeSpace(shape, newBounds);\n  }\n};\n\n\n/**\n * Resize balanced, adjusting next / previous lane sizes.\n *\n * @param {djs.model.Shape} shape\n * @param {Bounds} newBounds\n */\nResizeLaneHandler.prototype.resizeBalanced = function(shape, newBounds) {\n\n  var modeling = this._modeling;\n\n  var resizeNeeded = computeLanesResize(shape, newBounds);\n\n  // resize the lane\n  modeling.resizeShape(shape, newBounds);\n\n  // resize other lanes as needed\n  resizeNeeded.forEach(function(r) {\n    modeling.resizeShape(r.shape, r.newBounds);\n  });\n};\n\n\n/**\n * Resize, making actual space and moving below / above elements.\n *\n * @param {djs.model.Shape} shape\n * @param {Bounds} newBounds\n */\nResizeLaneHandler.prototype.resizeSpace = function(shape, newBounds) {\n  var spaceTool = this._spaceTool;\n\n  var shapeTrbl = asTRBL(shape),\n      newTrbl = asTRBL(newBounds);\n\n  var trblDiff = substractTRBL(newTrbl, shapeTrbl);\n\n  var lanesRoot = getLanesRoot(shape);\n\n  var allAffected = [],\n      allLanes = [];\n\n  eachElement(lanesRoot, function(element) {\n    allAffected.push(element);\n\n    if (is(element, 'bpmn:Lane') || is(element, 'bpmn:Participant')) {\n      allLanes.push(element);\n    }\n\n    return element.children;\n  });\n\n  var change,\n      spacePos,\n      direction,\n      offset,\n      adjustments;\n\n  if (trblDiff.bottom || trblDiff.top) {\n\n    change = trblDiff.bottom || trblDiff.top;\n    spacePos = shape.y + (trblDiff.bottom ? shape.height : 0) + (trblDiff.bottom ? -10 : 10);\n    direction = trblDiff.bottom ? 's' : 'n';\n\n    offset = trblDiff.top > 0 || trblDiff.bottom < 0 ? -change : change;\n\n    adjustments = spaceTool.calculateAdjustments(allAffected, 'y', offset, spacePos);\n\n    spaceTool.makeSpace(adjustments.movingShapes, adjustments.resizingShapes, { x: 0, y: change }, direction);\n  }\n\n\n  if (trblDiff.left || trblDiff.right) {\n\n    change = trblDiff.right || trblDiff.left;\n    spacePos = shape.x + (trblDiff.right ? shape.width : 0) + (trblDiff.right ? -10 : 100);\n    direction = trblDiff.right ? 'e' : 'w';\n\n    offset = trblDiff.left > 0 || trblDiff.right < 0 ? -change : change;\n\n    adjustments = spaceTool.calculateAdjustments(allLanes, 'x', offset, spacePos);\n\n    spaceTool.makeSpace(adjustments.movingShapes, adjustments.resizingShapes, { x: change, y: 0 }, direction);\n  }\n};"]},"metadata":{},"sourceType":"module"}