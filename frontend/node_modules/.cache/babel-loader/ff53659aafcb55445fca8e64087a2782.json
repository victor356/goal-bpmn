{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Vittorio\\\\Documents\\\\GitHub\\\\SPM2021-MTV\\\\frontend\\\\src\\\\components\\\\bpmn\\\\bpmn.modeler.component.jsx\";\nimport React, { Component } from 'react';\nimport BpmnModeler from 'bpmn-js/lib/Modeler';\nimport 'bpmn-js/dist/assets/diagram-js.css';\nimport 'bpmn-font/dist/css/bpmn-embedded.css';\nimport { emptyBpmn } from '../../assets/empty.bpmn';\nimport propertiesPanelModule from 'bpmn-js-properties-panel';\nimport propertiesProviderModule from 'bpmn-js-properties-panel/lib/provider/camunda';\nimport camundaModdleDescriptor from 'camunda-bpmn-moddle/resources/camunda';\nimport \"./bpmn.scss\";\nimport { is } from 'bpmn-js/lib/util/ModelUtil';\nimport { ExternalLink } from 'react-external-link';\nimport { getCurrentUser } from '../util/APIUtils';\nimport $ from 'jquery'; // prova gatto\n\nimport resizeAllModule from '../../lib/resize-all-rules';\nimport colorPickerModule from '../../lib/color-picker';\nimport nyanDrawModule from '../../lib/nyan/draw';\nimport nyanPaletteModule from '../../lib/nyan/palette';\nimport templates from '../bpmn/element-templates/data.json';\nimport PropertiesPanelModule from \"bpmn-js-properties-panel\";\nimport CamundaPropertiesProviderModule from \"bpmn-js-properties-panel/lib/provider/camunda\";\nimport CustomPaletteProvider from \"../palette\";\nimport CamundaModdlePackage from \"camunda-bpmn-moddle/resources/camunda\";\nimport CamundaModdleExtension from \"camunda-bpmn-moddle/lib\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass BpmnModelerComponent extends Component {\n  constructor(_props) {\n    super(_props);\n    this.modeler = null;\n    this.listaNomi = [];\n\n    this.componentDidMount = () => {\n      this.modeler = new BpmnModeler({\n        container: '#bpmnview',\n        keyboard: {\n          bindTo: window\n        },\n        propertiesPanel: {\n          parent: '#propview'\n        },\n        additionalModules: [propertiesPanelModule, propertiesProviderModule, // templates,\n        // gatto\n        //resizeAllModule,\n        //colorPickerModule,\n        //nyanDrawModule,\n        //nyanPaletteModule,\n        CamundaPropertiesProviderModule, CamundaModdleExtension, CustomPaletteProvider],\n        elementTemplates: templates,\n        moddleExtensions: {\n          camunda: camundaModdleDescriptor,\n          camunda: CamundaModdlePackage\n        }\n      });\n      this.newBpmnDiagram();\n      this.loadCurrentlyLoggedInUser();\n    };\n\n    this.newBpmnDiagram = () => {\n      this.state.bpmn ? this.openBpmnDiagram(this.state.bpmnString) : this.openBpmnDiagram(emptyBpmn);\n      console.log(\"this.state.bpmnString\", this.state);\n    };\n\n    this.openBpmnDiagram = xml => {\n      this.modeler.importXML(xml, error => {\n        if (error) {\n          return console.log('fail import xml');\n        }\n\n        var canvas = this.modeler.get('canvas');\n        canvas.zoom('fit-viewport');\n      });\n    };\n\n    this.saveDiagram = done => {\n      this.modeler.saveXML({\n        format: true\n      }, function (err, xml) {\n        done(err, xml);\n      });\n    };\n\n    this.Validate = props => {\n      const name = this.getParameter();\n      console.log('name', name);\n      const formData = new FormData();\n      const img = this.getImage();\n      this.saveDiagram(function (err, xml) {\n        const imgBlob = new Blob([xml], {\n          type: 'xml'\n        });\n        formData.append(\"file\", imgBlob, name);\n        formData.append(\"id\", props.id);\n        formData.append(\"svg\", img, name + \".svg\");\n        console.log(\"formDaTA\", formData);\n        $.ajax({\n          method: 'POST',\n          url: \"http://localhost:8081/upload\",\n          data: formData,\n          processData: false,\n          contentType: false\n        }).done(function (result) {\n          // do something with the result now\n          console.log(result);\n        }).fail(function (a, b, c) {\n          alert(\"error\");\n        });\n      });\n    };\n\n    this.Download = () => {\n      this.modeler.saveXML({\n        format: true\n      }, function (err, xml) {\n        if (err) {\n          console.error(err);\n        } else {\n          var encodedData = err ? '' : encodeURIComponent(xml);\n          window.location.href = 'data:application/bpmn20-xml;charset=UTF-8,' + encodedData;\n        }\n      });\n    };\n\n    this.getImage = () => {\n      var blob;\n      this.modeler.saveSVG({\n        format: true\n      }, function (err, svg) {\n        if (err) {\n          return;\n        }\n\n        var svgBlob = new Blob([svg], {\n          type: 'image/svg+xml'\n        });\n        blob = svgBlob;\n      });\n      return blob;\n    };\n\n    this.getParameter = () => {\n      const canvas = this.modeler.get('canvas');\n      const rootElement = canvas.getRootElement();\n      console.log('Process Id:', rootElement.id);\n      rootElement.businessObject.participants.map((item, index) => {\n        this.listaNomi[index] = item.processRef.id; // return console.log('item', this.listaNomi[index]);\n      }); //const formData = new FormData();\n      //formData.append('nameList', this.listaNomi);\n      //var xhr = new XMLHttpRequest();\n      //xhr.open('POST', 'http://localhost:8081/uploadNames');\n      //xhr.onload = function (e) {\n      //    console.log(\"xhr onload function\");\n      //};\n      //xhr.send(formData);\n\n      return rootElement.id;\n    };\n\n    this.render = () => {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"bpmncontainer\",\n        style: {\n          width: '100%',\n          height: '100%'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"propview\",\n          style: {\n            width: '25%',\n            height: '100%',\n            float: 'right',\n            maxHeight: '100%',\n            overflowX: 'auto'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"bpmnview\",\n          style: {\n            width: '75%',\n            height: '100%',\n            float: 'left'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modelerBPMN\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"downloadButton\",\n            onClick: () => {\n              this.Validate(this.state.currentUser);\n            },\n            children: \"Save\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 204,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(ExternalLink, {\n            href: \"http://90.147.42.60:8080/camunda/app/tasklist/\",\n            className: \"link\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"validateButton\",\n              onClick: () => {\n                this.Validate(this.state.currentUser);\n              },\n              children: \"Deploy\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 205,\n              columnNumber: 106\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"downloadButton\",\n            onClick: () => {\n              this.Download();\n            },\n            children: \"Download\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 206,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 13\n      }, this);\n    };\n\n    this.state = {\n      currentUser: null,\n      bpmn: _props.xml,\n      bpmnString: _props.bpmnString\n    };\n    this.loadCurrentlyLoggedInUser = this.loadCurrentlyLoggedInUser.bind(this);\n  }\n\n  loadCurrentlyLoggedInUser() {\n    getCurrentUser().then(response => {\n      this.setState({\n        currentUser: response\n      });\n    }).catch(error => {\n      console.log(\"error\", error);\n    });\n  }\n\n}\n\nexport default BpmnModelerComponent;","map":{"version":3,"sources":["C:/Users/Vittorio/Documents/GitHub/SPM2021-MTV/frontend/src/components/bpmn/bpmn.modeler.component.jsx"],"names":["React","Component","BpmnModeler","emptyBpmn","propertiesPanelModule","propertiesProviderModule","camundaModdleDescriptor","is","ExternalLink","getCurrentUser","$","resizeAllModule","colorPickerModule","nyanDrawModule","nyanPaletteModule","templates","PropertiesPanelModule","CamundaPropertiesProviderModule","CustomPaletteProvider","CamundaModdlePackage","CamundaModdleExtension","BpmnModelerComponent","constructor","props","modeler","listaNomi","componentDidMount","container","keyboard","bindTo","window","propertiesPanel","parent","additionalModules","elementTemplates","moddleExtensions","camunda","newBpmnDiagram","loadCurrentlyLoggedInUser","state","bpmn","openBpmnDiagram","bpmnString","console","log","xml","importXML","error","canvas","get","zoom","saveDiagram","done","saveXML","format","err","Validate","name","getParameter","formData","FormData","img","getImage","imgBlob","Blob","type","append","id","ajax","method","url","data","processData","contentType","result","fail","a","b","c","alert","Download","encodedData","encodeURIComponent","location","href","blob","saveSVG","svg","svgBlob","rootElement","getRootElement","businessObject","participants","map","item","index","processRef","render","width","height","float","maxHeight","overflowX","currentUser","bind","then","response","setState","catch"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport BpmnModeler from 'bpmn-js/lib/Modeler';\r\nimport 'bpmn-js/dist/assets/diagram-js.css';\r\nimport 'bpmn-font/dist/css/bpmn-embedded.css';\r\nimport { emptyBpmn } from '../../assets/empty.bpmn';\r\nimport propertiesPanelModule from 'bpmn-js-properties-panel';\r\nimport propertiesProviderModule from 'bpmn-js-properties-panel/lib/provider/camunda';\r\nimport camundaModdleDescriptor from 'camunda-bpmn-moddle/resources/camunda';\r\nimport \"./bpmn.scss\";\r\nimport { is } from 'bpmn-js/lib/util/ModelUtil';\r\nimport { ExternalLink } from 'react-external-link';\r\nimport { getCurrentUser } from '../util/APIUtils';\r\nimport $ from 'jquery';\r\n\r\n// prova gatto\r\nimport resizeAllModule from '../../lib/resize-all-rules';\r\nimport colorPickerModule from '../../lib/color-picker';\r\nimport nyanDrawModule from '../../lib/nyan/draw';\r\nimport nyanPaletteModule from '../../lib/nyan/palette';\r\nimport templates from '../bpmn/element-templates/data.json';\r\n\r\nimport PropertiesPanelModule from \"bpmn-js-properties-panel\";\r\nimport CamundaPropertiesProviderModule from \"bpmn-js-properties-panel/lib/provider/camunda\";\r\nimport CustomPaletteProvider from \"../palette\";\r\nimport CamundaModdlePackage from \"camunda-bpmn-moddle/resources/camunda\";\r\nimport CamundaModdleExtension from \"camunda-bpmn-moddle/lib\";\r\n\r\nclass BpmnModelerComponent extends Component {\r\n\r\n    modeler = null;\r\n    listaNomi = [];\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { currentUser: null, bpmn: props.xml, bpmnString: props.bpmnString }\r\n        this.loadCurrentlyLoggedInUser = this.loadCurrentlyLoggedInUser.bind(this);\r\n    }\r\n\r\n    loadCurrentlyLoggedInUser() {\r\n        getCurrentUser()\r\n            .then(response => {\r\n                this.setState({\r\n                    currentUser: response,\r\n                });\r\n            }).catch(error => {\r\n                console.log(\"error\", error);\r\n            });\r\n    }\r\n\r\n    componentDidMount = () => {\r\n        this.modeler = new BpmnModeler({\r\n            container: '#bpmnview',\r\n            keyboard: {\r\n                bindTo: window\r\n            },\r\n            propertiesPanel: {\r\n                parent: '#propview'\r\n            },\r\n            additionalModules: [\r\n                propertiesPanelModule,\r\n                propertiesProviderModule,\r\n                // templates,\r\n\r\n                // gatto\r\n                //resizeAllModule,\r\n                //colorPickerModule,\r\n                //nyanDrawModule,\r\n                //nyanPaletteModule,\r\n\r\n                CamundaPropertiesProviderModule,\r\n                CamundaModdleExtension,\r\n                CustomPaletteProvider\r\n            ],\r\n            elementTemplates: templates,\r\n            moddleExtensions: {\r\n                camunda: camundaModdleDescriptor,\r\n                camunda: CamundaModdlePackage\r\n\r\n            },\r\n\r\n\r\n\r\n        });\r\n\r\n        this.newBpmnDiagram();\r\n        this.loadCurrentlyLoggedInUser();\r\n\r\n    }\r\n\r\n    newBpmnDiagram = () => {\r\n        this.state.bpmn\r\n            ? this.openBpmnDiagram(this.state.bpmnString)\r\n            : this.openBpmnDiagram(emptyBpmn)\r\n\r\n        console.log(\"this.state.bpmnString\", this.state);\r\n\r\n    }\r\n\r\n    openBpmnDiagram = (xml) => {\r\n        this.modeler.importXML(xml, (error) => {\r\n            if (error) {\r\n                return console.log('fail import xml');\r\n            }\r\n\r\n            var canvas = this.modeler.get('canvas');\r\n\r\n            canvas.zoom('fit-viewport');\r\n        });\r\n    }\r\n\r\n    saveDiagram = (done) => {\r\n\r\n        this.modeler.saveXML({ format: true }, function (err, xml) {\r\n            done(err, xml);\r\n        });\r\n    }\r\n    Validate = (props) => {\r\n        const name = this.getParameter();\r\n        console.log('name', name);\r\n        const formData = new FormData();\r\n\r\n        const img = this.getImage();\r\n        this.saveDiagram(function (err, xml) {\r\n            const imgBlob = new Blob([xml], { type: 'xml' });\r\n            formData.append(\r\n                \"file\",\r\n                imgBlob,\r\n                name\r\n            );\r\n            formData.append(\"id\", props.id);\r\n            formData.append(\"svg\", img, name + \".svg\");\r\n                console.log(\"formDaTA\",formData);\r\n            $.ajax({\r\n                method: 'POST',\r\n                url: \"http://localhost:8081/upload\",\r\n                data: formData,\r\n                processData: false,\r\n                contentType: false\r\n            }).done(function (result) {\r\n                // do something with the result now\r\n\r\n                console.log(result);\r\n            }).fail(function (a, b, c) {\r\n                alert(\"error\");\r\n            });\r\n        });\r\n    }\r\n\r\n    Download = () => {\r\n        this.modeler.saveXML({ format: true }, function (err, xml) {\r\n            if (err) {\r\n                console.error(err);\r\n            } else {\r\n                var encodedData = err ? '' : encodeURIComponent(xml);\r\n                window.location.href = 'data:application/bpmn20-xml;charset=UTF-8,' + encodedData;\r\n            }\r\n        });\r\n    }\r\n\r\n    getImage = () => {\r\n        var blob;\r\n        this.modeler.saveSVG({ format: true }, function (err, svg) {\r\n            if (err) {\r\n                return;\r\n            }\r\n\r\n            var svgBlob = new Blob([svg], {\r\n                type: 'image/svg+xml'\r\n            });\r\n            blob = svgBlob;\r\n\r\n        })\r\n        return blob;\r\n    }\r\n\r\n    getParameter = () => {\r\n\r\n        const canvas = this.modeler.get('canvas');\r\n\r\n        const rootElement = canvas.getRootElement();\r\n\r\n        console.log('Process Id:', rootElement.id);\r\n        rootElement.businessObject.participants.map((item, index) => {\r\n            this.listaNomi[index] = item.processRef.id\r\n            // return console.log('item', this.listaNomi[index]);\r\n        })\r\n        //const formData = new FormData();\r\n        //formData.append('nameList', this.listaNomi);\r\n        //var xhr = new XMLHttpRequest();\r\n        //xhr.open('POST', 'http://localhost:8081/uploadNames');\r\n        //xhr.onload = function (e) {\r\n        //    console.log(\"xhr onload function\");\r\n        //};\r\n        //xhr.send(formData);\r\n        return rootElement.id;\r\n    }\r\n\r\n    render = () => {\r\n        return (\r\n            <div id=\"bpmncontainer\" style={{ width: '100%', height: '100%' }} >\r\n                <div id=\"propview\" style={{ width: '25%', height: '100%', float: 'right', maxHeight: '100%', overflowX: 'auto' }}></div>\r\n                <div id=\"bpmnview\" style={{ width: '75%', height: '100%', float: 'left' }}></div>\r\n                <div className=\"modelerBPMN\">\r\n                    <button className=\"downloadButton\" onClick={() => { this.Validate(this.state.currentUser) }}>Save</button>\r\n                    <ExternalLink href=\"http://90.147.42.60:8080/camunda/app/tasklist/\" className=\"link\"><button className=\"validateButton\" onClick={() => { this.Validate(this.state.currentUser) }}>Deploy</button></ExternalLink>\r\n                    <button className=\"downloadButton\" onClick={() => { this.Download() }}>Download</button>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default BpmnModelerComponent;\r\n"]},"metadata":{},"sourceType":"module"}