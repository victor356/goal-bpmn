{"ast":null,"code":"import { assign } from 'min-dash';\nimport { getLabel } from './LabelUtil';\nimport { is } from '../../util/ModelUtil';\nimport { isAny } from '../modeling/util/ModelingUtil';\nimport { isExpanded } from '../../util/DiUtil';\nimport { getExternalLabelMid, isLabelExternal, hasExternalLabel, isLabel } from '../../util/LabelUtil';\nexport default function LabelEditingProvider(eventBus, canvas, directEditing, modeling, resizeHandles, textRenderer) {\n  this._canvas = canvas;\n  this._modeling = modeling;\n  this._textRenderer = textRenderer;\n  directEditing.registerProvider(this); // listen to dblclick on non-root elements\n\n  eventBus.on('element.dblclick', function (event) {\n    activateDirectEdit(event.element, true);\n  }); // complete on followup canvas operation\n\n  eventBus.on(['element.mousedown', 'drag.init', 'canvas.viewbox.changing', 'autoPlace', 'popupMenu.open'], function (event) {\n    if (directEditing.isActive()) {\n      directEditing.complete();\n    }\n  }); // cancel on command stack changes\n\n  eventBus.on(['commandStack.changed'], function (e) {\n    if (directEditing.isActive()) {\n      directEditing.cancel();\n    }\n  });\n  eventBus.on('directEditing.activate', function (event) {\n    resizeHandles.removeResizers();\n  });\n  eventBus.on('create.end', 500, function (event) {\n    var element = event.shape,\n        canExecute = event.context.canExecute,\n        isTouch = event.isTouch; // TODO(nikku): we need to find a way to support the\n    // direct editing on mobile devices; right now this will\n    // break for desworkflowediting on mobile devices\n    // as it breaks the user interaction workflow\n    // TODO(nre): we should temporarily focus the edited element\n    // here and release the focused viewport after the direct edit\n    // operation is finished\n\n    if (isTouch) {\n      return;\n    }\n\n    if (!canExecute) {\n      return;\n    }\n\n    activateDirectEdit(element);\n  });\n  eventBus.on('autoPlace.end', 500, function (event) {\n    activateDirectEdit(event.shape);\n  });\n\n  function activateDirectEdit(element, force) {\n    if (force || isAny(element, ['bpmn:Task', 'bpmn:TextAnnotation']) || isCollapsedSubProcess(element)) {\n      directEditing.activate(element);\n    }\n  }\n}\nLabelEditingProvider.$inject = ['eventBus', 'canvas', 'directEditing', 'modeling', 'resizeHandles', 'textRenderer'];\n/**\n * Activate direct editing for activities and text annotations.\n *\n * @param  {djs.model.Base} element\n *\n * @return {Object} an object with properties bounds (position and size), text and options\n */\n\nLabelEditingProvider.prototype.activate = function (element) {\n  // text\n  var text = getLabel(element);\n\n  if (text === undefined) {\n    return;\n  }\n\n  var context = {\n    text: text\n  }; // bounds\n\n  var bounds = this.getEditingBBox(element);\n  assign(context, bounds);\n  var options = {}; // tasks\n\n  if (isAny(element, ['bpmn:Task', 'bpmn:Participant', 'bpmn:Lane', 'bpmn:CallActivity']) || isCollapsedSubProcess(element)) {\n    assign(options, {\n      centerVertically: true\n    });\n  } // external labels\n\n\n  if (isLabelExternal(element)) {\n    assign(options, {\n      autoResize: true\n    });\n  } // text annotations\n\n\n  if (is(element, 'bpmn:TextAnnotation')) {\n    assign(options, {\n      resizable: true,\n      autoResize: true\n    });\n  }\n\n  assign(context, {\n    options: options\n  });\n  return context;\n};\n/**\n * Get the editing bounding box based on the element's size and position\n *\n * @param  {djs.model.Base} element\n *\n * @return {Object} an object containing information about position\n *                  and size (fixed or minimum and/or maximum)\n */\n\n\nLabelEditingProvider.prototype.getEditingBBox = function (element) {\n  var canvas = this._canvas;\n  var target = element.label || element;\n  var bbox = canvas.getAbsoluteBBox(target);\n  var mid = {\n    x: bbox.x + bbox.width / 2,\n    y: bbox.y + bbox.height / 2\n  }; // default position\n\n  var bounds = {\n    x: bbox.x,\n    y: bbox.y\n  };\n  var zoom = canvas.zoom();\n\n  var defaultStyle = this._textRenderer.getDefaultStyle(),\n      externalStyle = this._textRenderer.getExternalStyle(); // take zoom into account\n\n\n  var externalFontSize = externalStyle.fontSize * zoom,\n      externalLineHeight = externalStyle.lineHeight,\n      defaultFontSize = defaultStyle.fontSize * zoom,\n      defaultLineHeight = defaultStyle.lineHeight;\n  var style = {\n    fontFamily: this._textRenderer.getDefaultStyle().fontFamily,\n    fontWeight: this._textRenderer.getDefaultStyle().fontWeight\n  }; // adjust for expanded pools AND lanes\n\n  if (is(element, 'bpmn:Lane') || isExpandedPool(element)) {\n    assign(bounds, {\n      width: bbox.height,\n      height: 30 * zoom,\n      x: bbox.x - bbox.height / 2 + 15 * zoom,\n      y: mid.y - 30 * zoom / 2\n    });\n    assign(style, {\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight,\n      paddingTop: 7 * zoom + 'px',\n      paddingBottom: 7 * zoom + 'px',\n      paddingLeft: 5 * zoom + 'px',\n      paddingRight: 5 * zoom + 'px',\n      transform: 'rotate(-90deg)'\n    });\n  } // internal labels for tasks and collapsed call activities,\n  // sub processes and participants\n\n\n  if (isAny(element, ['bpmn:Task', 'bpmn:CallActivity']) || isCollapsedPool(element) || isCollapsedSubProcess(element)) {\n    assign(bounds, {\n      width: bbox.width,\n      height: bbox.height\n    });\n    assign(style, {\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight,\n      paddingTop: 7 * zoom + 'px',\n      paddingBottom: 7 * zoom + 'px',\n      paddingLeft: 5 * zoom + 'px',\n      paddingRight: 5 * zoom + 'px'\n    });\n  } // internal labels for expanded sub processes\n\n\n  if (isExpandedSubProcess(element)) {\n    assign(bounds, {\n      width: bbox.width,\n      x: bbox.x\n    });\n    assign(style, {\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight,\n      paddingTop: 7 * zoom + 'px',\n      paddingBottom: 7 * zoom + 'px',\n      paddingLeft: 5 * zoom + 'px',\n      paddingRight: 5 * zoom + 'px'\n    });\n  }\n\n  var width = 90 * zoom,\n      paddingTop = 7 * zoom,\n      paddingBottom = 4 * zoom; // external labels for events, data elements, gateways and connections\n\n  if (target.labelTarget) {\n    assign(bounds, {\n      width: width,\n      height: bbox.height + paddingTop + paddingBottom,\n      x: mid.x - width / 2,\n      y: bbox.y - paddingTop\n    });\n    assign(style, {\n      fontSize: externalFontSize + 'px',\n      lineHeight: externalLineHeight,\n      paddingTop: paddingTop + 'px',\n      paddingBottom: paddingBottom + 'px'\n    });\n  } // external label not yet created\n\n\n  if (isLabelExternal(target) && !hasExternalLabel(target) && !isLabel(target)) {\n    var externalLabelMid = getExternalLabelMid(element);\n    var absoluteBBox = canvas.getAbsoluteBBox({\n      x: externalLabelMid.x,\n      y: externalLabelMid.y,\n      width: 0,\n      height: 0\n    });\n    var height = externalFontSize + paddingTop + paddingBottom;\n    assign(bounds, {\n      width: width,\n      height: height,\n      x: absoluteBBox.x - width / 2,\n      y: absoluteBBox.y - height / 2\n    });\n    assign(style, {\n      fontSize: externalFontSize + 'px',\n      lineHeight: externalLineHeight,\n      paddingTop: paddingTop + 'px',\n      paddingBottom: paddingBottom + 'px'\n    });\n  } // text annotations\n\n\n  if (is(element, 'bpmn:TextAnnotation')) {\n    assign(bounds, {\n      width: bbox.width,\n      height: bbox.height,\n      minWidth: 30 * zoom,\n      minHeight: 10 * zoom\n    });\n    assign(style, {\n      textAlign: 'left',\n      paddingTop: 5 * zoom + 'px',\n      paddingBottom: 7 * zoom + 'px',\n      paddingLeft: 7 * zoom + 'px',\n      paddingRight: 5 * zoom + 'px',\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight\n    });\n  }\n\n  return {\n    bounds: bounds,\n    style: style\n  };\n};\n\nLabelEditingProvider.prototype.update = function (element, newLabel, activeContextText, bounds) {\n  var newBounds, bbox;\n\n  if (is(element, 'bpmn:TextAnnotation')) {\n    bbox = this._canvas.getAbsoluteBBox(element);\n    newBounds = {\n      x: element.x,\n      y: element.y,\n      width: element.width / bbox.width * bounds.width,\n      height: element.height / bbox.height * bounds.height\n    };\n  }\n\n  if (isEmptyText(newLabel)) {\n    newLabel = null;\n  }\n\n  this._modeling.updateLabel(element, newLabel, newBounds);\n}; // helpers //////////////////////\n\n\nfunction isCollapsedSubProcess(element) {\n  return is(element, 'bpmn:SubProcess') && !isExpanded(element);\n}\n\nfunction isExpandedSubProcess(element) {\n  return is(element, 'bpmn:SubProcess') && isExpanded(element);\n}\n\nfunction isCollapsedPool(element) {\n  return is(element, 'bpmn:Participant') && !isExpanded(element);\n}\n\nfunction isExpandedPool(element) {\n  return is(element, 'bpmn:Participant') && isExpanded(element);\n}\n\nfunction isEmptyText(label) {\n  return !label || !label.trim();\n}","map":{"version":3,"sources":["C:/Users/Vittorio/Documents/GitHub/SPM2021-MTV/frontend/node_modules/bpmn-js/lib/features/label-editing/LabelEditingProvider.js"],"names":["assign","getLabel","is","isAny","isExpanded","getExternalLabelMid","isLabelExternal","hasExternalLabel","isLabel","LabelEditingProvider","eventBus","canvas","directEditing","modeling","resizeHandles","textRenderer","_canvas","_modeling","_textRenderer","registerProvider","on","event","activateDirectEdit","element","isActive","complete","e","cancel","removeResizers","shape","canExecute","context","isTouch","force","isCollapsedSubProcess","activate","$inject","prototype","text","undefined","bounds","getEditingBBox","options","centerVertically","autoResize","resizable","target","label","bbox","getAbsoluteBBox","mid","x","width","y","height","zoom","defaultStyle","getDefaultStyle","externalStyle","getExternalStyle","externalFontSize","fontSize","externalLineHeight","lineHeight","defaultFontSize","defaultLineHeight","style","fontFamily","fontWeight","isExpandedPool","paddingTop","paddingBottom","paddingLeft","paddingRight","transform","isCollapsedPool","isExpandedSubProcess","labelTarget","externalLabelMid","absoluteBBox","minWidth","minHeight","textAlign","update","newLabel","activeContextText","newBounds","isEmptyText","updateLabel","trim"],"mappings":"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","sourcesContent":["import {\n  assign\n} from 'min-dash';\n\nimport {\n  getLabel\n} from './LabelUtil';\n\nimport { is } from '../../util/ModelUtil';\nimport { isAny } from '../modeling/util/ModelingUtil';\nimport { isExpanded } from '../../util/DiUtil';\n\nimport {\n  getExternalLabelMid,\n  isLabelExternal,\n  hasExternalLabel,\n  isLabel\n} from '../../util/LabelUtil';\n\n\nexport default function LabelEditingProvider(\n    eventBus, canvas, directEditing,\n    modeling, resizeHandles, textRenderer) {\n\n  this._canvas = canvas;\n  this._modeling = modeling;\n  this._textRenderer = textRenderer;\n\n  directEditing.registerProvider(this);\n\n  // listen to dblclick on non-root elements\n  eventBus.on('element.dblclick', function(event) {\n    activateDirectEdit(event.element, true);\n  });\n\n  // complete on followup canvas operation\n  eventBus.on([\n    'element.mousedown',\n    'drag.init',\n    'canvas.viewbox.changing',\n    'autoPlace',\n    'popupMenu.open'\n  ], function(event) {\n\n    if (directEditing.isActive()) {\n      directEditing.complete();\n    }\n  });\n\n  // cancel on command stack changes\n  eventBus.on([ 'commandStack.changed' ], function(e) {\n    if (directEditing.isActive()) {\n      directEditing.cancel();\n    }\n  });\n\n\n  eventBus.on('directEditing.activate', function(event) {\n    resizeHandles.removeResizers();\n  });\n\n  eventBus.on('create.end', 500, function(event) {\n\n    var element = event.shape,\n        canExecute = event.context.canExecute,\n        isTouch = event.isTouch;\n\n    // TODO(nikku): we need to find a way to support the\n    // direct editing on mobile devices; right now this will\n    // break for desworkflowediting on mobile devices\n    // as it breaks the user interaction workflow\n\n    // TODO(nre): we should temporarily focus the edited element\n    // here and release the focused viewport after the direct edit\n    // operation is finished\n    if (isTouch) {\n      return;\n    }\n\n    if (!canExecute) {\n      return;\n    }\n\n    activateDirectEdit(element);\n  });\n\n  eventBus.on('autoPlace.end', 500, function(event) {\n    activateDirectEdit(event.shape);\n  });\n\n\n  function activateDirectEdit(element, force) {\n    if (force ||\n        isAny(element, [ 'bpmn:Task', 'bpmn:TextAnnotation' ]) ||\n        isCollapsedSubProcess(element)) {\n\n      directEditing.activate(element);\n    }\n  }\n\n}\n\nLabelEditingProvider.$inject = [\n  'eventBus',\n  'canvas',\n  'directEditing',\n  'modeling',\n  'resizeHandles',\n  'textRenderer'\n];\n\n\n/**\n * Activate direct editing for activities and text annotations.\n *\n * @param  {djs.model.Base} element\n *\n * @return {Object} an object with properties bounds (position and size), text and options\n */\nLabelEditingProvider.prototype.activate = function(element) {\n\n  // text\n  var text = getLabel(element);\n\n  if (text === undefined) {\n    return;\n  }\n\n  var context = {\n    text: text\n  };\n\n  // bounds\n  var bounds = this.getEditingBBox(element);\n\n  assign(context, bounds);\n\n  var options = {};\n\n  // tasks\n  if (\n    isAny(element, [\n      'bpmn:Task',\n      'bpmn:Participant',\n      'bpmn:Lane',\n      'bpmn:CallActivity'\n    ]) ||\n    isCollapsedSubProcess(element)\n  ) {\n    assign(options, {\n      centerVertically: true\n    });\n  }\n\n  // external labels\n  if (isLabelExternal(element)) {\n    assign(options, {\n      autoResize: true\n    });\n  }\n\n  // text annotations\n  if (is(element, 'bpmn:TextAnnotation')) {\n    assign(options, {\n      resizable: true,\n      autoResize: true\n    });\n  }\n\n  assign(context, {\n    options: options\n  });\n\n  return context;\n};\n\n\n/**\n * Get the editing bounding box based on the element's size and position\n *\n * @param  {djs.model.Base} element\n *\n * @return {Object} an object containing information about position\n *                  and size (fixed or minimum and/or maximum)\n */\nLabelEditingProvider.prototype.getEditingBBox = function(element) {\n  var canvas = this._canvas;\n\n  var target = element.label || element;\n\n  var bbox = canvas.getAbsoluteBBox(target);\n\n  var mid = {\n    x: bbox.x + bbox.width / 2,\n    y: bbox.y + bbox.height / 2\n  };\n\n  // default position\n  var bounds = { x: bbox.x, y: bbox.y };\n\n  var zoom = canvas.zoom();\n\n  var defaultStyle = this._textRenderer.getDefaultStyle(),\n      externalStyle = this._textRenderer.getExternalStyle();\n\n  // take zoom into account\n  var externalFontSize = externalStyle.fontSize * zoom,\n      externalLineHeight = externalStyle.lineHeight,\n      defaultFontSize = defaultStyle.fontSize * zoom,\n      defaultLineHeight = defaultStyle.lineHeight;\n\n  var style = {\n    fontFamily: this._textRenderer.getDefaultStyle().fontFamily,\n    fontWeight: this._textRenderer.getDefaultStyle().fontWeight\n  };\n\n  // adjust for expanded pools AND lanes\n  if (is(element, 'bpmn:Lane') || isExpandedPool(element)) {\n\n    assign(bounds, {\n      width: bbox.height,\n      height: 30 * zoom,\n      x: bbox.x - bbox.height / 2 + (15 * zoom),\n      y: mid.y - (30 * zoom) / 2\n    });\n\n    assign(style, {\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight,\n      paddingTop: (7 * zoom) + 'px',\n      paddingBottom: (7 * zoom) + 'px',\n      paddingLeft: (5 * zoom) + 'px',\n      paddingRight: (5 * zoom) + 'px',\n      transform: 'rotate(-90deg)'\n    });\n  }\n\n\n  // internal labels for tasks and collapsed call activities,\n  // sub processes and participants\n  if (isAny(element, [ 'bpmn:Task', 'bpmn:CallActivity']) ||\n      isCollapsedPool(element) ||\n      isCollapsedSubProcess(element)) {\n\n    assign(bounds, {\n      width: bbox.width,\n      height: bbox.height\n    });\n\n    assign(style, {\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight,\n      paddingTop: (7 * zoom) + 'px',\n      paddingBottom: (7 * zoom) + 'px',\n      paddingLeft: (5 * zoom) + 'px',\n      paddingRight: (5 * zoom) + 'px'\n    });\n  }\n\n\n  // internal labels for expanded sub processes\n  if (isExpandedSubProcess(element)) {\n    assign(bounds, {\n      width: bbox.width,\n      x: bbox.x\n    });\n\n    assign(style, {\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight,\n      paddingTop: (7 * zoom) + 'px',\n      paddingBottom: (7 * zoom) + 'px',\n      paddingLeft: (5 * zoom) + 'px',\n      paddingRight: (5 * zoom) + 'px'\n    });\n  }\n\n  var width = 90 * zoom,\n      paddingTop = 7 * zoom,\n      paddingBottom = 4 * zoom;\n\n  // external labels for events, data elements, gateways and connections\n  if (target.labelTarget) {\n    assign(bounds, {\n      width: width,\n      height: bbox.height + paddingTop + paddingBottom,\n      x: mid.x - width / 2,\n      y: bbox.y - paddingTop\n    });\n\n    assign(style, {\n      fontSize: externalFontSize + 'px',\n      lineHeight: externalLineHeight,\n      paddingTop: paddingTop + 'px',\n      paddingBottom: paddingBottom + 'px'\n    });\n  }\n\n  // external label not yet created\n  if (isLabelExternal(target)\n      && !hasExternalLabel(target)\n      && !isLabel(target)) {\n\n    var externalLabelMid = getExternalLabelMid(element);\n\n    var absoluteBBox = canvas.getAbsoluteBBox({\n      x: externalLabelMid.x,\n      y: externalLabelMid.y,\n      width: 0,\n      height: 0\n    });\n\n    var height = externalFontSize + paddingTop + paddingBottom;\n\n    assign(bounds, {\n      width: width,\n      height: height,\n      x: absoluteBBox.x - width / 2,\n      y: absoluteBBox.y - height / 2\n    });\n\n    assign(style, {\n      fontSize: externalFontSize + 'px',\n      lineHeight: externalLineHeight,\n      paddingTop: paddingTop + 'px',\n      paddingBottom: paddingBottom + 'px'\n    });\n  }\n\n  // text annotations\n  if (is(element, 'bpmn:TextAnnotation')) {\n    assign(bounds, {\n      width: bbox.width,\n      height: bbox.height,\n      minWidth: 30 * zoom,\n      minHeight: 10 * zoom\n    });\n\n    assign(style, {\n      textAlign: 'left',\n      paddingTop: (5 * zoom) + 'px',\n      paddingBottom: (7 * zoom) + 'px',\n      paddingLeft: (7 * zoom) + 'px',\n      paddingRight: (5 * zoom) + 'px',\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight\n    });\n  }\n\n  return { bounds: bounds, style: style };\n};\n\n\nLabelEditingProvider.prototype.update = function(\n    element, newLabel,\n    activeContextText, bounds) {\n\n  var newBounds,\n      bbox;\n\n  if (is(element, 'bpmn:TextAnnotation')) {\n\n    bbox = this._canvas.getAbsoluteBBox(element);\n\n    newBounds = {\n      x: element.x,\n      y: element.y,\n      width: element.width / bbox.width * bounds.width,\n      height: element.height / bbox.height * bounds.height\n    };\n  }\n\n  if (isEmptyText(newLabel)) {\n    newLabel = null;\n  }\n\n  this._modeling.updateLabel(element, newLabel, newBounds);\n};\n\n\n\n// helpers //////////////////////\n\nfunction isCollapsedSubProcess(element) {\n  return is(element, 'bpmn:SubProcess') && !isExpanded(element);\n}\n\nfunction isExpandedSubProcess(element) {\n  return is(element, 'bpmn:SubProcess') && isExpanded(element);\n}\n\nfunction isCollapsedPool(element) {\n  return is(element, 'bpmn:Participant') && !isExpanded(element);\n}\n\nfunction isExpandedPool(element) {\n  return is(element, 'bpmn:Participant') && isExpanded(element);\n}\n\nfunction isEmptyText(label) {\n  return !label || !label.trim();\n}"]},"metadata":{},"sourceType":"module"}