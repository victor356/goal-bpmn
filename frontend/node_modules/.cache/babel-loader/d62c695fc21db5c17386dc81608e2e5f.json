{"ast":null,"code":"import { assign, bind, pick } from 'min-dash';\nimport { domify, query as domQuery, event as domEvent, remove as domRemove } from 'min-dom';\nvar min = Math.min,\n    max = Math.max;\n\nfunction preventDefault(e) {\n  e.preventDefault();\n}\n\nfunction stopPropagation(e) {\n  e.stopPropagation();\n}\n\nfunction isTextNode(node) {\n  return node.nodeType === Node.TEXT_NODE;\n}\n\nfunction toArray(nodeList) {\n  return [].slice.call(nodeList);\n}\n/**\n * Initializes a container for a content editable div.\n *\n * Structure:\n *\n * container\n *   parent\n *     content\n *     resize-handle\n *\n * @param {object} options\n * @param {DOMElement} options.container The DOM element to append the contentContainer to\n * @param {Function} options.keyHandler Handler for key events\n * @param {Function} options.resizeHandler Handler for resize events\n */\n\n\nexport default function TextBox(options) {\n  this.container = options.container;\n  this.parent = domify('<div class=\"djs-direct-editing-parent\">' + '<div class=\"djs-direct-editing-content\" contenteditable=\"true\"></div>' + '</div>');\n  this.content = domQuery('[contenteditable]', this.parent);\n\n  this.keyHandler = options.keyHandler || function () {};\n\n  this.resizeHandler = options.resizeHandler || function () {};\n\n  this.autoResize = bind(this.autoResize, this);\n  this.handlePaste = bind(this.handlePaste, this);\n}\n/**\n * Create a text box with the given position, size, style and text content\n *\n * @param {Object} bounds\n * @param {Number} bounds.x absolute x position\n * @param {Number} bounds.y absolute y position\n * @param {Number} [bounds.width] fixed width value\n * @param {Number} [bounds.height] fixed height value\n * @param {Number} [bounds.maxWidth] maximum width value\n * @param {Number} [bounds.maxHeight] maximum height value\n * @param {Number} [bounds.minWidth] minimum width value\n * @param {Number} [bounds.minHeight] minimum height value\n * @param {Object} [style]\n * @param {String} value text content\n *\n * @return {DOMElement} The created content DOM element\n */\n\nTextBox.prototype.create = function (bounds, style, value, options) {\n  var self = this;\n  var parent = this.parent,\n      content = this.content,\n      container = this.container;\n  options = this.options = options || {};\n  style = this.style = style || {};\n  var parentStyle = pick(style, ['width', 'height', 'maxWidth', 'maxHeight', 'minWidth', 'minHeight', 'left', 'top', 'backgroundColor', 'position', 'overflow', 'border', 'wordWrap', 'textAlign', 'outline', 'transform']);\n  assign(parent.style, {\n    width: bounds.width + 'px',\n    height: bounds.height + 'px',\n    maxWidth: bounds.maxWidth + 'px',\n    maxHeight: bounds.maxHeight + 'px',\n    minWidth: bounds.minWidth + 'px',\n    minHeight: bounds.minHeight + 'px',\n    left: bounds.x + 'px',\n    top: bounds.y + 'px',\n    backgroundColor: '#ffffff',\n    position: 'absolute',\n    overflow: 'visible',\n    border: '1px solid #ccc',\n    boxSizing: 'border-box',\n    wordWrap: 'normal',\n    textAlign: 'center',\n    outline: 'none'\n  }, parentStyle);\n  var contentStyle = pick(style, ['fontFamily', 'fontSize', 'fontWeight', 'lineHeight', 'padding', 'paddingTop', 'paddingRight', 'paddingBottom', 'paddingLeft']);\n  assign(content.style, {\n    boxSizing: 'border-box',\n    width: '100%',\n    outline: 'none',\n    wordWrap: 'break-word'\n  }, contentStyle);\n\n  if (options.centerVertically) {\n    assign(content.style, {\n      position: 'absolute',\n      top: '50%',\n      transform: 'translate(0, -50%)'\n    }, contentStyle);\n  }\n\n  content.innerText = value;\n  domEvent.bind(content, 'keydown', this.keyHandler);\n  domEvent.bind(content, 'mousedown', stopPropagation);\n  domEvent.bind(content, 'paste', self.handlePaste);\n\n  if (options.autoResize) {\n    domEvent.bind(content, 'input', this.autoResize);\n  }\n\n  if (options.resizable) {\n    this.resizable(style);\n  }\n\n  container.appendChild(parent); // set selection to end of text\n\n  this.setSelection(content.lastChild, content.lastChild && content.lastChild.length);\n  return parent;\n};\n/**\n * Intercept paste events to remove formatting from pasted text.\n */\n\n\nTextBox.prototype.handlePaste = function (e) {\n  var options = this.options,\n      style = this.style;\n  e.preventDefault();\n  var text;\n\n  if (e.clipboardData) {\n    // Chrome, Firefox, Safari\n    text = e.clipboardData.getData('text/plain');\n  } else {\n    // Internet Explorer\n    text = window.clipboardData.getData('Text');\n  }\n\n  this.insertText(text);\n\n  if (options.autoResize) {\n    var hasResized = this.autoResize(style);\n\n    if (hasResized) {\n      this.resizeHandler(hasResized);\n    }\n  }\n};\n\nTextBox.prototype.insertText = function (text) {\n  text = normalizeEndOfLineSequences(text); // insertText command not supported by Internet Explorer\n\n  var success = document.execCommand('insertText', false, text);\n\n  if (success) {\n    return;\n  }\n\n  this._insertTextIE(text);\n};\n\nTextBox.prototype._insertTextIE = function (text) {\n  // Internet Explorer\n  var range = this.getSelection(),\n      startContainer = range.startContainer,\n      endContainer = range.endContainer,\n      startOffset = range.startOffset,\n      endOffset = range.endOffset,\n      commonAncestorContainer = range.commonAncestorContainer;\n  var childNodesArray = toArray(commonAncestorContainer.childNodes);\n  var container, offset;\n\n  if (isTextNode(commonAncestorContainer)) {\n    var containerTextContent = startContainer.textContent;\n    startContainer.textContent = containerTextContent.substring(0, startOffset) + text + containerTextContent.substring(endOffset);\n    container = startContainer;\n    offset = startOffset + text.length;\n  } else if (startContainer === this.content && endContainer === this.content) {\n    var textNode = document.createTextNode(text);\n    this.content.insertBefore(textNode, childNodesArray[startOffset]);\n    container = textNode;\n    offset = textNode.textContent.length;\n  } else {\n    var startContainerChildIndex = childNodesArray.indexOf(startContainer),\n        endContainerChildIndex = childNodesArray.indexOf(endContainer);\n    childNodesArray.forEach(function (childNode, index) {\n      if (index === startContainerChildIndex) {\n        childNode.textContent = startContainer.textContent.substring(0, startOffset) + text + endContainer.textContent.substring(endOffset);\n      } else if (index > startContainerChildIndex && index <= endContainerChildIndex) {\n        domRemove(childNode);\n      }\n    });\n    container = startContainer;\n    offset = startOffset + text.length;\n  }\n\n  if (container && offset !== undefined) {\n    // is necessary in Internet Explorer\n    setTimeout(function () {\n      self.setSelection(container, offset);\n    });\n  }\n};\n/**\n * Automatically resize element vertically to fit its content.\n */\n\n\nTextBox.prototype.autoResize = function () {\n  var parent = this.parent,\n      content = this.content;\n  var fontSize = parseInt(this.style.fontSize) || 12;\n\n  if (content.scrollHeight > parent.offsetHeight || content.scrollHeight < parent.offsetHeight - fontSize) {\n    var bounds = parent.getBoundingClientRect();\n    var height = content.scrollHeight;\n    parent.style.height = height + 'px';\n    this.resizeHandler({\n      width: bounds.width,\n      height: bounds.height,\n      dx: 0,\n      dy: height - bounds.height\n    });\n  }\n};\n/**\n * Make an element resizable by adding a resize handle.\n */\n\n\nTextBox.prototype.resizable = function () {\n  var self = this;\n  var parent = this.parent,\n      resizeHandle = this.resizeHandle;\n  var minWidth = parseInt(this.style.minWidth) || 0,\n      minHeight = parseInt(this.style.minHeight) || 0,\n      maxWidth = parseInt(this.style.maxWidth) || Infinity,\n      maxHeight = parseInt(this.style.maxHeight) || Infinity;\n\n  if (!resizeHandle) {\n    resizeHandle = this.resizeHandle = domify('<div class=\"djs-direct-editing-resize-handle\"></div>');\n    var startX, startY, startWidth, startHeight;\n\n    var onMouseDown = function (e) {\n      preventDefault(e);\n      stopPropagation(e);\n      startX = e.clientX;\n      startY = e.clientY;\n      var bounds = parent.getBoundingClientRect();\n      startWidth = bounds.width;\n      startHeight = bounds.height;\n      domEvent.bind(document, 'mousemove', onMouseMove);\n      domEvent.bind(document, 'mouseup', onMouseUp);\n    };\n\n    var onMouseMove = function (e) {\n      preventDefault(e);\n      stopPropagation(e);\n      var newWidth = min(max(startWidth + e.clientX - startX, minWidth), maxWidth);\n      var newHeight = min(max(startHeight + e.clientY - startY, minHeight), maxHeight);\n      parent.style.width = newWidth + 'px';\n      parent.style.height = newHeight + 'px';\n      self.resizeHandler({\n        width: startWidth,\n        height: startHeight,\n        dx: e.clientX - startX,\n        dy: e.clientY - startY\n      });\n    };\n\n    var onMouseUp = function (e) {\n      preventDefault(e);\n      stopPropagation(e);\n      domEvent.unbind(document, 'mousemove', onMouseMove, false);\n      domEvent.unbind(document, 'mouseup', onMouseUp, false);\n    };\n\n    domEvent.bind(resizeHandle, 'mousedown', onMouseDown);\n  }\n\n  assign(resizeHandle.style, {\n    position: 'absolute',\n    bottom: '0px',\n    right: '0px',\n    cursor: 'nwse-resize',\n    width: '0',\n    height: '0',\n    borderTop: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid transparent',\n    borderRight: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid #ccc',\n    borderBottom: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid #ccc',\n    borderLeft: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid transparent'\n  });\n  parent.appendChild(resizeHandle);\n};\n/**\n * Clear content and style of the textbox, unbind listeners and\n * reset CSS style.\n */\n\n\nTextBox.prototype.destroy = function () {\n  var parent = this.parent,\n      content = this.content,\n      resizeHandle = this.resizeHandle; // clear content\n\n  content.innerText = ''; // clear styles\n\n  parent.removeAttribute('style');\n  content.removeAttribute('style');\n  domEvent.unbind(content, 'keydown', this.keyHandler);\n  domEvent.unbind(content, 'mousedown', stopPropagation);\n  domEvent.unbind(content, 'input', this.autoResize);\n  domEvent.unbind(content, 'paste', this.handlePaste);\n\n  if (resizeHandle) {\n    resizeHandle.removeAttribute('style');\n    domRemove(resizeHandle);\n  }\n\n  domRemove(parent);\n};\n\nTextBox.prototype.getValue = function () {\n  return this.content.innerText.trim();\n};\n\nTextBox.prototype.getSelection = function () {\n  var selection = window.getSelection(),\n      range = selection.getRangeAt(0);\n  return range;\n};\n\nTextBox.prototype.setSelection = function (container, offset) {\n  var range = document.createRange();\n\n  if (container === null) {\n    range.selectNodeContents(this.content);\n  } else {\n    range.setStart(container, offset);\n    range.setEnd(container, offset);\n  }\n\n  var selection = window.getSelection();\n  selection.removeAllRanges();\n  selection.addRange(range);\n}; // helpers //////////\n\n\nfunction normalizeEndOfLineSequences(string) {\n  return string.replace(/\\r\\n|\\r|\\n/g, '\\n');\n}","map":{"version":3,"sources":["C:/Users/Vittorio/Documents/GitHub/goal-bpmn/frontend/node_modules/diagram-js-direct-editing/lib/TextBox.js"],"names":["assign","bind","pick","domify","query","domQuery","event","domEvent","remove","domRemove","min","Math","max","preventDefault","e","stopPropagation","isTextNode","node","nodeType","Node","TEXT_NODE","toArray","nodeList","slice","call","TextBox","options","container","parent","content","keyHandler","resizeHandler","autoResize","handlePaste","prototype","create","bounds","style","value","self","parentStyle","width","height","maxWidth","maxHeight","minWidth","minHeight","left","x","top","y","backgroundColor","position","overflow","border","boxSizing","wordWrap","textAlign","outline","contentStyle","centerVertically","transform","innerText","resizable","appendChild","setSelection","lastChild","length","text","clipboardData","getData","window","insertText","hasResized","normalizeEndOfLineSequences","success","document","execCommand","_insertTextIE","range","getSelection","startContainer","endContainer","startOffset","endOffset","commonAncestorContainer","childNodesArray","childNodes","offset","containerTextContent","textContent","substring","textNode","createTextNode","insertBefore","startContainerChildIndex","indexOf","endContainerChildIndex","forEach","childNode","index","undefined","setTimeout","fontSize","parseInt","scrollHeight","offsetHeight","getBoundingClientRect","dx","dy","resizeHandle","Infinity","startX","startY","startWidth","startHeight","onMouseDown","clientX","clientY","onMouseMove","onMouseUp","newWidth","newHeight","unbind","bottom","right","cursor","borderTop","borderRight","borderBottom","borderLeft","destroy","removeAttribute","getValue","trim","selection","getRangeAt","createRange","selectNodeContents","setStart","setEnd","removeAllRanges","addRange","string","replace"],"mappings":"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","sourcesContent":["import {\n  assign,\n  bind,\n  pick\n} from 'min-dash';\n\nimport {\n  domify,\n  query as domQuery,\n  event as domEvent,\n  remove as domRemove\n} from 'min-dom';\n\nvar min = Math.min,\n    max = Math.max;\n\nfunction preventDefault(e) {\n  e.preventDefault();\n}\n\nfunction stopPropagation(e) {\n  e.stopPropagation();\n}\n\nfunction isTextNode(node) {\n  return node.nodeType === Node.TEXT_NODE;\n}\n\nfunction toArray(nodeList) {\n  return [].slice.call(nodeList);\n}\n\n/**\n * Initializes a container for a content editable div.\n *\n * Structure:\n *\n * container\n *   parent\n *     content\n *     resize-handle\n *\n * @param {object} options\n * @param {DOMElement} options.container The DOM element to append the contentContainer to\n * @param {Function} options.keyHandler Handler for key events\n * @param {Function} options.resizeHandler Handler for resize events\n */\nexport default function TextBox(options) {\n  this.container = options.container;\n\n  this.parent = domify(\n    '<div class=\"djs-direct-editing-parent\">' +\n      '<div class=\"djs-direct-editing-content\" contenteditable=\"true\"></div>' +\n    '</div>'\n  );\n\n  this.content = domQuery('[contenteditable]', this.parent);\n\n  this.keyHandler = options.keyHandler || function() {};\n  this.resizeHandler = options.resizeHandler || function() {};\n\n  this.autoResize = bind(this.autoResize, this);\n  this.handlePaste = bind(this.handlePaste, this);\n}\n\n\n/**\n * Create a text box with the given position, size, style and text content\n *\n * @param {Object} bounds\n * @param {Number} bounds.x absolute x position\n * @param {Number} bounds.y absolute y position\n * @param {Number} [bounds.width] fixed width value\n * @param {Number} [bounds.height] fixed height value\n * @param {Number} [bounds.maxWidth] maximum width value\n * @param {Number} [bounds.maxHeight] maximum height value\n * @param {Number} [bounds.minWidth] minimum width value\n * @param {Number} [bounds.minHeight] minimum height value\n * @param {Object} [style]\n * @param {String} value text content\n *\n * @return {DOMElement} The created content DOM element\n */\nTextBox.prototype.create = function(bounds, style, value, options) {\n  var self = this;\n\n  var parent = this.parent,\n      content = this.content,\n      container = this.container;\n\n  options = this.options = options || {};\n\n  style = this.style = style || {};\n\n  var parentStyle = pick(style, [\n    'width',\n    'height',\n    'maxWidth',\n    'maxHeight',\n    'minWidth',\n    'minHeight',\n    'left',\n    'top',\n    'backgroundColor',\n    'position',\n    'overflow',\n    'border',\n    'wordWrap',\n    'textAlign',\n    'outline',\n    'transform'\n  ]);\n\n  assign(parent.style, {\n    width: bounds.width + 'px',\n    height: bounds.height + 'px',\n    maxWidth: bounds.maxWidth + 'px',\n    maxHeight: bounds.maxHeight + 'px',\n    minWidth: bounds.minWidth + 'px',\n    minHeight: bounds.minHeight + 'px',\n    left: bounds.x + 'px',\n    top: bounds.y + 'px',\n    backgroundColor: '#ffffff',\n    position: 'absolute',\n    overflow: 'visible',\n    border: '1px solid #ccc',\n    boxSizing: 'border-box',\n    wordWrap: 'normal',\n    textAlign: 'center',\n    outline: 'none'\n  }, parentStyle);\n\n  var contentStyle = pick(style, [\n    'fontFamily',\n    'fontSize',\n    'fontWeight',\n    'lineHeight',\n    'padding',\n    'paddingTop',\n    'paddingRight',\n    'paddingBottom',\n    'paddingLeft'\n  ]);\n\n  assign(content.style, {\n    boxSizing: 'border-box',\n    width: '100%',\n    outline: 'none',\n    wordWrap: 'break-word'\n  }, contentStyle);\n\n  if (options.centerVertically) {\n    assign(content.style, {\n      position: 'absolute',\n      top: '50%',\n      transform: 'translate(0, -50%)'\n    }, contentStyle);\n  }\n\n  content.innerText = value;\n\n  domEvent.bind(content, 'keydown', this.keyHandler);\n  domEvent.bind(content, 'mousedown', stopPropagation);\n  domEvent.bind(content, 'paste', self.handlePaste);\n\n  if (options.autoResize) {\n    domEvent.bind(content, 'input', this.autoResize);\n  }\n\n  if (options.resizable) {\n    this.resizable(style);\n  }\n\n  container.appendChild(parent);\n\n  // set selection to end of text\n  this.setSelection(content.lastChild, content.lastChild && content.lastChild.length);\n\n  return parent;\n};\n\n/**\n * Intercept paste events to remove formatting from pasted text.\n */\nTextBox.prototype.handlePaste = function(e) {\n  var options = this.options,\n      style = this.style;\n\n  e.preventDefault();\n\n  var text;\n\n  if (e.clipboardData) {\n\n    // Chrome, Firefox, Safari\n    text = e.clipboardData.getData('text/plain');\n  } else {\n\n    // Internet Explorer\n    text = window.clipboardData.getData('Text');\n  }\n\n  this.insertText(text);\n\n  if (options.autoResize) {\n    var hasResized = this.autoResize(style);\n\n    if (hasResized) {\n      this.resizeHandler(hasResized);\n    }\n  }\n};\n\nTextBox.prototype.insertText = function(text) {\n  text = normalizeEndOfLineSequences(text);\n\n  // insertText command not supported by Internet Explorer\n  var success = document.execCommand('insertText', false, text);\n\n  if (success) {\n    return;\n  }\n\n  this._insertTextIE(text);\n};\n\nTextBox.prototype._insertTextIE = function(text) {\n\n  // Internet Explorer\n  var range = this.getSelection(),\n      startContainer = range.startContainer,\n      endContainer = range.endContainer,\n      startOffset = range.startOffset,\n      endOffset = range.endOffset,\n      commonAncestorContainer = range.commonAncestorContainer;\n\n  var childNodesArray = toArray(commonAncestorContainer.childNodes);\n\n  var container,\n      offset;\n\n  if (isTextNode(commonAncestorContainer)) {\n    var containerTextContent = startContainer.textContent;\n\n    startContainer.textContent =\n      containerTextContent.substring(0, startOffset)\n      + text\n      + containerTextContent.substring(endOffset);\n\n    container = startContainer;\n    offset = startOffset + text.length;\n\n  } else if (startContainer === this.content && endContainer === this.content) {\n    var textNode = document.createTextNode(text);\n\n    this.content.insertBefore(textNode, childNodesArray[startOffset]);\n\n    container = textNode;\n    offset = textNode.textContent.length;\n  } else {\n    var startContainerChildIndex = childNodesArray.indexOf(startContainer),\n        endContainerChildIndex = childNodesArray.indexOf(endContainer);\n\n    childNodesArray.forEach(function(childNode, index) {\n\n      if (index === startContainerChildIndex) {\n        childNode.textContent =\n          startContainer.textContent.substring(0, startOffset) +\n          text +\n          endContainer.textContent.substring(endOffset);\n      } else if (index > startContainerChildIndex && index <= endContainerChildIndex) {\n        domRemove(childNode);\n      }\n    });\n\n    container = startContainer;\n    offset = startOffset + text.length;\n  }\n\n  if (container && offset !== undefined) {\n\n    // is necessary in Internet Explorer\n    setTimeout(function() {\n      self.setSelection(container, offset);\n    });\n  }\n};\n\n/**\n * Automatically resize element vertically to fit its content.\n */\nTextBox.prototype.autoResize = function() {\n  var parent = this.parent,\n      content = this.content;\n\n  var fontSize = parseInt(this.style.fontSize) || 12;\n\n  if (content.scrollHeight > parent.offsetHeight ||\n      content.scrollHeight < parent.offsetHeight - fontSize) {\n    var bounds = parent.getBoundingClientRect();\n\n    var height = content.scrollHeight;\n    parent.style.height = height + 'px';\n\n    this.resizeHandler({\n      width: bounds.width,\n      height: bounds.height,\n      dx: 0,\n      dy: height - bounds.height\n    });\n  }\n};\n\n/**\n * Make an element resizable by adding a resize handle.\n */\nTextBox.prototype.resizable = function() {\n  var self = this;\n\n  var parent = this.parent,\n      resizeHandle = this.resizeHandle;\n\n  var minWidth = parseInt(this.style.minWidth) || 0,\n      minHeight = parseInt(this.style.minHeight) || 0,\n      maxWidth = parseInt(this.style.maxWidth) || Infinity,\n      maxHeight = parseInt(this.style.maxHeight) || Infinity;\n\n  if (!resizeHandle) {\n    resizeHandle = this.resizeHandle = domify(\n      '<div class=\"djs-direct-editing-resize-handle\"></div>'\n    );\n\n    var startX, startY, startWidth, startHeight;\n\n    var onMouseDown = function(e) {\n      preventDefault(e);\n      stopPropagation(e);\n\n      startX = e.clientX;\n      startY = e.clientY;\n\n      var bounds = parent.getBoundingClientRect();\n\n      startWidth = bounds.width;\n      startHeight = bounds.height;\n\n      domEvent.bind(document, 'mousemove', onMouseMove);\n      domEvent.bind(document, 'mouseup', onMouseUp);\n    };\n\n    var onMouseMove = function(e) {\n      preventDefault(e);\n      stopPropagation(e);\n\n      var newWidth = min(max(startWidth + e.clientX - startX, minWidth), maxWidth);\n      var newHeight = min(max(startHeight + e.clientY - startY, minHeight), maxHeight);\n\n      parent.style.width = newWidth + 'px';\n      parent.style.height = newHeight + 'px';\n\n      self.resizeHandler({\n        width: startWidth,\n        height: startHeight,\n        dx: e.clientX - startX,\n        dy: e.clientY - startY\n      });\n    };\n\n    var onMouseUp = function(e) {\n      preventDefault(e);\n      stopPropagation(e);\n\n      domEvent.unbind(document,'mousemove', onMouseMove, false);\n      domEvent.unbind(document, 'mouseup', onMouseUp, false);\n    };\n\n    domEvent.bind(resizeHandle, 'mousedown', onMouseDown);\n  }\n\n  assign(resizeHandle.style, {\n    position: 'absolute',\n    bottom: '0px',\n    right: '0px',\n    cursor: 'nwse-resize',\n    width: '0',\n    height: '0',\n    borderTop: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid transparent',\n    borderRight: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid #ccc',\n    borderBottom: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid #ccc',\n    borderLeft: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid transparent'\n  });\n\n  parent.appendChild(resizeHandle);\n};\n\n\n/**\n * Clear content and style of the textbox, unbind listeners and\n * reset CSS style.\n */\nTextBox.prototype.destroy = function() {\n  var parent = this.parent,\n      content = this.content,\n      resizeHandle = this.resizeHandle;\n\n  // clear content\n  content.innerText = '';\n\n  // clear styles\n  parent.removeAttribute('style');\n  content.removeAttribute('style');\n\n  domEvent.unbind(content, 'keydown', this.keyHandler);\n  domEvent.unbind(content, 'mousedown', stopPropagation);\n  domEvent.unbind(content, 'input', this.autoResize);\n  domEvent.unbind(content, 'paste', this.handlePaste);\n\n  if (resizeHandle) {\n    resizeHandle.removeAttribute('style');\n\n    domRemove(resizeHandle);\n  }\n\n  domRemove(parent);\n};\n\n\nTextBox.prototype.getValue = function() {\n  return this.content.innerText.trim();\n};\n\n\nTextBox.prototype.getSelection = function() {\n  var selection = window.getSelection(),\n      range = selection.getRangeAt(0);\n\n  return range;\n};\n\n\nTextBox.prototype.setSelection = function(container, offset) {\n  var range = document.createRange();\n\n  if (container === null) {\n    range.selectNodeContents(this.content);\n  } else {\n    range.setStart(container, offset);\n    range.setEnd(container, offset);\n  }\n\n  var selection = window.getSelection();\n\n  selection.removeAllRanges();\n  selection.addRange(range);\n};\n\n// helpers //////////\n\nfunction normalizeEndOfLineSequences(string) {\n  return string.replace(/\\r\\n|\\r|\\n/g, '\\n');\n}"]},"metadata":{},"sourceType":"module"}