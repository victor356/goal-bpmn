{"ast":null,"code":"import { some } from 'min-dash';\n/**\n * A handler that implements reversible appending of shapes\n * to a source shape.\n *\n * @param {canvas} Canvas\n * @param {elementFactory} ElementFactory\n * @param {modeling} Modeling\n */\n\nexport default function AppendShapeHandler(modeling) {\n  this._modeling = modeling;\n}\nAppendShapeHandler.$inject = ['modeling']; // api //////////////////////\n\n/**\n * Creates a new shape\n *\n * @param {Object} context\n * @param {ElementDescriptor} context.shape the new shape\n * @param {ElementDescriptor} context.source the source object\n * @param {ElementDescriptor} context.parent the parent object\n * @param {Point} context.position position of the new element\n */\n\nAppendShapeHandler.prototype.preExecute = function (context) {\n  var source = context.source;\n\n  if (!source) {\n    throw new Error('source required');\n  }\n\n  var target = context.target || source.parent,\n      shape = context.shape;\n  shape = context.shape = this._modeling.createShape(shape, context.position, target, {\n    attach: context.attach\n  });\n  context.shape = shape;\n};\n\nAppendShapeHandler.prototype.postExecute = function (context) {\n  var parent = context.connectionParent || context.shape.parent;\n\n  if (!existsConnection(context.source, context.shape)) {\n    // create connection\n    this._modeling.connect(context.source, context.shape, context.connection, parent);\n  }\n};\n\nfunction existsConnection(source, target) {\n  return some(source.outgoing, function (c) {\n    return c.target === target;\n  });\n}","map":{"version":3,"sources":["C:/Users/Vittorio/Documents/GitHub/goal-bpmn/frontend/node_modules/diagram-js/lib/features/modeling/cmd/AppendShapeHandler.js"],"names":["some","AppendShapeHandler","modeling","_modeling","$inject","prototype","preExecute","context","source","Error","target","parent","shape","createShape","position","attach","postExecute","connectionParent","existsConnection","connect","connection","outgoing","c"],"mappings":"AAAA,SAASA,IAAT,QAAqB,UAArB;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,eAAe,SAASC,kBAAT,CAA4BC,QAA5B,EAAsC;AACnD,OAAKC,SAAL,GAAiBD,QAAjB;AACD;AAEDD,kBAAkB,CAACG,OAAnB,GAA6B,CAAE,UAAF,CAA7B,C,CAGA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACAH,kBAAkB,CAACI,SAAnB,CAA6BC,UAA7B,GAA0C,UAASC,OAAT,EAAkB;AAE1D,MAAIC,MAAM,GAAGD,OAAO,CAACC,MAArB;;AAEA,MAAI,CAACA,MAAL,EAAa;AACX,UAAM,IAAIC,KAAJ,CAAU,iBAAV,CAAN;AACD;;AAED,MAAIC,MAAM,GAAGH,OAAO,CAACG,MAAR,IAAkBF,MAAM,CAACG,MAAtC;AAAA,MACIC,KAAK,GAAGL,OAAO,CAACK,KADpB;AAGAA,EAAAA,KAAK,GAAGL,OAAO,CAACK,KAAR,GACN,KAAKT,SAAL,CAAeU,WAAf,CACED,KADF,EAEEL,OAAO,CAACO,QAFV,EAGEJ,MAHF,EAGU;AAAEK,IAAAA,MAAM,EAAER,OAAO,CAACQ;AAAlB,GAHV,CADF;AAMAR,EAAAA,OAAO,CAACK,KAAR,GAAgBA,KAAhB;AACD,CAlBD;;AAoBAX,kBAAkB,CAACI,SAAnB,CAA6BW,WAA7B,GAA2C,UAAST,OAAT,EAAkB;AAC3D,MAAII,MAAM,GAAGJ,OAAO,CAACU,gBAAR,IAA4BV,OAAO,CAACK,KAAR,CAAcD,MAAvD;;AAEA,MAAI,CAACO,gBAAgB,CAACX,OAAO,CAACC,MAAT,EAAiBD,OAAO,CAACK,KAAzB,CAArB,EAAsD;AAEpD;AACA,SAAKT,SAAL,CAAegB,OAAf,CAAuBZ,OAAO,CAACC,MAA/B,EAAuCD,OAAO,CAACK,KAA/C,EAAsDL,OAAO,CAACa,UAA9D,EAA0ET,MAA1E;AACD;AACF,CARD;;AAWA,SAASO,gBAAT,CAA0BV,MAA1B,EAAkCE,MAAlC,EAA0C;AACxC,SAAOV,IAAI,CAACQ,MAAM,CAACa,QAAR,EAAkB,UAASC,CAAT,EAAY;AACvC,WAAOA,CAAC,CAACZ,MAAF,KAAaA,MAApB;AACD,GAFU,CAAX;AAGD","sourcesContent":["import { some } from 'min-dash';\n\n\n/**\n * A handler that implements reversible appending of shapes\n * to a source shape.\n *\n * @param {canvas} Canvas\n * @param {elementFactory} ElementFactory\n * @param {modeling} Modeling\n */\nexport default function AppendShapeHandler(modeling) {\n  this._modeling = modeling;\n}\n\nAppendShapeHandler.$inject = [ 'modeling' ];\n\n\n// api //////////////////////\n\n\n/**\n * Creates a new shape\n *\n * @param {Object} context\n * @param {ElementDescriptor} context.shape the new shape\n * @param {ElementDescriptor} context.source the source object\n * @param {ElementDescriptor} context.parent the parent object\n * @param {Point} context.position position of the new element\n */\nAppendShapeHandler.prototype.preExecute = function(context) {\n\n  var source = context.source;\n\n  if (!source) {\n    throw new Error('source required');\n  }\n\n  var target = context.target || source.parent,\n      shape = context.shape;\n\n  shape = context.shape =\n    this._modeling.createShape(\n      shape,\n      context.position,\n      target, { attach: context.attach });\n\n  context.shape = shape;\n};\n\nAppendShapeHandler.prototype.postExecute = function(context) {\n  var parent = context.connectionParent || context.shape.parent;\n\n  if (!existsConnection(context.source, context.shape)) {\n\n    // create connection\n    this._modeling.connect(context.source, context.shape, context.connection, parent);\n  }\n};\n\n\nfunction existsConnection(source, target) {\n  return some(source.outgoing, function(c) {\n    return c.target === target;\n  });\n}"]},"metadata":{},"sourceType":"module"}