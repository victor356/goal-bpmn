{"ast":null,"code":"'use strict';\n\nvar getBusinessObject = require('bpmn-js/lib/util/ModelUtil').getBusinessObject;\n\nvar domQuery = require('min-dom').query,\n    domClosest = require('min-dom').closest,\n    domify = require('min-dom').domify,\n    forEach = require('lodash/forEach');\n\nvar elementHelper = require('../../../../helper/ElementHelper'),\n    cmdHelper = require('../../../../helper/CmdHelper'),\n    utils = require('../../../../Utils');\n\nfunction getSelectBox(node, id) {\n  var currentTab = domClosest(node, 'div.bpp-properties-tab');\n  var query = 'select[name=selectedExtensionElement]' + (id ? '[id=cam-extensionElements-' + id + ']' : '');\n  return domQuery(query, currentTab);\n}\n\nfunction getSelected(node, id) {\n  var selectBox = getSelectBox(node, id);\n  return {\n    value: (selectBox || {}).value,\n    idx: (selectBox || {}).selectedIndex\n  };\n}\n\nfunction generateElementId(prefix) {\n  prefix = prefix + '_';\n  return utils.nextId(prefix);\n}\n\nvar CREATE_EXTENSION_ELEMENT_ACTION = 'create-extension-element',\n    REMOVE_EXTENSION_ELEMENT_ACTION = 'remove-extension-element';\n\nmodule.exports = function (element, bpmnFactory, options, translate) {\n  var id = options.id,\n      prefix = options.prefix || 'elem',\n      label = options.label || id,\n      idGeneration = options.idGeneration === false ? options.idGeneration : true,\n      businessObject = options.businessObject || getBusinessObject(element);\n  var modelProperty = options.modelProperty || 'id';\n  var getElements = options.getExtensionElements;\n  var createElement = options.createExtensionElement,\n      canCreate = typeof createElement === 'function';\n  var removeElement = options.removeExtensionElement,\n      canRemove = typeof removeElement === 'function';\n  var onSelectionChange = options.onSelectionChange;\n  var hideElements = options.hideExtensionElements,\n      canBeHidden = typeof hideElements === 'function';\n  var setOptionLabelValue = options.setOptionLabelValue;\n  var defaultSize = options.size || 5,\n      resizable = options.resizable;\n  var reference = options.reference || undefined;\n\n  var selectionChanged = function (element, node, event, scope) {\n    if (typeof onSelectionChange === 'function') {\n      return onSelectionChange(element, node, event, scope);\n    }\n  };\n\n  var createOption = function (value) {\n    return '<option value=\"' + value + '\" data-value data-name=\"extensionElementValue\">' + value + '</option>';\n  };\n\n  var initSelectionSize = function (selectBox, optionsLength) {\n    if (resizable) {\n      selectBox.size = optionsLength > defaultSize ? optionsLength : defaultSize;\n    }\n  };\n\n  return {\n    id: id,\n    html: '<div class=\"bpp-row bpp-element-list\" ' + (canBeHidden ? 'data-show=\"hideElements\"' : '') + '>' + '<label for=\"cam-extensionElements-' + id + '\">' + label + '</label>' + '<div class=\"bpp-field-wrapper\">' + '<select id=\"cam-extensionElements-' + id + '\"' + 'name=\"selectedExtensionElement\" ' + 'size=\"' + defaultSize + '\" ' + 'data-list-entry-container ' + 'data-on-change=\"selectElement\">' + '</select>' + (canCreate ? '<button class=\"add\" ' + 'id=\"cam-extensionElements-create-' + id + '\" ' + 'data-action=\"createElement\">' + '<span>+</span>' + '</button>' : '') + (canRemove ? '<button class=\"clear\" ' + 'id=\"cam-extensionElements-remove-' + id + '\" ' + 'data-action=\"removeElement\" ' + 'data-disable=\"disableRemove\">' + '<span>-</span>' + '</button>' : '') + '</div>' + '</div>',\n    get: function (element, node) {\n      var elements = getElements(element, node);\n      var result = [];\n      forEach(elements, function (elem) {\n        result.push({\n          extensionElementValue: elem.get(modelProperty)\n        });\n      });\n      var selectBox = getSelectBox(node.parentNode, id);\n      initSelectionSize(selectBox, result.length);\n      return result;\n    },\n    set: function (element, values, node) {\n      var action = this.__action;\n      delete this.__action;\n      businessObject = businessObject || getBusinessObject(element);\n      var bo = reference && businessObject.get(reference) ? businessObject.get(reference) : businessObject;\n      var extensionElements = bo.get('extensionElements');\n\n      if (action.id === CREATE_EXTENSION_ELEMENT_ACTION) {\n        var commands = [];\n\n        if (!extensionElements) {\n          extensionElements = elementHelper.createElement('bpmn:ExtensionElements', {\n            values: []\n          }, bo, bpmnFactory);\n          commands.push(cmdHelper.updateBusinessObject(element, bo, {\n            extensionElements: extensionElements\n          }));\n        }\n\n        commands.push(createElement(element, extensionElements, action.value, node));\n        return commands;\n      } else if (action.id === REMOVE_EXTENSION_ELEMENT_ACTION) {\n        return removeElement(element, extensionElements, action.value, action.idx, node);\n      }\n    },\n    createListEntryTemplate: function (value, index, selectBox) {\n      initSelectionSize(selectBox, selectBox.options.length + 1);\n      return createOption(value.extensionElementValue);\n    },\n    deselect: function (element, node) {\n      var selectBox = getSelectBox(node, id);\n      selectBox.selectedIndex = -1;\n    },\n    getSelected: function (element, node) {\n      return getSelected(node, id);\n    },\n    setControlValue: function (element, node, option, property, value, idx) {\n      node.value = value;\n\n      if (!setOptionLabelValue) {\n        node.text = value;\n      } else {\n        setOptionLabelValue(element, node, option, property, value, idx);\n      }\n    },\n    createElement: function (element, node) {\n      // create option template\n      var generatedId;\n\n      if (idGeneration) {\n        generatedId = generateElementId(prefix);\n      }\n\n      var selectBox = getSelectBox(node, id);\n      var template = domify(createOption(generatedId)); // add new empty option as last child element\n\n      selectBox.appendChild(template); // select last child element\n\n      selectBox.lastChild.selected = 'selected';\n      selectionChanged(element, node); // update select box size\n\n      initSelectionSize(selectBox, selectBox.options.length);\n      this.__action = {\n        id: CREATE_EXTENSION_ELEMENT_ACTION,\n        value: generatedId\n      };\n      return true;\n    },\n    removeElement: function (element, node) {\n      var selection = getSelected(node, id);\n      var selectBox = getSelectBox(node, id);\n      selectBox.removeChild(selectBox.options[selection.idx]); // update select box size\n\n      initSelectionSize(selectBox, selectBox.options.length);\n      this.__action = {\n        id: REMOVE_EXTENSION_ELEMENT_ACTION,\n        value: selection.value,\n        idx: selection.idx\n      };\n      return true;\n    },\n    hideElements: function (element, entryNode, node, scopeNode) {\n      return !hideElements(element, entryNode, node, scopeNode);\n    },\n    disableRemove: function (element, entryNode, node, scopeNode) {\n      return (getSelected(entryNode, id) || {}).idx < 0;\n    },\n    selectElement: selectionChanged\n  };\n};","map":{"version":3,"sources":["C:/Users/Vittorio/Documents/GitHub/goal-bpmn/frontend/node_modules/bpmn-js-properties-panel/lib/provider/camunda/parts/implementation/ExtensionElements.js"],"names":["getBusinessObject","require","domQuery","query","domClosest","closest","domify","forEach","elementHelper","cmdHelper","utils","getSelectBox","node","id","currentTab","getSelected","selectBox","value","idx","selectedIndex","generateElementId","prefix","nextId","CREATE_EXTENSION_ELEMENT_ACTION","REMOVE_EXTENSION_ELEMENT_ACTION","module","exports","element","bpmnFactory","options","translate","label","idGeneration","businessObject","modelProperty","getElements","getExtensionElements","createElement","createExtensionElement","canCreate","removeElement","removeExtensionElement","canRemove","onSelectionChange","hideElements","hideExtensionElements","canBeHidden","setOptionLabelValue","defaultSize","size","resizable","reference","undefined","selectionChanged","event","scope","createOption","initSelectionSize","optionsLength","html","get","elements","result","elem","push","extensionElementValue","parentNode","length","set","values","action","__action","bo","extensionElements","commands","updateBusinessObject","createListEntryTemplate","index","deselect","setControlValue","option","property","text","generatedId","template","appendChild","lastChild","selected","selection","removeChild","entryNode","scopeNode","disableRemove","selectElement"],"mappings":"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","sourcesContent":["'use strict';\n\nvar getBusinessObject = require('bpmn-js/lib/util/ModelUtil').getBusinessObject;\n\nvar domQuery = require('min-dom').query,\n    domClosest = require('min-dom').closest,\n    domify = require('min-dom').domify,\n    forEach = require('lodash/forEach');\n\nvar elementHelper = require('../../../../helper/ElementHelper'),\n    cmdHelper = require('../../../../helper/CmdHelper'),\n    utils = require('../../../../Utils');\n\nfunction getSelectBox(node, id) {\n  var currentTab = domClosest(node, 'div.bpp-properties-tab');\n  var query = 'select[name=selectedExtensionElement]' + (id ? '[id=cam-extensionElements-' + id + ']' : '');\n  return domQuery(query, currentTab);\n}\n\nfunction getSelected(node, id) {\n  var selectBox = getSelectBox(node, id);\n  return {\n    value: (selectBox || {}).value,\n    idx: (selectBox || {}).selectedIndex\n  };\n}\n\nfunction generateElementId(prefix) {\n  prefix = prefix + '_';\n  return utils.nextId(prefix);\n}\n\nvar CREATE_EXTENSION_ELEMENT_ACTION = 'create-extension-element',\n    REMOVE_EXTENSION_ELEMENT_ACTION = 'remove-extension-element';\n\nmodule.exports = function(element, bpmnFactory, options, translate) {\n\n  var id = options.id,\n      prefix = options.prefix || 'elem',\n      label = options.label || id,\n      idGeneration = (options.idGeneration === false) ? options.idGeneration : true,\n      businessObject = options.businessObject || getBusinessObject(element);\n\n  var modelProperty = options.modelProperty || 'id';\n\n  var getElements = options.getExtensionElements;\n\n  var createElement = options.createExtensionElement,\n      canCreate = typeof createElement === 'function';\n\n  var removeElement = options.removeExtensionElement,\n      canRemove = typeof removeElement === 'function';\n\n  var onSelectionChange = options.onSelectionChange;\n\n  var hideElements = options.hideExtensionElements,\n      canBeHidden = typeof hideElements === 'function';\n\n  var setOptionLabelValue = options.setOptionLabelValue;\n\n  var defaultSize = options.size || 5,\n      resizable = options.resizable;\n\n  var reference = options.reference || undefined;\n\n  var selectionChanged = function(element, node, event, scope) {\n    if (typeof onSelectionChange === 'function') {\n      return onSelectionChange(element, node, event, scope);\n    }\n  };\n\n  var createOption = function(value) {\n    return '<option value=\"' + value + '\" data-value data-name=\"extensionElementValue\">' + value + '</option>';\n  };\n\n  var initSelectionSize = function(selectBox, optionsLength) {\n    if (resizable) {\n      selectBox.size = optionsLength > defaultSize ? optionsLength : defaultSize;\n    }\n  };\n\n  return {\n    id: id,\n    html: '<div class=\"bpp-row bpp-element-list\" ' +\n            (canBeHidden ? 'data-show=\"hideElements\"' : '') + '>' +\n            '<label for=\"cam-extensionElements-' + id + '\">' + label + '</label>' +\n            '<div class=\"bpp-field-wrapper\">' +\n              '<select id=\"cam-extensionElements-' + id + '\"' +\n                      'name=\"selectedExtensionElement\" ' +\n                      'size=\"' + defaultSize + '\" ' +\n                      'data-list-entry-container ' +\n                      'data-on-change=\"selectElement\">' +\n              '</select>' +\n              (canCreate ? '<button class=\"add\" ' +\n                                   'id=\"cam-extensionElements-create-' + id + '\" ' +\n                                   'data-action=\"createElement\">' +\n                             '<span>+</span>' +\n                           '</button>' : '') +\n              (canRemove ? '<button class=\"clear\" ' +\n                                   'id=\"cam-extensionElements-remove-' + id + '\" ' +\n                                   'data-action=\"removeElement\" ' +\n                                   'data-disable=\"disableRemove\">' +\n                             '<span>-</span>' +\n                           '</button>' : '') +\n            '</div>' +\n          '</div>',\n\n    get: function(element, node) {\n      var elements = getElements(element, node);\n\n      var result = [];\n      forEach(elements, function(elem) {\n        result.push({\n          extensionElementValue: elem.get(modelProperty)\n        });\n      });\n\n      var selectBox = getSelectBox(node.parentNode, id);\n      initSelectionSize(selectBox, result.length);\n\n      return result;\n    },\n\n    set: function(element, values, node) {\n      var action = this.__action;\n      delete this.__action;\n\n      businessObject = businessObject || getBusinessObject(element);\n\n      var bo =\n        (reference && businessObject.get(reference))\n          ? businessObject.get(reference)\n          : businessObject;\n\n      var extensionElements = bo.get('extensionElements');\n\n      if (action.id === CREATE_EXTENSION_ELEMENT_ACTION) {\n        var commands = [];\n        if (!extensionElements) {\n          extensionElements = elementHelper.createElement('bpmn:ExtensionElements', { values: [] }, bo, bpmnFactory);\n          commands.push(cmdHelper.updateBusinessObject(element, bo, { extensionElements: extensionElements }));\n        }\n        commands.push(createElement(element, extensionElements, action.value, node));\n        return commands;\n\n      }\n      else if (action.id === REMOVE_EXTENSION_ELEMENT_ACTION) {\n        return removeElement(element, extensionElements, action.value, action.idx, node);\n      }\n\n    },\n\n    createListEntryTemplate: function(value, index, selectBox) {\n      initSelectionSize(selectBox, selectBox.options.length + 1);\n      return createOption(value.extensionElementValue);\n    },\n\n    deselect: function(element, node) {\n      var selectBox = getSelectBox(node, id);\n      selectBox.selectedIndex = -1;\n    },\n\n    getSelected: function(element, node) {\n      return getSelected(node, id);\n    },\n\n    setControlValue: function(element, node, option, property, value, idx) {\n      node.value = value;\n\n      if (!setOptionLabelValue) {\n        node.text = value;\n      } else {\n        setOptionLabelValue(element, node, option, property, value, idx);\n      }\n    },\n\n    createElement: function(element, node) {\n      // create option template\n      var generatedId;\n      if (idGeneration) {\n        generatedId = generateElementId(prefix);\n      }\n\n      var selectBox = getSelectBox(node, id);\n      var template = domify(createOption(generatedId));\n\n      // add new empty option as last child element\n      selectBox.appendChild(template);\n\n      // select last child element\n      selectBox.lastChild.selected = 'selected';\n      selectionChanged(element, node);\n\n      // update select box size\n      initSelectionSize(selectBox, selectBox.options.length);\n\n      this.__action = {\n        id: CREATE_EXTENSION_ELEMENT_ACTION,\n        value: generatedId\n      };\n\n      return true;\n    },\n\n    removeElement: function(element, node) {\n      var selection = getSelected(node, id);\n\n      var selectBox = getSelectBox(node, id);\n      selectBox.removeChild(selectBox.options[selection.idx]);\n\n      // update select box size\n      initSelectionSize(selectBox, selectBox.options.length);\n\n      this.__action = {\n        id: REMOVE_EXTENSION_ELEMENT_ACTION,\n        value: selection.value,\n        idx: selection.idx\n      };\n\n      return true;\n    },\n\n    hideElements: function(element, entryNode, node, scopeNode) {\n      return !hideElements(element, entryNode, node, scopeNode);\n    },\n\n    disableRemove: function(element, entryNode, node, scopeNode) {\n      return (getSelected(entryNode, id) || {}).idx < 0;\n    },\n\n    selectElement: selectionChanged\n  };\n\n};\n"]},"metadata":{},"sourceType":"script"}