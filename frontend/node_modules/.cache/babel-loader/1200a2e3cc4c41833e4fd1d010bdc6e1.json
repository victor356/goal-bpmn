{"ast":null,"code":"import { clear as domClear, delegate as domDelegate, query as domQuery, classes as domClasses, attr as domAttr, domify } from 'min-dom';\nimport { getBBox as getBoundingBox } from '../../util/Elements';\nimport { escapeHTML } from '../../util/EscapeUtil';\n/**\n * Provides searching infrastructure\n */\n\nexport default function SearchPad(canvas, eventBus, overlays, selection) {\n  this._open = false;\n  this._results = [];\n  this._eventMaps = [];\n  this._canvas = canvas;\n  this._eventBus = eventBus;\n  this._overlays = overlays;\n  this._selection = selection; // setup elements\n\n  this._container = domify(SearchPad.BOX_HTML);\n  this._searchInput = domQuery(SearchPad.INPUT_SELECTOR, this._container);\n  this._resultsContainer = domQuery(SearchPad.RESULTS_CONTAINER_SELECTOR, this._container); // attach search pad\n\n  this._canvas.getContainer().appendChild(this._container); // cleanup on destroy\n\n\n  eventBus.on(['canvas.destroy', 'diagram.destroy'], this.close, this);\n}\nSearchPad.$inject = ['canvas', 'eventBus', 'overlays', 'selection'];\n/**\n * Binds and keeps track of all event listereners\n */\n\nSearchPad.prototype._bindEvents = function () {\n  var self = this;\n\n  function listen(el, selector, type, fn) {\n    self._eventMaps.push({\n      el: el,\n      type: type,\n      listener: domDelegate.bind(el, selector, type, fn)\n    });\n  } // close search on clicking anywhere outside\n\n\n  listen(document, 'html', 'click', function (e) {\n    self.close();\n  }, true); // stop event from propagating and closing search\n  // focus on input\n\n  listen(this._container, SearchPad.INPUT_SELECTOR, 'click', function (e) {\n    e.stopPropagation();\n    e.delegateTarget.focus();\n  }); // preselect result on hover\n\n  listen(this._container, SearchPad.RESULT_SELECTOR, 'mouseover', function (e) {\n    e.stopPropagation();\n\n    self._scrollToNode(e.delegateTarget);\n\n    self._preselect(e.delegateTarget);\n  }); // selects desired result on mouse click\n\n  listen(this._container, SearchPad.RESULT_SELECTOR, 'click', function (e) {\n    e.stopPropagation();\n\n    self._select(e.delegateTarget);\n  }); // prevent cursor in input from going left and right when using up/down to\n  // navigate results\n\n  listen(this._container, SearchPad.INPUT_SELECTOR, 'keydown', function (e) {\n    // up\n    if (e.keyCode === 38) {\n      e.preventDefault();\n    } // down\n\n\n    if (e.keyCode === 40) {\n      e.preventDefault();\n    }\n  }); // handle keyboard input\n\n  listen(this._container, SearchPad.INPUT_SELECTOR, 'keyup', function (e) {\n    // escape\n    if (e.keyCode === 27) {\n      return self.close();\n    } // enter\n\n\n    if (e.keyCode === 13) {\n      var selected = self._getCurrentResult();\n\n      return selected ? self._select(selected) : self.close();\n    } // up\n\n\n    if (e.keyCode === 38) {\n      return self._scrollToDirection(true);\n    } // down\n\n\n    if (e.keyCode === 40) {\n      return self._scrollToDirection();\n    } // left && right\n    // do not search while navigating text input\n\n\n    if (e.keyCode === 37 || e.keyCode === 39) {\n      return;\n    } // anything else\n\n\n    self._search(e.delegateTarget.value);\n  });\n};\n/**\n * Unbinds all previously established listeners\n */\n\n\nSearchPad.prototype._unbindEvents = function () {\n  this._eventMaps.forEach(function (m) {\n    domDelegate.unbind(m.el, m.type, m.listener);\n  });\n};\n/**\n * Performs a search for the given pattern.\n *\n * @param  {String} pattern\n */\n\n\nSearchPad.prototype._search = function (pattern) {\n  var self = this;\n\n  this._clearResults(); // do not search on empty query\n\n\n  if (!pattern || pattern === '') {\n    return;\n  }\n\n  var searchResults = this._searchProvider.find(pattern);\n\n  if (!searchResults.length) {\n    return;\n  } // append new results\n\n\n  searchResults.forEach(function (result) {\n    var id = result.element.id;\n\n    var node = self._createResultNode(result, id);\n\n    self._results[id] = {\n      element: result.element,\n      node: node\n    };\n  }); // preselect first result\n\n  var node = domQuery(SearchPad.RESULT_SELECTOR, this._resultsContainer);\n\n  this._scrollToNode(node);\n\n  this._preselect(node);\n};\n/**\n * Navigate to the previous/next result. Defaults to next result.\n * @param  {Boolean} previous\n */\n\n\nSearchPad.prototype._scrollToDirection = function (previous) {\n  var selected = this._getCurrentResult();\n\n  if (!selected) {\n    return;\n  }\n\n  var node = previous ? selected.previousElementSibling : selected.nextElementSibling;\n\n  if (node) {\n    this._scrollToNode(node);\n\n    this._preselect(node);\n  }\n};\n/**\n * Scroll to the node if it is not visible.\n *\n * @param  {Element} node\n */\n\n\nSearchPad.prototype._scrollToNode = function (node) {\n  if (!node || node === this._getCurrentResult()) {\n    return;\n  }\n\n  var nodeOffset = node.offsetTop;\n  var containerScroll = this._resultsContainer.scrollTop;\n  var bottomScroll = nodeOffset - this._resultsContainer.clientHeight + node.clientHeight;\n\n  if (nodeOffset < containerScroll) {\n    this._resultsContainer.scrollTop = nodeOffset;\n  } else if (containerScroll < bottomScroll) {\n    this._resultsContainer.scrollTop = bottomScroll;\n  }\n};\n/**\n * Clears all results data.\n */\n\n\nSearchPad.prototype._clearResults = function () {\n  domClear(this._resultsContainer);\n  this._results = [];\n\n  this._resetOverlay();\n\n  this._eventBus.fire('searchPad.cleared');\n};\n/**\n * Get currently selected result.\n *\n * @return {Element}\n */\n\n\nSearchPad.prototype._getCurrentResult = function () {\n  return domQuery(SearchPad.RESULT_SELECTED_SELECTOR, this._resultsContainer);\n};\n/**\n * Create result DOM element within results container\n * that corresponds to a search result.\n *\n * 'result' : one of the elements returned by SearchProvider\n * 'id' : id attribute value to assign to the new DOM node\n * return : created DOM element\n *\n * @param  {SearchResult} result\n * @param  {String} id\n * @return {Element}\n */\n\n\nSearchPad.prototype._createResultNode = function (result, id) {\n  var node = domify(SearchPad.RESULT_HTML); // create only if available\n\n  if (result.primaryTokens.length > 0) {\n    createInnerTextNode(node, result.primaryTokens, SearchPad.RESULT_PRIMARY_HTML);\n  } // secondary tokens (represent element ID) are allways available\n\n\n  createInnerTextNode(node, result.secondaryTokens, SearchPad.RESULT_SECONDARY_HTML);\n  domAttr(node, SearchPad.RESULT_ID_ATTRIBUTE, id);\n\n  this._resultsContainer.appendChild(node);\n\n  return node;\n};\n/**\n * Register search element provider.\n *\n * SearchProvider.find - provides search function over own elements\n *  (pattern) => [{ text: <String>, element: <Element>}, ...]\n *\n * @param  {SearchProvider} provider\n */\n\n\nSearchPad.prototype.registerProvider = function (provider) {\n  this._searchProvider = provider;\n};\n/**\n * Open search pad.\n */\n\n\nSearchPad.prototype.open = function () {\n  if (!this._searchProvider) {\n    throw new Error('no search provider registered');\n  }\n\n  if (this.isOpen()) {\n    return;\n  }\n\n  this._bindEvents();\n\n  this._open = true;\n  domClasses(this._container).add('open');\n\n  this._searchInput.focus();\n\n  this._eventBus.fire('searchPad.opened');\n};\n/**\n * Close search pad.\n */\n\n\nSearchPad.prototype.close = function () {\n  if (!this.isOpen()) {\n    return;\n  }\n\n  this._unbindEvents();\n\n  this._open = false;\n  domClasses(this._container).remove('open');\n\n  this._clearResults();\n\n  this._searchInput.value = '';\n\n  this._searchInput.blur();\n\n  this._resetOverlay();\n\n  this._eventBus.fire('searchPad.closed');\n};\n/**\n * Toggles search pad on/off.\n */\n\n\nSearchPad.prototype.toggle = function () {\n  this.isOpen() ? this.close() : this.open();\n};\n/**\n * Report state of search pad.\n */\n\n\nSearchPad.prototype.isOpen = function () {\n  return this._open;\n};\n/**\n * Preselect result entry.\n *\n * @param  {Element} element\n */\n\n\nSearchPad.prototype._preselect = function (node) {\n  var selectedNode = this._getCurrentResult(); // already selected\n\n\n  if (node === selectedNode) {\n    return;\n  } // removing preselection from current node\n\n\n  if (selectedNode) {\n    domClasses(selectedNode).remove(SearchPad.RESULT_SELECTED_CLASS);\n  }\n\n  var id = domAttr(node, SearchPad.RESULT_ID_ATTRIBUTE);\n  var element = this._results[id].element;\n  domClasses(node).add(SearchPad.RESULT_SELECTED_CLASS);\n\n  this._resetOverlay(element);\n\n  this._centerViewbox(element);\n\n  this._selection.select(element);\n\n  this._eventBus.fire('searchPad.preselected', element);\n};\n/**\n * Select result node.\n *\n * @param  {Element} element\n */\n\n\nSearchPad.prototype._select = function (node) {\n  var id = domAttr(node, SearchPad.RESULT_ID_ATTRIBUTE);\n  var element = this._results[id].element;\n  this.close();\n\n  this._resetOverlay();\n\n  this._centerViewbox(element);\n\n  this._selection.select(element);\n\n  this._eventBus.fire('searchPad.selected', element);\n};\n/**\n * Center viewbox on the element middle point.\n *\n * @param  {Element} element\n */\n\n\nSearchPad.prototype._centerViewbox = function (element) {\n  var viewbox = this._canvas.viewbox();\n\n  var box = getBoundingBox(element);\n  var newViewbox = {\n    x: box.x + box.width / 2 - viewbox.outer.width / 2,\n    y: box.y + box.height / 2 - viewbox.outer.height / 2,\n    width: viewbox.outer.width,\n    height: viewbox.outer.height\n  };\n\n  this._canvas.viewbox(newViewbox);\n\n  this._canvas.zoom(viewbox.scale);\n};\n/**\n * Reset overlay removes and, optionally, set\n * overlay to a new element.\n *\n * @param  {Element} element\n */\n\n\nSearchPad.prototype._resetOverlay = function (element) {\n  if (this._overlayId) {\n    this._overlays.remove(this._overlayId);\n  }\n\n  if (element) {\n    var box = getBoundingBox(element);\n    var overlay = constructOverlay(box);\n    this._overlayId = this._overlays.add(element, overlay);\n  }\n};\n/**\n * Construct overlay object for the given bounding box.\n *\n * @param  {BoundingBox} box\n * @return {Object}\n */\n\n\nfunction constructOverlay(box) {\n  var offset = 6;\n  var w = box.width + offset * 2;\n  var h = box.height + offset * 2;\n  var styles = ['width: ' + w + 'px', 'height: ' + h + 'px'].join('; ');\n  return {\n    position: {\n      bottom: h - offset,\n      right: w - offset\n    },\n    show: true,\n    html: '<div style=\"' + styles + '\" class=\"' + SearchPad.OVERLAY_CLASS + '\"></div>'\n  };\n}\n/**\n * Creates and appends child node from result tokens and HTML template.\n *\n * @param  {Element} node\n * @param  {Array<Object>} tokens\n * @param  {String} template\n */\n\n\nfunction createInnerTextNode(parentNode, tokens, template) {\n  var text = createHtmlText(tokens);\n  var childNode = domify(template);\n  childNode.innerHTML = text;\n  parentNode.appendChild(childNode);\n}\n/**\n * Create internal HTML markup from result tokens.\n * Caters for highlighting pattern matched tokens.\n *\n * @param  {Array<Object>} tokens\n * @return {String}\n */\n\n\nfunction createHtmlText(tokens) {\n  var htmlText = '';\n  tokens.forEach(function (t) {\n    if (t.matched) {\n      htmlText += '<strong class=\"' + SearchPad.RESULT_HIGHLIGHT_CLASS + '\">' + escapeHTML(t.matched) + '</strong>';\n    } else {\n      htmlText += escapeHTML(t.normal);\n    }\n  });\n  return htmlText !== '' ? htmlText : null;\n}\n/**\n * CONSTANTS\n */\n\n\nSearchPad.CONTAINER_SELECTOR = '.djs-search-container';\nSearchPad.INPUT_SELECTOR = '.djs-search-input input';\nSearchPad.RESULTS_CONTAINER_SELECTOR = '.djs-search-results';\nSearchPad.RESULT_SELECTOR = '.djs-search-result';\nSearchPad.RESULT_SELECTED_CLASS = 'djs-search-result-selected';\nSearchPad.RESULT_SELECTED_SELECTOR = '.' + SearchPad.RESULT_SELECTED_CLASS;\nSearchPad.RESULT_ID_ATTRIBUTE = 'data-result-id';\nSearchPad.RESULT_HIGHLIGHT_CLASS = 'djs-search-highlight';\nSearchPad.OVERLAY_CLASS = 'djs-search-overlay';\nSearchPad.BOX_HTML = '<div class=\"djs-search-container djs-draggable djs-scrollable\">' + '<div class=\"djs-search-input\">' + '<input type=\"text\"/>' + '</div>' + '<div class=\"djs-search-results\"></div>' + '</div>';\nSearchPad.RESULT_HTML = '<div class=\"djs-search-result\"></div>';\nSearchPad.RESULT_PRIMARY_HTML = '<div class=\"djs-search-result-primary\"></div>';\nSearchPad.RESULT_SECONDARY_HTML = '<p class=\"djs-search-result-secondary\"></p>';","map":{"version":3,"sources":["C:/Users/Vittorio/Documents/GitHub/SPM2021-MTV/frontend/node_modules/diagram-js/lib/features/search-pad/SearchPad.js"],"names":["clear","domClear","delegate","domDelegate","query","domQuery","classes","domClasses","attr","domAttr","domify","getBBox","getBoundingBox","escapeHTML","SearchPad","canvas","eventBus","overlays","selection","_open","_results","_eventMaps","_canvas","_eventBus","_overlays","_selection","_container","BOX_HTML","_searchInput","INPUT_SELECTOR","_resultsContainer","RESULTS_CONTAINER_SELECTOR","getContainer","appendChild","on","close","$inject","prototype","_bindEvents","self","listen","el","selector","type","fn","push","listener","bind","document","e","stopPropagation","delegateTarget","focus","RESULT_SELECTOR","_scrollToNode","_preselect","_select","keyCode","preventDefault","selected","_getCurrentResult","_scrollToDirection","_search","value","_unbindEvents","forEach","m","unbind","pattern","_clearResults","searchResults","_searchProvider","find","length","result","id","element","node","_createResultNode","previous","previousElementSibling","nextElementSibling","nodeOffset","offsetTop","containerScroll","scrollTop","bottomScroll","clientHeight","_resetOverlay","fire","RESULT_SELECTED_SELECTOR","RESULT_HTML","primaryTokens","createInnerTextNode","RESULT_PRIMARY_HTML","secondaryTokens","RESULT_SECONDARY_HTML","RESULT_ID_ATTRIBUTE","registerProvider","provider","open","Error","isOpen","add","remove","blur","toggle","selectedNode","RESULT_SELECTED_CLASS","_centerViewbox","select","viewbox","box","newViewbox","x","width","outer","y","height","zoom","scale","_overlayId","overlay","constructOverlay","offset","w","h","styles","join","position","bottom","right","show","html","OVERLAY_CLASS","parentNode","tokens","template","text","createHtmlText","childNode","innerHTML","htmlText","t","matched","RESULT_HIGHLIGHT_CLASS","normal","CONTAINER_SELECTOR"],"mappings":"AAAA,SACEA,KAAK,IAAIC,QADX,EAEEC,QAAQ,IAAIC,WAFd,EAGEC,KAAK,IAAIC,QAHX,EAIEC,OAAO,IAAIC,UAJb,EAKEC,IAAI,IAAIC,OALV,EAMEC,MANF,QAOO,SAPP;AASA,SACEC,OAAO,IAAIC,cADb,QAEO,qBAFP;AAIA,SACEC,UADF,QAEO,uBAFP;AAIA;AACA;AACA;;AACA,eAAe,SAASC,SAAT,CAAmBC,MAAnB,EAA2BC,QAA3B,EAAqCC,QAArC,EAA+CC,SAA/C,EAA0D;AACvE,OAAKC,KAAL,GAAa,KAAb;AACA,OAAKC,QAAL,GAAgB,EAAhB;AACA,OAAKC,UAAL,GAAkB,EAAlB;AAEA,OAAKC,OAAL,GAAeP,MAAf;AACA,OAAKQ,SAAL,GAAiBP,QAAjB;AACA,OAAKQ,SAAL,GAAiBP,QAAjB;AACA,OAAKQ,UAAL,GAAkBP,SAAlB,CARuE,CAUvE;;AACA,OAAKQ,UAAL,GAAkBhB,MAAM,CAACI,SAAS,CAACa,QAAX,CAAxB;AACA,OAAKC,YAAL,GAAoBvB,QAAQ,CAACS,SAAS,CAACe,cAAX,EAA2B,KAAKH,UAAhC,CAA5B;AACA,OAAKI,iBAAL,GAAyBzB,QAAQ,CAACS,SAAS,CAACiB,0BAAX,EAAuC,KAAKL,UAA5C,CAAjC,CAbuE,CAevE;;AACA,OAAKJ,OAAL,CAAaU,YAAb,GAA4BC,WAA5B,CAAwC,KAAKP,UAA7C,EAhBuE,CAkBvE;;;AACAV,EAAAA,QAAQ,CAACkB,EAAT,CAAY,CAAE,gBAAF,EAAoB,iBAApB,CAAZ,EAAqD,KAAKC,KAA1D,EAAiE,IAAjE;AACD;AAGDrB,SAAS,CAACsB,OAAV,GAAoB,CAClB,QADkB,EAElB,UAFkB,EAGlB,UAHkB,EAIlB,WAJkB,CAApB;AAQA;AACA;AACA;;AACAtB,SAAS,CAACuB,SAAV,CAAoBC,WAApB,GAAkC,YAAW;AAC3C,MAAIC,IAAI,GAAG,IAAX;;AAEA,WAASC,MAAT,CAAgBC,EAAhB,EAAoBC,QAApB,EAA8BC,IAA9B,EAAoCC,EAApC,EAAwC;AACtCL,IAAAA,IAAI,CAAClB,UAAL,CAAgBwB,IAAhB,CAAqB;AACnBJ,MAAAA,EAAE,EAAEA,EADe;AAEnBE,MAAAA,IAAI,EAAEA,IAFa;AAGnBG,MAAAA,QAAQ,EAAE3C,WAAW,CAAC4C,IAAZ,CAAiBN,EAAjB,EAAqBC,QAArB,EAA+BC,IAA/B,EAAqCC,EAArC;AAHS,KAArB;AAKD,GAT0C,CAW3C;;;AACAJ,EAAAA,MAAM,CAACQ,QAAD,EAAW,MAAX,EAAmB,OAAnB,EAA4B,UAASC,CAAT,EAAY;AAC5CV,IAAAA,IAAI,CAACJ,KAAL;AACD,GAFK,EAEH,IAFG,CAAN,CAZ2C,CAgB3C;AACA;;AACAK,EAAAA,MAAM,CAAC,KAAKd,UAAN,EAAkBZ,SAAS,CAACe,cAA5B,EAA4C,OAA5C,EAAqD,UAASoB,CAAT,EAAY;AACrEA,IAAAA,CAAC,CAACC,eAAF;AACAD,IAAAA,CAAC,CAACE,cAAF,CAAiBC,KAAjB;AACD,GAHK,CAAN,CAlB2C,CAuB3C;;AACAZ,EAAAA,MAAM,CAAC,KAAKd,UAAN,EAAkBZ,SAAS,CAACuC,eAA5B,EAA6C,WAA7C,EAA0D,UAASJ,CAAT,EAAY;AAC1EA,IAAAA,CAAC,CAACC,eAAF;;AACAX,IAAAA,IAAI,CAACe,aAAL,CAAmBL,CAAC,CAACE,cAArB;;AACAZ,IAAAA,IAAI,CAACgB,UAAL,CAAgBN,CAAC,CAACE,cAAlB;AACD,GAJK,CAAN,CAxB2C,CA8B3C;;AACAX,EAAAA,MAAM,CAAC,KAAKd,UAAN,EAAkBZ,SAAS,CAACuC,eAA5B,EAA6C,OAA7C,EAAsD,UAASJ,CAAT,EAAY;AACtEA,IAAAA,CAAC,CAACC,eAAF;;AACAX,IAAAA,IAAI,CAACiB,OAAL,CAAaP,CAAC,CAACE,cAAf;AACD,GAHK,CAAN,CA/B2C,CAoC3C;AACA;;AACAX,EAAAA,MAAM,CAAC,KAAKd,UAAN,EAAkBZ,SAAS,CAACe,cAA5B,EAA4C,SAA5C,EAAuD,UAASoB,CAAT,EAAY;AACvE;AACA,QAAIA,CAAC,CAACQ,OAAF,KAAc,EAAlB,EAAsB;AACpBR,MAAAA,CAAC,CAACS,cAAF;AACD,KAJsE,CAMvE;;;AACA,QAAIT,CAAC,CAACQ,OAAF,KAAc,EAAlB,EAAsB;AACpBR,MAAAA,CAAC,CAACS,cAAF;AACD;AACF,GAVK,CAAN,CAtC2C,CAkD3C;;AACAlB,EAAAA,MAAM,CAAC,KAAKd,UAAN,EAAkBZ,SAAS,CAACe,cAA5B,EAA4C,OAA5C,EAAqD,UAASoB,CAAT,EAAY;AACrE;AACA,QAAIA,CAAC,CAACQ,OAAF,KAAc,EAAlB,EAAsB;AACpB,aAAOlB,IAAI,CAACJ,KAAL,EAAP;AACD,KAJoE,CAMrE;;;AACA,QAAIc,CAAC,CAACQ,OAAF,KAAc,EAAlB,EAAsB;AACpB,UAAIE,QAAQ,GAAGpB,IAAI,CAACqB,iBAAL,EAAf;;AAEA,aAAOD,QAAQ,GAAGpB,IAAI,CAACiB,OAAL,CAAaG,QAAb,CAAH,GAA4BpB,IAAI,CAACJ,KAAL,EAA3C;AACD,KAXoE,CAarE;;;AACA,QAAIc,CAAC,CAACQ,OAAF,KAAc,EAAlB,EAAsB;AACpB,aAAOlB,IAAI,CAACsB,kBAAL,CAAwB,IAAxB,CAAP;AACD,KAhBoE,CAkBrE;;;AACA,QAAIZ,CAAC,CAACQ,OAAF,KAAc,EAAlB,EAAsB;AACpB,aAAOlB,IAAI,CAACsB,kBAAL,EAAP;AACD,KArBoE,CAuBrE;AACA;;;AACA,QAAIZ,CAAC,CAACQ,OAAF,KAAc,EAAd,IAAoBR,CAAC,CAACQ,OAAF,KAAc,EAAtC,EAA0C;AACxC;AACD,KA3BoE,CA6BrE;;;AACAlB,IAAAA,IAAI,CAACuB,OAAL,CAAab,CAAC,CAACE,cAAF,CAAiBY,KAA9B;AACD,GA/BK,CAAN;AAgCD,CAnFD;AAsFA;AACA;AACA;;;AACAjD,SAAS,CAACuB,SAAV,CAAoB2B,aAApB,GAAoC,YAAW;AAC7C,OAAK3C,UAAL,CAAgB4C,OAAhB,CAAwB,UAASC,CAAT,EAAY;AAClC/D,IAAAA,WAAW,CAACgE,MAAZ,CAAmBD,CAAC,CAACzB,EAArB,EAAyByB,CAAC,CAACvB,IAA3B,EAAiCuB,CAAC,CAACpB,QAAnC;AACD,GAFD;AAGD,CAJD;AAOA;AACA;AACA;AACA;AACA;;;AACAhC,SAAS,CAACuB,SAAV,CAAoByB,OAApB,GAA8B,UAASM,OAAT,EAAkB;AAC9C,MAAI7B,IAAI,GAAG,IAAX;;AAEA,OAAK8B,aAAL,GAH8C,CAK9C;;;AACA,MAAI,CAACD,OAAD,IAAYA,OAAO,KAAK,EAA5B,EAAgC;AAC9B;AACD;;AAED,MAAIE,aAAa,GAAG,KAAKC,eAAL,CAAqBC,IAArB,CAA0BJ,OAA1B,CAApB;;AAEA,MAAI,CAACE,aAAa,CAACG,MAAnB,EAA2B;AACzB;AACD,GAd6C,CAgB9C;;;AACAH,EAAAA,aAAa,CAACL,OAAd,CAAsB,UAASS,MAAT,EAAiB;AACrC,QAAIC,EAAE,GAAGD,MAAM,CAACE,OAAP,CAAeD,EAAxB;;AACA,QAAIE,IAAI,GAAGtC,IAAI,CAACuC,iBAAL,CAAuBJ,MAAvB,EAA+BC,EAA/B,CAAX;;AACApC,IAAAA,IAAI,CAACnB,QAAL,CAAcuD,EAAd,IAAoB;AAClBC,MAAAA,OAAO,EAAEF,MAAM,CAACE,OADE;AAElBC,MAAAA,IAAI,EAAEA;AAFY,KAApB;AAID,GAPD,EAjB8C,CA0B9C;;AACA,MAAIA,IAAI,GAAGxE,QAAQ,CAACS,SAAS,CAACuC,eAAX,EAA4B,KAAKvB,iBAAjC,CAAnB;;AACA,OAAKwB,aAAL,CAAmBuB,IAAnB;;AACA,OAAKtB,UAAL,CAAgBsB,IAAhB;AACD,CA9BD;AAiCA;AACA;AACA;AACA;;;AACA/D,SAAS,CAACuB,SAAV,CAAoBwB,kBAApB,GAAyC,UAASkB,QAAT,EAAmB;AAC1D,MAAIpB,QAAQ,GAAG,KAAKC,iBAAL,EAAf;;AACA,MAAI,CAACD,QAAL,EAAe;AACb;AACD;;AAED,MAAIkB,IAAI,GAAGE,QAAQ,GAAGpB,QAAQ,CAACqB,sBAAZ,GAAqCrB,QAAQ,CAACsB,kBAAjE;;AACA,MAAIJ,IAAJ,EAAU;AACR,SAAKvB,aAAL,CAAmBuB,IAAnB;;AACA,SAAKtB,UAAL,CAAgBsB,IAAhB;AACD;AACF,CAXD;AAcA;AACA;AACA;AACA;AACA;;;AACA/D,SAAS,CAACuB,SAAV,CAAoBiB,aAApB,GAAoC,UAASuB,IAAT,EAAe;AACjD,MAAI,CAACA,IAAD,IAASA,IAAI,KAAK,KAAKjB,iBAAL,EAAtB,EAAgD;AAC9C;AACD;;AAED,MAAIsB,UAAU,GAAGL,IAAI,CAACM,SAAtB;AACA,MAAIC,eAAe,GAAG,KAAKtD,iBAAL,CAAuBuD,SAA7C;AAEA,MAAIC,YAAY,GAAGJ,UAAU,GAAG,KAAKpD,iBAAL,CAAuByD,YAApC,GAAmDV,IAAI,CAACU,YAA3E;;AAEA,MAAIL,UAAU,GAAGE,eAAjB,EAAkC;AAChC,SAAKtD,iBAAL,CAAuBuD,SAAvB,GAAmCH,UAAnC;AACD,GAFD,MAEO,IAAIE,eAAe,GAAGE,YAAtB,EAAoC;AACzC,SAAKxD,iBAAL,CAAuBuD,SAAvB,GAAmCC,YAAnC;AACD;AACF,CAfD;AAkBA;AACA;AACA;;;AACAxE,SAAS,CAACuB,SAAV,CAAoBgC,aAApB,GAAoC,YAAW;AAC7CpE,EAAAA,QAAQ,CAAC,KAAK6B,iBAAN,CAAR;AAEA,OAAKV,QAAL,GAAgB,EAAhB;;AAEA,OAAKoE,aAAL;;AAEA,OAAKjE,SAAL,CAAekE,IAAf,CAAoB,mBAApB;AACD,CARD;AAWA;AACA;AACA;AACA;AACA;;;AACA3E,SAAS,CAACuB,SAAV,CAAoBuB,iBAApB,GAAwC,YAAW;AACjD,SAAOvD,QAAQ,CAACS,SAAS,CAAC4E,wBAAX,EAAqC,KAAK5D,iBAA1C,CAAf;AACD,CAFD;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACAhB,SAAS,CAACuB,SAAV,CAAoByC,iBAApB,GAAwC,UAASJ,MAAT,EAAiBC,EAAjB,EAAqB;AAC3D,MAAIE,IAAI,GAAGnE,MAAM,CAACI,SAAS,CAAC6E,WAAX,CAAjB,CAD2D,CAG3D;;AACA,MAAIjB,MAAM,CAACkB,aAAP,CAAqBnB,MAArB,GAA8B,CAAlC,EAAqC;AACnCoB,IAAAA,mBAAmB,CAAChB,IAAD,EAAOH,MAAM,CAACkB,aAAd,EAA6B9E,SAAS,CAACgF,mBAAvC,CAAnB;AACD,GAN0D,CAQ3D;;;AACAD,EAAAA,mBAAmB,CAAChB,IAAD,EAAOH,MAAM,CAACqB,eAAd,EAA+BjF,SAAS,CAACkF,qBAAzC,CAAnB;AAEAvF,EAAAA,OAAO,CAACoE,IAAD,EAAO/D,SAAS,CAACmF,mBAAjB,EAAsCtB,EAAtC,CAAP;;AAEA,OAAK7C,iBAAL,CAAuBG,WAAvB,CAAmC4C,IAAnC;;AAEA,SAAOA,IAAP;AACD,CAhBD;AAmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA/D,SAAS,CAACuB,SAAV,CAAoB6D,gBAApB,GAAuC,UAASC,QAAT,EAAmB;AACxD,OAAK5B,eAAL,GAAuB4B,QAAvB;AACD,CAFD;AAKA;AACA;AACA;;;AACArF,SAAS,CAACuB,SAAV,CAAoB+D,IAApB,GAA2B,YAAW;AACpC,MAAI,CAAC,KAAK7B,eAAV,EAA2B;AACzB,UAAM,IAAI8B,KAAJ,CAAU,+BAAV,CAAN;AACD;;AAED,MAAI,KAAKC,MAAL,EAAJ,EAAmB;AACjB;AACD;;AAED,OAAKhE,WAAL;;AAEA,OAAKnB,KAAL,GAAa,IAAb;AAEAZ,EAAAA,UAAU,CAAC,KAAKmB,UAAN,CAAV,CAA4B6E,GAA5B,CAAgC,MAAhC;;AAEA,OAAK3E,YAAL,CAAkBwB,KAAlB;;AAEA,OAAK7B,SAAL,CAAekE,IAAf,CAAoB,kBAApB;AACD,CAlBD;AAqBA;AACA;AACA;;;AACA3E,SAAS,CAACuB,SAAV,CAAoBF,KAApB,GAA4B,YAAW;AACrC,MAAI,CAAC,KAAKmE,MAAL,EAAL,EAAoB;AAClB;AACD;;AAED,OAAKtC,aAAL;;AAEA,OAAK7C,KAAL,GAAa,KAAb;AAEAZ,EAAAA,UAAU,CAAC,KAAKmB,UAAN,CAAV,CAA4B8E,MAA5B,CAAmC,MAAnC;;AAEA,OAAKnC,aAAL;;AAEA,OAAKzC,YAAL,CAAkBmC,KAAlB,GAA0B,EAA1B;;AACA,OAAKnC,YAAL,CAAkB6E,IAAlB;;AAEA,OAAKjB,aAAL;;AAEA,OAAKjE,SAAL,CAAekE,IAAf,CAAoB,kBAApB;AACD,CAnBD;AAsBA;AACA;AACA;;;AACA3E,SAAS,CAACuB,SAAV,CAAoBqE,MAApB,GAA6B,YAAW;AACtC,OAAKJ,MAAL,KAAgB,KAAKnE,KAAL,EAAhB,GAA+B,KAAKiE,IAAL,EAA/B;AACD,CAFD;AAKA;AACA;AACA;;;AACAtF,SAAS,CAACuB,SAAV,CAAoBiE,MAApB,GAA6B,YAAW;AACtC,SAAO,KAAKnF,KAAZ;AACD,CAFD;AAKA;AACA;AACA;AACA;AACA;;;AACAL,SAAS,CAACuB,SAAV,CAAoBkB,UAApB,GAAiC,UAASsB,IAAT,EAAe;AAC9C,MAAI8B,YAAY,GAAG,KAAK/C,iBAAL,EAAnB,CAD8C,CAG9C;;;AACA,MAAIiB,IAAI,KAAK8B,YAAb,EAA2B;AACzB;AACD,GAN6C,CAQ9C;;;AACA,MAAIA,YAAJ,EAAkB;AAChBpG,IAAAA,UAAU,CAACoG,YAAD,CAAV,CAAyBH,MAAzB,CAAgC1F,SAAS,CAAC8F,qBAA1C;AACD;;AAED,MAAIjC,EAAE,GAAGlE,OAAO,CAACoE,IAAD,EAAO/D,SAAS,CAACmF,mBAAjB,CAAhB;AACA,MAAIrB,OAAO,GAAG,KAAKxD,QAAL,CAAcuD,EAAd,EAAkBC,OAAhC;AAEArE,EAAAA,UAAU,CAACsE,IAAD,CAAV,CAAiB0B,GAAjB,CAAqBzF,SAAS,CAAC8F,qBAA/B;;AAEA,OAAKpB,aAAL,CAAmBZ,OAAnB;;AAEA,OAAKiC,cAAL,CAAoBjC,OAApB;;AAEA,OAAKnD,UAAL,CAAgBqF,MAAhB,CAAuBlC,OAAvB;;AAEA,OAAKrD,SAAL,CAAekE,IAAf,CAAoB,uBAApB,EAA6Cb,OAA7C;AACD,CAzBD;AA4BA;AACA;AACA;AACA;AACA;;;AACA9D,SAAS,CAACuB,SAAV,CAAoBmB,OAApB,GAA8B,UAASqB,IAAT,EAAe;AAC3C,MAAIF,EAAE,GAAGlE,OAAO,CAACoE,IAAD,EAAO/D,SAAS,CAACmF,mBAAjB,CAAhB;AACA,MAAIrB,OAAO,GAAG,KAAKxD,QAAL,CAAcuD,EAAd,EAAkBC,OAAhC;AAEA,OAAKzC,KAAL;;AAEA,OAAKqD,aAAL;;AAEA,OAAKqB,cAAL,CAAoBjC,OAApB;;AAEA,OAAKnD,UAAL,CAAgBqF,MAAhB,CAAuBlC,OAAvB;;AAEA,OAAKrD,SAAL,CAAekE,IAAf,CAAoB,oBAApB,EAA0Cb,OAA1C;AACD,CAbD;AAgBA;AACA;AACA;AACA;AACA;;;AACA9D,SAAS,CAACuB,SAAV,CAAoBwE,cAApB,GAAqC,UAASjC,OAAT,EAAkB;AACrD,MAAImC,OAAO,GAAG,KAAKzF,OAAL,CAAayF,OAAb,EAAd;;AAEA,MAAIC,GAAG,GAAGpG,cAAc,CAACgE,OAAD,CAAxB;AAEA,MAAIqC,UAAU,GAAG;AACfC,IAAAA,CAAC,EAAGF,GAAG,CAACE,CAAJ,GAAQF,GAAG,CAACG,KAAJ,GAAU,CAAnB,GAAwBJ,OAAO,CAACK,KAAR,CAAcD,KAAd,GAAoB,CADhC;AAEfE,IAAAA,CAAC,EAAGL,GAAG,CAACK,CAAJ,GAAQL,GAAG,CAACM,MAAJ,GAAW,CAApB,GAAyBP,OAAO,CAACK,KAAR,CAAcE,MAAd,GAAqB,CAFlC;AAGfH,IAAAA,KAAK,EAAEJ,OAAO,CAACK,KAAR,CAAcD,KAHN;AAIfG,IAAAA,MAAM,EAAEP,OAAO,CAACK,KAAR,CAAcE;AAJP,GAAjB;;AAOA,OAAKhG,OAAL,CAAayF,OAAb,CAAqBE,UAArB;;AAEA,OAAK3F,OAAL,CAAaiG,IAAb,CAAkBR,OAAO,CAACS,KAA1B;AACD,CAfD;AAkBA;AACA;AACA;AACA;AACA;AACA;;;AACA1G,SAAS,CAACuB,SAAV,CAAoBmD,aAApB,GAAoC,UAASZ,OAAT,EAAkB;AACpD,MAAI,KAAK6C,UAAT,EAAqB;AACnB,SAAKjG,SAAL,CAAegF,MAAf,CAAsB,KAAKiB,UAA3B;AACD;;AAED,MAAI7C,OAAJ,EAAa;AACX,QAAIoC,GAAG,GAAGpG,cAAc,CAACgE,OAAD,CAAxB;AACA,QAAI8C,OAAO,GAAGC,gBAAgB,CAACX,GAAD,CAA9B;AACA,SAAKS,UAAL,GAAkB,KAAKjG,SAAL,CAAe+E,GAAf,CAAmB3B,OAAnB,EAA4B8C,OAA5B,CAAlB;AACD;AACF,CAVD;AAaA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASC,gBAAT,CAA0BX,GAA1B,EAA+B;AAE7B,MAAIY,MAAM,GAAG,CAAb;AACA,MAAIC,CAAC,GAAGb,GAAG,CAACG,KAAJ,GAAYS,MAAM,GAAG,CAA7B;AACA,MAAIE,CAAC,GAAGd,GAAG,CAACM,MAAJ,GAAaM,MAAM,GAAG,CAA9B;AAEA,MAAIG,MAAM,GAAG,CACX,YAAWF,CAAX,GAAc,IADH,EAEX,aAAYC,CAAZ,GAAgB,IAFL,EAGXE,IAHW,CAGN,IAHM,CAAb;AAKA,SAAO;AACLC,IAAAA,QAAQ,EAAE;AACRC,MAAAA,MAAM,EAAEJ,CAAC,GAAGF,MADJ;AAERO,MAAAA,KAAK,EAAEN,CAAC,GAAGD;AAFH,KADL;AAKLQ,IAAAA,IAAI,EAAE,IALD;AAMLC,IAAAA,IAAI,EAAE,iBAAiBN,MAAjB,GAA0B,WAA1B,GAAwCjH,SAAS,CAACwH,aAAlD,GAAkE;AANnE,GAAP;AAQD;AAGD;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASzC,mBAAT,CAA6B0C,UAA7B,EAAyCC,MAAzC,EAAiDC,QAAjD,EAA2D;AACzD,MAAIC,IAAI,GAAGC,cAAc,CAACH,MAAD,CAAzB;AACA,MAAII,SAAS,GAAGlI,MAAM,CAAC+H,QAAD,CAAtB;AACAG,EAAAA,SAAS,CAACC,SAAV,GAAsBH,IAAtB;AACAH,EAAAA,UAAU,CAACtG,WAAX,CAAuB2G,SAAvB;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASD,cAAT,CAAwBH,MAAxB,EAAgC;AAC9B,MAAIM,QAAQ,GAAG,EAAf;AAEAN,EAAAA,MAAM,CAACvE,OAAP,CAAe,UAAS8E,CAAT,EAAY;AACzB,QAAIA,CAAC,CAACC,OAAN,EAAe;AACbF,MAAAA,QAAQ,IAAI,oBAAoBhI,SAAS,CAACmI,sBAA9B,GAAuD,IAAvD,GAA8DpI,UAAU,CAACkI,CAAC,CAACC,OAAH,CAAxE,GAAsF,WAAlG;AACD,KAFD,MAEO;AACLF,MAAAA,QAAQ,IAAIjI,UAAU,CAACkI,CAAC,CAACG,MAAH,CAAtB;AACD;AACF,GAND;AAQA,SAAOJ,QAAQ,KAAK,EAAb,GAAkBA,QAAlB,GAA6B,IAApC;AACD;AAGD;AACA;AACA;;;AACAhI,SAAS,CAACqI,kBAAV,GAA+B,uBAA/B;AACArI,SAAS,CAACe,cAAV,GAA2B,yBAA3B;AACAf,SAAS,CAACiB,0BAAV,GAAuC,qBAAvC;AACAjB,SAAS,CAACuC,eAAV,GAA4B,oBAA5B;AACAvC,SAAS,CAAC8F,qBAAV,GAAkC,4BAAlC;AACA9F,SAAS,CAAC4E,wBAAV,GAAqC,MAAM5E,SAAS,CAAC8F,qBAArD;AACA9F,SAAS,CAACmF,mBAAV,GAAgC,gBAAhC;AACAnF,SAAS,CAACmI,sBAAV,GAAmC,sBAAnC;AACAnI,SAAS,CAACwH,aAAV,GAA0B,oBAA1B;AAEAxH,SAAS,CAACa,QAAV,GACE,oEACE,gCADF,GAEI,sBAFJ,GAGE,QAHF,GAIE,wCAJF,GAKA,QANF;AAQAb,SAAS,CAAC6E,WAAV,GACE,uCADF;AAGA7E,SAAS,CAACgF,mBAAV,GACE,+CADF;AAGAhF,SAAS,CAACkF,qBAAV,GACE,6CADF","sourcesContent":["import {\n  clear as domClear,\n  delegate as domDelegate,\n  query as domQuery,\n  classes as domClasses,\n  attr as domAttr,\n  domify as domify\n} from 'min-dom';\n\nimport {\n  getBBox as getBoundingBox\n} from '../../util/Elements';\n\nimport {\n  escapeHTML\n} from '../../util/EscapeUtil';\n\n/**\n * Provides searching infrastructure\n */\nexport default function SearchPad(canvas, eventBus, overlays, selection) {\n  this._open = false;\n  this._results = [];\n  this._eventMaps = [];\n\n  this._canvas = canvas;\n  this._eventBus = eventBus;\n  this._overlays = overlays;\n  this._selection = selection;\n\n  // setup elements\n  this._container = domify(SearchPad.BOX_HTML);\n  this._searchInput = domQuery(SearchPad.INPUT_SELECTOR, this._container);\n  this._resultsContainer = domQuery(SearchPad.RESULTS_CONTAINER_SELECTOR, this._container);\n\n  // attach search pad\n  this._canvas.getContainer().appendChild(this._container);\n\n  // cleanup on destroy\n  eventBus.on([ 'canvas.destroy', 'diagram.destroy' ], this.close, this);\n}\n\n\nSearchPad.$inject = [\n  'canvas',\n  'eventBus',\n  'overlays',\n  'selection'\n];\n\n\n/**\n * Binds and keeps track of all event listereners\n */\nSearchPad.prototype._bindEvents = function() {\n  var self = this;\n\n  function listen(el, selector, type, fn) {\n    self._eventMaps.push({\n      el: el,\n      type: type,\n      listener: domDelegate.bind(el, selector, type, fn)\n    });\n  }\n\n  // close search on clicking anywhere outside\n  listen(document, 'html', 'click', function(e) {\n    self.close();\n  }, true);\n\n  // stop event from propagating and closing search\n  // focus on input\n  listen(this._container, SearchPad.INPUT_SELECTOR, 'click', function(e) {\n    e.stopPropagation();\n    e.delegateTarget.focus();\n  });\n\n  // preselect result on hover\n  listen(this._container, SearchPad.RESULT_SELECTOR, 'mouseover', function(e) {\n    e.stopPropagation();\n    self._scrollToNode(e.delegateTarget);\n    self._preselect(e.delegateTarget);\n  });\n\n  // selects desired result on mouse click\n  listen(this._container, SearchPad.RESULT_SELECTOR, 'click', function(e) {\n    e.stopPropagation();\n    self._select(e.delegateTarget);\n  });\n\n  // prevent cursor in input from going left and right when using up/down to\n  // navigate results\n  listen(this._container, SearchPad.INPUT_SELECTOR, 'keydown', function(e) {\n    // up\n    if (e.keyCode === 38) {\n      e.preventDefault();\n    }\n\n    // down\n    if (e.keyCode === 40) {\n      e.preventDefault();\n    }\n  });\n\n  // handle keyboard input\n  listen(this._container, SearchPad.INPUT_SELECTOR, 'keyup', function(e) {\n    // escape\n    if (e.keyCode === 27) {\n      return self.close();\n    }\n\n    // enter\n    if (e.keyCode === 13) {\n      var selected = self._getCurrentResult();\n\n      return selected ? self._select(selected) : self.close();\n    }\n\n    // up\n    if (e.keyCode === 38) {\n      return self._scrollToDirection(true);\n    }\n\n    // down\n    if (e.keyCode === 40) {\n      return self._scrollToDirection();\n    }\n\n    // left && right\n    // do not search while navigating text input\n    if (e.keyCode === 37 || e.keyCode === 39) {\n      return;\n    }\n\n    // anything else\n    self._search(e.delegateTarget.value);\n  });\n};\n\n\n/**\n * Unbinds all previously established listeners\n */\nSearchPad.prototype._unbindEvents = function() {\n  this._eventMaps.forEach(function(m) {\n    domDelegate.unbind(m.el, m.type, m.listener);\n  });\n};\n\n\n/**\n * Performs a search for the given pattern.\n *\n * @param  {String} pattern\n */\nSearchPad.prototype._search = function(pattern) {\n  var self = this;\n\n  this._clearResults();\n\n  // do not search on empty query\n  if (!pattern || pattern === '') {\n    return;\n  }\n\n  var searchResults = this._searchProvider.find(pattern);\n\n  if (!searchResults.length) {\n    return;\n  }\n\n  // append new results\n  searchResults.forEach(function(result) {\n    var id = result.element.id;\n    var node = self._createResultNode(result, id);\n    self._results[id] = {\n      element: result.element,\n      node: node\n    };\n  });\n\n  // preselect first result\n  var node = domQuery(SearchPad.RESULT_SELECTOR, this._resultsContainer);\n  this._scrollToNode(node);\n  this._preselect(node);\n};\n\n\n/**\n * Navigate to the previous/next result. Defaults to next result.\n * @param  {Boolean} previous\n */\nSearchPad.prototype._scrollToDirection = function(previous) {\n  var selected = this._getCurrentResult();\n  if (!selected) {\n    return;\n  }\n\n  var node = previous ? selected.previousElementSibling : selected.nextElementSibling;\n  if (node) {\n    this._scrollToNode(node);\n    this._preselect(node);\n  }\n};\n\n\n/**\n * Scroll to the node if it is not visible.\n *\n * @param  {Element} node\n */\nSearchPad.prototype._scrollToNode = function(node) {\n  if (!node || node === this._getCurrentResult()) {\n    return;\n  }\n\n  var nodeOffset = node.offsetTop;\n  var containerScroll = this._resultsContainer.scrollTop;\n\n  var bottomScroll = nodeOffset - this._resultsContainer.clientHeight + node.clientHeight;\n\n  if (nodeOffset < containerScroll) {\n    this._resultsContainer.scrollTop = nodeOffset;\n  } else if (containerScroll < bottomScroll) {\n    this._resultsContainer.scrollTop = bottomScroll;\n  }\n};\n\n\n/**\n * Clears all results data.\n */\nSearchPad.prototype._clearResults = function() {\n  domClear(this._resultsContainer);\n\n  this._results = [];\n\n  this._resetOverlay();\n\n  this._eventBus.fire('searchPad.cleared');\n};\n\n\n/**\n * Get currently selected result.\n *\n * @return {Element}\n */\nSearchPad.prototype._getCurrentResult = function() {\n  return domQuery(SearchPad.RESULT_SELECTED_SELECTOR, this._resultsContainer);\n};\n\n\n/**\n * Create result DOM element within results container\n * that corresponds to a search result.\n *\n * 'result' : one of the elements returned by SearchProvider\n * 'id' : id attribute value to assign to the new DOM node\n * return : created DOM element\n *\n * @param  {SearchResult} result\n * @param  {String} id\n * @return {Element}\n */\nSearchPad.prototype._createResultNode = function(result, id) {\n  var node = domify(SearchPad.RESULT_HTML);\n\n  // create only if available\n  if (result.primaryTokens.length > 0) {\n    createInnerTextNode(node, result.primaryTokens, SearchPad.RESULT_PRIMARY_HTML);\n  }\n\n  // secondary tokens (represent element ID) are allways available\n  createInnerTextNode(node, result.secondaryTokens, SearchPad.RESULT_SECONDARY_HTML);\n\n  domAttr(node, SearchPad.RESULT_ID_ATTRIBUTE, id);\n\n  this._resultsContainer.appendChild(node);\n\n  return node;\n};\n\n\n/**\n * Register search element provider.\n *\n * SearchProvider.find - provides search function over own elements\n *  (pattern) => [{ text: <String>, element: <Element>}, ...]\n *\n * @param  {SearchProvider} provider\n */\nSearchPad.prototype.registerProvider = function(provider) {\n  this._searchProvider = provider;\n};\n\n\n/**\n * Open search pad.\n */\nSearchPad.prototype.open = function() {\n  if (!this._searchProvider) {\n    throw new Error('no search provider registered');\n  }\n\n  if (this.isOpen()) {\n    return;\n  }\n\n  this._bindEvents();\n\n  this._open = true;\n\n  domClasses(this._container).add('open');\n\n  this._searchInput.focus();\n\n  this._eventBus.fire('searchPad.opened');\n};\n\n\n/**\n * Close search pad.\n */\nSearchPad.prototype.close = function() {\n  if (!this.isOpen()) {\n    return;\n  }\n\n  this._unbindEvents();\n\n  this._open = false;\n\n  domClasses(this._container).remove('open');\n\n  this._clearResults();\n\n  this._searchInput.value = '';\n  this._searchInput.blur();\n\n  this._resetOverlay();\n\n  this._eventBus.fire('searchPad.closed');\n};\n\n\n/**\n * Toggles search pad on/off.\n */\nSearchPad.prototype.toggle = function() {\n  this.isOpen() ? this.close() : this.open();\n};\n\n\n/**\n * Report state of search pad.\n */\nSearchPad.prototype.isOpen = function() {\n  return this._open;\n};\n\n\n/**\n * Preselect result entry.\n *\n * @param  {Element} element\n */\nSearchPad.prototype._preselect = function(node) {\n  var selectedNode = this._getCurrentResult();\n\n  // already selected\n  if (node === selectedNode) {\n    return;\n  }\n\n  // removing preselection from current node\n  if (selectedNode) {\n    domClasses(selectedNode).remove(SearchPad.RESULT_SELECTED_CLASS);\n  }\n\n  var id = domAttr(node, SearchPad.RESULT_ID_ATTRIBUTE);\n  var element = this._results[id].element;\n\n  domClasses(node).add(SearchPad.RESULT_SELECTED_CLASS);\n\n  this._resetOverlay(element);\n\n  this._centerViewbox(element);\n\n  this._selection.select(element);\n\n  this._eventBus.fire('searchPad.preselected', element);\n};\n\n\n/**\n * Select result node.\n *\n * @param  {Element} element\n */\nSearchPad.prototype._select = function(node) {\n  var id = domAttr(node, SearchPad.RESULT_ID_ATTRIBUTE);\n  var element = this._results[id].element;\n\n  this.close();\n\n  this._resetOverlay();\n\n  this._centerViewbox(element);\n\n  this._selection.select(element);\n\n  this._eventBus.fire('searchPad.selected', element);\n};\n\n\n/**\n * Center viewbox on the element middle point.\n *\n * @param  {Element} element\n */\nSearchPad.prototype._centerViewbox = function(element) {\n  var viewbox = this._canvas.viewbox();\n\n  var box = getBoundingBox(element);\n\n  var newViewbox = {\n    x: (box.x + box.width/2) - viewbox.outer.width/2,\n    y: (box.y + box.height/2) - viewbox.outer.height/2,\n    width: viewbox.outer.width,\n    height: viewbox.outer.height\n  };\n\n  this._canvas.viewbox(newViewbox);\n\n  this._canvas.zoom(viewbox.scale);\n};\n\n\n/**\n * Reset overlay removes and, optionally, set\n * overlay to a new element.\n *\n * @param  {Element} element\n */\nSearchPad.prototype._resetOverlay = function(element) {\n  if (this._overlayId) {\n    this._overlays.remove(this._overlayId);\n  }\n\n  if (element) {\n    var box = getBoundingBox(element);\n    var overlay = constructOverlay(box);\n    this._overlayId = this._overlays.add(element, overlay);\n  }\n};\n\n\n/**\n * Construct overlay object for the given bounding box.\n *\n * @param  {BoundingBox} box\n * @return {Object}\n */\nfunction constructOverlay(box) {\n\n  var offset = 6;\n  var w = box.width + offset * 2;\n  var h = box.height + offset * 2;\n\n  var styles = [\n    'width: '+ w +'px',\n    'height: '+ h + 'px'\n  ].join('; ');\n\n  return {\n    position: {\n      bottom: h - offset,\n      right: w - offset\n    },\n    show: true,\n    html: '<div style=\"' + styles + '\" class=\"' + SearchPad.OVERLAY_CLASS + '\"></div>'\n  };\n}\n\n\n/**\n * Creates and appends child node from result tokens and HTML template.\n *\n * @param  {Element} node\n * @param  {Array<Object>} tokens\n * @param  {String} template\n */\nfunction createInnerTextNode(parentNode, tokens, template) {\n  var text = createHtmlText(tokens);\n  var childNode = domify(template);\n  childNode.innerHTML = text;\n  parentNode.appendChild(childNode);\n}\n\n/**\n * Create internal HTML markup from result tokens.\n * Caters for highlighting pattern matched tokens.\n *\n * @param  {Array<Object>} tokens\n * @return {String}\n */\nfunction createHtmlText(tokens) {\n  var htmlText = '';\n\n  tokens.forEach(function(t) {\n    if (t.matched) {\n      htmlText += '<strong class=\"' + SearchPad.RESULT_HIGHLIGHT_CLASS + '\">' + escapeHTML(t.matched) + '</strong>';\n    } else {\n      htmlText += escapeHTML(t.normal);\n    }\n  });\n\n  return htmlText !== '' ? htmlText : null;\n}\n\n\n/**\n * CONSTANTS\n */\nSearchPad.CONTAINER_SELECTOR = '.djs-search-container';\nSearchPad.INPUT_SELECTOR = '.djs-search-input input';\nSearchPad.RESULTS_CONTAINER_SELECTOR = '.djs-search-results';\nSearchPad.RESULT_SELECTOR = '.djs-search-result';\nSearchPad.RESULT_SELECTED_CLASS = 'djs-search-result-selected';\nSearchPad.RESULT_SELECTED_SELECTOR = '.' + SearchPad.RESULT_SELECTED_CLASS;\nSearchPad.RESULT_ID_ATTRIBUTE = 'data-result-id';\nSearchPad.RESULT_HIGHLIGHT_CLASS = 'djs-search-highlight';\nSearchPad.OVERLAY_CLASS = 'djs-search-overlay';\n\nSearchPad.BOX_HTML =\n  '<div class=\"djs-search-container djs-draggable djs-scrollable\">' +\n    '<div class=\"djs-search-input\">' +\n      '<input type=\"text\"/>' +\n    '</div>' +\n    '<div class=\"djs-search-results\"></div>' +\n  '</div>';\n\nSearchPad.RESULT_HTML =\n  '<div class=\"djs-search-result\"></div>';\n\nSearchPad.RESULT_PRIMARY_HTML =\n  '<div class=\"djs-search-result-primary\"></div>';\n\nSearchPad.RESULT_SECONDARY_HTML =\n  '<p class=\"djs-search-result-secondary\"></p>';\n"]},"metadata":{},"sourceType":"module"}