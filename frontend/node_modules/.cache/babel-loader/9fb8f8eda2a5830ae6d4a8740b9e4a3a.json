{"ast":null,"code":"import inherits from 'inherits';\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport lineIntersect from './util/LineIntersect';\nexport default function RemoveElementBehavior(eventBus, bpmnRules, modeling) {\n  CommandInterceptor.call(this, eventBus);\n  /**\n   * Combine sequence flows when deleting an element\n   * if there is one incoming and one outgoing\n   * sequence flow\n   */\n\n  this.preExecute('shape.delete', function (e) {\n    var shape = e.context.shape;\n\n    if (shape.incoming.length == 1 && shape.outgoing.length == 1) {\n      var inConnection = shape.incoming[0],\n          outConnection = shape.outgoing[0];\n\n      if (bpmnRules.canConnect(inConnection.source, outConnection.target, inConnection)) {\n        // compute new, combined waypoints\n        var newWaypoints = getNewWaypoints(inConnection.waypoints, outConnection.waypoints);\n        modeling.reconnectEnd(inConnection, outConnection.target, newWaypoints);\n      }\n    }\n  });\n}\ninherits(RemoveElementBehavior, CommandInterceptor);\nRemoveElementBehavior.$inject = ['eventBus', 'bpmnRules', 'modeling']; // helpers //////////////////////\n\nfunction getDocking(point) {\n  return point.original || point;\n}\n\nfunction getNewWaypoints(inWaypoints, outWaypoints) {\n  var intersection = lineIntersect(getDocking(inWaypoints[inWaypoints.length - 2]), getDocking(inWaypoints[inWaypoints.length - 1]), getDocking(outWaypoints[1]), getDocking(outWaypoints[0]));\n\n  if (intersection) {\n    return [].concat(inWaypoints.slice(0, inWaypoints.length - 1), [intersection], outWaypoints.slice(1));\n  } else {\n    return [getDocking(inWaypoints[0]), getDocking(outWaypoints[outWaypoints.length - 1])];\n  }\n}","map":{"version":3,"sources":["C:/Users/Vittorio/Documents/GitHub/SPM2021-MTV/frontend/node_modules/bpmn-js/lib/features/modeling/behavior/RemoveElementBehavior.js"],"names":["inherits","CommandInterceptor","lineIntersect","RemoveElementBehavior","eventBus","bpmnRules","modeling","call","preExecute","e","shape","context","incoming","length","outgoing","inConnection","outConnection","canConnect","source","target","newWaypoints","getNewWaypoints","waypoints","reconnectEnd","$inject","getDocking","point","original","inWaypoints","outWaypoints","intersection","concat","slice"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,UAArB;AAEA,OAAOC,kBAAP,MAA+B,2CAA/B;AAEA,OAAOC,aAAP,MAA0B,sBAA1B;AAGA,eAAe,SAASC,qBAAT,CAA+BC,QAA/B,EAAyCC,SAAzC,EAAoDC,QAApD,EAA8D;AAE3EL,EAAAA,kBAAkB,CAACM,IAAnB,CAAwB,IAAxB,EAA8BH,QAA9B;AAEA;AACF;AACA;AACA;AACA;;AACE,OAAKI,UAAL,CAAgB,cAAhB,EAAgC,UAASC,CAAT,EAAY;AAE1C,QAAIC,KAAK,GAAGD,CAAC,CAACE,OAAF,CAAUD,KAAtB;;AAEA,QAAIA,KAAK,CAACE,QAAN,CAAeC,MAAf,IAAyB,CAAzB,IAA8BH,KAAK,CAACI,QAAN,CAAeD,MAAf,IAAyB,CAA3D,EAA8D;AAE5D,UAAIE,YAAY,GAAGL,KAAK,CAACE,QAAN,CAAe,CAAf,CAAnB;AAAA,UACII,aAAa,GAAGN,KAAK,CAACI,QAAN,CAAe,CAAf,CADpB;;AAIA,UAAIT,SAAS,CAACY,UAAV,CAAqBF,YAAY,CAACG,MAAlC,EAA0CF,aAAa,CAACG,MAAxD,EAAgEJ,YAAhE,CAAJ,EAAmF;AAEjF;AACA,YAAIK,YAAY,GAAGC,eAAe,CAACN,YAAY,CAACO,SAAd,EAAyBN,aAAa,CAACM,SAAvC,CAAlC;AAEAhB,QAAAA,QAAQ,CAACiB,YAAT,CAAsBR,YAAtB,EAAoCC,aAAa,CAACG,MAAlD,EAA0DC,YAA1D;AACD;AACF;AACF,GAlBD;AAoBD;AAEDpB,QAAQ,CAACG,qBAAD,EAAwBF,kBAAxB,CAAR;AAEAE,qBAAqB,CAACqB,OAAtB,GAAgC,CAC9B,UAD8B,EAE9B,WAF8B,EAG9B,UAH8B,CAAhC,C,CAOA;;AAEA,SAASC,UAAT,CAAoBC,KAApB,EAA2B;AACzB,SAAOA,KAAK,CAACC,QAAN,IAAkBD,KAAzB;AACD;;AAGD,SAASL,eAAT,CAAyBO,WAAzB,EAAsCC,YAAtC,EAAoD;AAElD,MAAIC,YAAY,GAAG5B,aAAa,CAC9BuB,UAAU,CAACG,WAAW,CAACA,WAAW,CAACf,MAAZ,GAAqB,CAAtB,CAAZ,CADoB,EAE9BY,UAAU,CAACG,WAAW,CAACA,WAAW,CAACf,MAAZ,GAAqB,CAAtB,CAAZ,CAFoB,EAG9BY,UAAU,CAACI,YAAY,CAAC,CAAD,CAAb,CAHoB,EAI9BJ,UAAU,CAACI,YAAY,CAAC,CAAD,CAAb,CAJoB,CAAhC;;AAMA,MAAIC,YAAJ,EAAkB;AAChB,WAAO,GAAGC,MAAH,CACLH,WAAW,CAACI,KAAZ,CAAkB,CAAlB,EAAqBJ,WAAW,CAACf,MAAZ,GAAqB,CAA1C,CADK,EAEL,CAAEiB,YAAF,CAFK,EAGLD,YAAY,CAACG,KAAb,CAAmB,CAAnB,CAHK,CAAP;AAID,GALD,MAKO;AACL,WAAO,CACLP,UAAU,CAACG,WAAW,CAAC,CAAD,CAAZ,CADL,EAELH,UAAU,CAACI,YAAY,CAACA,YAAY,CAAChB,MAAb,GAAsB,CAAvB,CAAb,CAFL,CAAP;AAID;AACF","sourcesContent":["import inherits from 'inherits';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport lineIntersect from './util/LineIntersect';\n\n\nexport default function RemoveElementBehavior(eventBus, bpmnRules, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Combine sequence flows when deleting an element\n   * if there is one incoming and one outgoing\n   * sequence flow\n   */\n  this.preExecute('shape.delete', function(e) {\n\n    var shape = e.context.shape;\n\n    if (shape.incoming.length == 1 && shape.outgoing.length == 1) {\n\n      var inConnection = shape.incoming[0],\n          outConnection = shape.outgoing[0];\n\n\n      if (bpmnRules.canConnect(inConnection.source, outConnection.target, inConnection)) {\n\n        // compute new, combined waypoints\n        var newWaypoints = getNewWaypoints(inConnection.waypoints, outConnection.waypoints);\n\n        modeling.reconnectEnd(inConnection, outConnection.target, newWaypoints);\n      }\n    }\n  });\n\n}\n\ninherits(RemoveElementBehavior, CommandInterceptor);\n\nRemoveElementBehavior.$inject = [\n  'eventBus',\n  'bpmnRules',\n  'modeling'\n];\n\n\n// helpers //////////////////////\n\nfunction getDocking(point) {\n  return point.original || point;\n}\n\n\nfunction getNewWaypoints(inWaypoints, outWaypoints) {\n\n  var intersection = lineIntersect(\n    getDocking(inWaypoints[inWaypoints.length - 2]),\n    getDocking(inWaypoints[inWaypoints.length - 1]),\n    getDocking(outWaypoints[1]),\n    getDocking(outWaypoints[0]));\n\n  if (intersection) {\n    return [].concat(\n      inWaypoints.slice(0, inWaypoints.length - 1),\n      [ intersection ],\n      outWaypoints.slice(1));\n  } else {\n    return [\n      getDocking(inWaypoints[0]),\n      getDocking(outWaypoints[outWaypoints.length - 1])\n    ];\n  }\n}"]},"metadata":{},"sourceType":"module"}